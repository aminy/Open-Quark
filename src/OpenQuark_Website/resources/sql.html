<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy for Windows (vers 14 February 2006), see www.w3.org">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<title>Sql.cal</title>

<style type="text/css">
 /* Style Definitions */
 p.Clz, li.Clz, div.Clz
  {margin:0in;margin-bottom:.0001pt;}
 div.Section1
  {page:Section1;}
</style>

<style type="text/css">
 body { font-family:"Lucida Sans Typewriter","Courier New",Courier,monospace; font-size:10pt }
</style>

<style type="text/css">
 span.c8 {color:#7F9FBF}
 span.c7 {color:#2A00FF}
 span.c6 {color:#646464}
 span.c5 {color:#7F0055}
 span.c4 {color:#7F7F9F}
 span.c3 {color:black}
 span.c2 {color:#3F5FBF}
 span.c1 {color:#3F7F5F}
</style>
</head>
<body lang="EN-US">
<div class="Section1">
<p class="Clz"><span class='c1'>/*</span></p>
<p class="Clz"><span class='c1'>&nbsp;* Copyright (c) 2007 BUSINESS OBJECTS SOFTWARE LIMITED</span></p>
<p class="Clz"><span class='c1'>&nbsp;* All rights reserved.</span></p>
<p class="Clz"><span class='c1'>&nbsp;*</span></p>
<p class="Clz"><span class='c1'>&nbsp;* Redistribution and use in source and binary forms, with or without</span></p>
<p class="Clz"><span class='c1'>&nbsp;* modification, are permitted provided that the following conditions are met:</span></p>
<p class="Clz"><span class='c1'>&nbsp;*</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp; * Redistributions of source code must retain the above copyright notice,</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this list of conditions and the following disclaimer.</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp; * Redistributions in binary form must reproduce the above copyright</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notice, this list of conditions and the following disclaimer in the</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; documentation and/or other materials provided with the distribution.</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp; * Neither the name of Business Objects nor the names of its contributors</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; may be used to endorse or promote products derived from this software</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; without specific prior written permission.</span></p>
<p class="Clz"><span class='c1'>&nbsp;*&nbsp;</span></p>
<p class="Clz"><span class='c1'>&nbsp;* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span></p>
<p class="Clz"><span class='c1'>&nbsp;* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></p>
<p class="Clz"><span class='c1'>&nbsp;* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></p>
<p class="Clz"><span class='c1'>&nbsp;* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span></p>
<p class="Clz"><span class='c1'>&nbsp;* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></p>
<p class="Clz"><span class='c1'>&nbsp;* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></p>
<p class="Clz"><span class='c1'>&nbsp;* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></p>
<p class="Clz"><span class='c1'>&nbsp;* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></p>
<p class="Clz"><span class='c1'>&nbsp;* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></p>
<p class="Clz"><span class='c1'>&nbsp;* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></p>
<p class="Clz"><span class='c1'>&nbsp;* POSSIBILITY OF SUCH DAMAGE.</span></p>
<p class="Clz"><span class='c1'>&nbsp;*/</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/*</span></p>
<p class="Clz"><span class='c1'>&nbsp;* Sql.cal</span></p>
<p class="Clz"><span class='c1'>&nbsp;* Creation date: Feb 5, 2004.</span></p>
<p class="Clz"><span class='c1'>&nbsp;* By: Richard Webster</span></p>
<p class="Clz"><span class='c1'>&nbsp;*/</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>module</span> <span class='c2'>provides</span> <span class='c2'>a</span> <span class='c2'>combinator</span> <span class='c2'>library</span> <span class='c2'>for</span> <span class='c2'>creating</span> <span class='c2'>abstract</span> <span class='c2'>SQL</span> <span class='c2'>queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>represented</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>Query</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>new,</span> <span class='c2'>empty</span> <span class='c2'>query</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>created</span> <span class='c2'>by</span> <span class='c2'>calling</span> <span class='c4'>{@link</span> <span class='c2'>newQuery</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>qry0</span> <span class='c2'>=</span> <span class='c2'>newQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>To</span> <span class='c2'>project</span> <span class='c2'>a</span> <span class='c2'>column</span> <span class='c2'>or</span> <span class='c2'>a</span> <span class='c2'>SQL</span> <span class='c2'>expression,</span> <span class='c2'>use</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>project</span><span class='c4'>@}</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>There</span> <span class='c2'>are</span> <span class='c2'>several</span> <span class='c2'>variations</span> <span class='c2'>on</span> <span class='c2'>this</span> <span class='c2'>function,</span> <span class='c2'>such</span> <span class='c2'>as</span> <span class='c4'>{@link</span> <span class='c2'>projectColumn</span><span class='c4'>@}</span> <span class='c2'>and</span> <span class='c4'>{@link</span> <span class='c2'>projectWithAliases</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>qry1</span> <span class='c2'>=</span> <span class='c2'>project</span> <span class='c2'>qry0</span> <span class='c2'>[toUntypedExpr</span> <span class='c2'>countryField,</span> <span class='c2'>toUntypedExpr</span> <span class='c2'>orderDateField];</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>To</span> <span class='c2'>add</span> <span class='c2'>a</span> <span class='c2'>restriction</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>use</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>restrict</span><span class='c4'>@}</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>qry2</span> <span class='c2'>=</span> <span class='c2'>restrict</span> <span class='c2'>qry1</span> <span class='c2'>(eqExpr</span> <span class='c2'>countryField</span> <span class='c2'>(stringConstant</span> <span class='c2'>"Canada"));</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>To</span> <span class='c2'>add</span> <span class='c2'>sorting</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>use</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>order</span><span class='c4'>@}</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>qry3</span> <span class='c2'>=</span> <span class='c2'>order</span> <span class='c2'>qry2</span> <span class='c2'>orderDateField</span> <span class='c2'>True;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>To</span> <span class='c2'>add</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>use</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>join</span><span class='c4'>@}</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>joinInfo</span> <span class='c2'>=</span> <span class='c2'>makeJoinInfo</span> <span class='c2'>(intField</span> <span class='c2'>custTable</span> <span class='c2'>"Customer</span> <span class='c2'>ID")</span> <span class='c2'>(intField</span> <span class='c2'>ordersTable</span> <span class='c2'>"Customer</span> <span class='c2'>ID")</span> <span class='c2'>InnerJoin;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>qry4</span> <span class='c2'>=</span> <span class='c2'>join</span> <span class='c2'>qry3</span> <span class='c2'>joinInfo;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>abstract</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>Query</span><span class='c4'>@}</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>converted</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>concrete</span> <span class='c2'>SQL</span> <span class='c2'>query</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>queryText</span><span class='c4'>@}</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>requires</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>SqlBuilder</span><span class='c4'>@}</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>specific</span> <span class='c2'>RDBMS</span> <span class='c2'>as</span> <span class='c2'>found</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>module</span> <span class='c4'>{@link</span> <span class='c2'>module</span> <span class='c2'>=</span> <span class='c2'>"Cal.Data.SqlBuilder"</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>See</span> <span class='c2'>the</span> <span class='c2'>module</span> <span class='c4'>{@link</span> <span class='c2'>module</span> <span class='c2'>=</span> <span class='c2'>"Cal.Test.Data.Sql_Tests"</span><span class='c4'>@}</span> <span class='c2'>for</span> <span class='c2'>examples</span> <span class='c2'>of</span> <span class='c2'>query</span> <span class='c2'>construction.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>There</span> <span class='c2'>is</span> <span class='c2'>some</span> <span class='c2'>support</span> <span class='c2'>for</span> <span class='c2'>other</span> <span class='c2'>types</span> <span class='c2'>of</span> <span class='c2'>SQL</span> <span class='c2'>statements,</span> <span class='c2'>such</span> <span class='c2'>as</span> <span class='c2'>ones</span> <span class='c2'>to</span> <span class='c2'>create/delete</span> <span class='c2'>tables</span> <span class='c2'>and</span> <span class='c2'>inserting</span> <span class='c2'>rows.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>See</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>Statement</span><span class='c4'>@}</span> <span class='c2'>type.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@author</span> <span class='c2'>Richard</span> <span class='c2'>Webster</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>module</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Data</span><span class='c3'>.</span><span class='c6'>Sql</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Core</span><span class='c3'>.</span><span class='c6'>Prelude</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Byte</span><span class='c3'>,</span> <span class='c6'>Int</span><span class='c3'>,</span> <span class='c6'>Double</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>,</span> <span class='c6'>Char</span><span class='c3'>,</span> <span class='c6'>Integer</span><span class='c3'>,</span> <span class='c6'>JObject</span><span class='c3'>,</span> <span class='c6'>JList</span><span class='c3'>,</span> <span class='c6'>Maybe</span><span class='c3'>,</span> <span class='c6'>Ordering</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>dataConstructor</span></b> <span class='c3'>=</span> <span class='c6'>False</span><span class='c3'>,</span> <span class='c6'>True</span><span class='c3'>,</span> <span class='c6'>LT</span><span class='c3'>,</span> <span class='c6'>EQ</span><span class='c3'>,</span> <span class='c6'>GT</span><span class='c3'>,</span> <span class='c6'>Nothing</span><span class='c3'>,</span> <span class='c6'>Just</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeClass</span></b> <span class='c3'>=</span> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Ord</span><span class='c3'>,</span> <span class='c6'>Num</span><span class='c3'>,</span> <span class='c6'>Inputable</span><span class='c3'>,</span> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; append, compare, concat, const, doubleToString, equals,</span> <span class='c6'>error</span><span class='c3'>, fromJust, fst, input,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intToString, isNothing, isEmpty,&nbsp; max, mod, not, output, round,</span> <span class='c6'>seq</span><span class='c3'>, snd, toDouble,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; field1, field2, field3, upFrom, upFromTo;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Long</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= compose, fromMaybe, isJust, listToMaybe, maybeToList, longToString;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Collections</span><span class='c3'>.</span><span class='c6'>List</span> <b><span class='c5'>using</span></b><span class='c3'>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= all, chop, filter, foldLeft, foldLeftStrict, foldRight, head, intersperse,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; last, length, list2, map, outputList, outputListWith, reverse, subscript, sum, tail, take,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; zip, zip3, zipWith;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= any, concatMap, deleteFirsts, drop, elemIndex, isElem, mapIndexed, repeat, removeDuplicates,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicatesBy, lookupWithDefault, find, groupBy, intersect, isSingletonList, sort;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Core</span><span class='c3'>.</span><span class='c6'>String</span> <b><span class='c5'>using</span></b><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= toLowerCase;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Core</span><span class='c3'>.</span><span class='c6'>Debug</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeClass</span></b> <span class='c3'>=</span> <span class='c6'>Show</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= show;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Utilities</span><span class='c3'>.</span><span class='c6'>TimeZone</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>TimeZone</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Utilities</span><span class='c3'>.</span><span class='c6'>Time</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Utilities</span><span class='c3'>.</span><span class='c6'>PrettyPrinter</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= line, multilineText, nest, text;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Data</span><span class='c3'>.</span><span class='c6'>SqlType</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>SqlType</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Collections</span><span class='c3'>.</span><span class='c6'>Set</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Set</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Collections</span><span class='c3'>.</span><span class='c6'>Array</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Array</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Data</span><span class='c3'>.</span><span class='c6'>DatabaseMetadata</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>DatabaseReference</span><span class='c3'>,</span> <span class='c6'>TableReference</span><span class='c3'>,</span> <span class='c6'>TableDescription</span><span class='c3'>,</span> <span class='c6'>FieldDescription</span><span class='c3'>,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TableConstraint</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>dataConstructor</span></b> <span class='c3'>=</span> <span class='c6'>PrimaryKeyConstraint</span><span class='c3'>,</span> <span class='c6'>UniqueConstraint</span><span class='c3'>,</span> <span class='c6'>ForeignKeyConstraint</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= getTableNameFromReference, makeTableReference;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Utilities</span><span class='c3'>.</span><span class='c6'>UniqueIdentifier</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>UniqueIdentifier</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeClass</span></b> <span class='c3'>=</span> <span class='c6'>UniquelyNamedItem</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>= makeUniqueIdentifierByName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><b><span class='c5'>import</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Utilities</span><span class='c3'>.</span><span class='c6'>Range</span> <b><span class='c5'>using</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>typeConstructor</span></b> <span class='c3'>=</span> <span class='c6'>Range</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>function</span></b> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hasLeftEndpoint, hasRightEndpoint, includesLeftEndpoint,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; includesRightEndpoint, leftEndpoint, rightEndpoint;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>friend</span></b> <span class='c6'>Cal</span><span class='c3'>.</span><span class='c6'>Data</span><span class='c3'>.</span><span class='c6'>SqlBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Associates</span> <span class='c2'>a</span> <span class='c2'>table</span> <span class='c2'>resource</span> <span class='c2'>with</span> <span class='c2'>its</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>QueryTable</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>reference</span> <span class='c2'>to</span> <span class='c2'>an</span> <span class='c2'>actual</span> <span class='c2'>database</span> <span class='c2'>table</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>given</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableRef</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>reference</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>table</span> <span class='c2'>by</span> <span class='c2'>name</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>BaseTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp; :: !</span><span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias&nbsp;&nbsp; :: !</span><span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>given</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subquery</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>'table'</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>SubQueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subquery&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias&nbsp;&nbsp; :: !</span><span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>statement</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>given</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subqueryText</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>SELECT</span> <span class='c2'>statement</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>'table'</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>OpaqueSubQueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subqueryText ::</span> <span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias&nbsp;&nbsp; :: !</span><span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>table</span> <span class='c2'>alias</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableName</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>as</span> <span class='c2'>the</span> <span class='c2'>alias</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeQueryTable ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeQueryTable !tableName = makeQueryTableWithAlias tableName</span> <span class='c7'>""</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>and</span> <span class='c2'>base</span> <span class='c2'>alias</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>no</span> <span class='c2'>table</span> <span class='c2'>alias</span> <span class='c2'>is</span> <span class='c2'>specified,</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>as</span> <span class='c2'>the</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableName</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>to</span> <span class='c2'>use</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>An</span> <span class='c2'>empty</span> <span class='c2'>alias</span> <span class='c2'>name</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>as</span> <span class='c2'>the</span> <span class='c2'>alias</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>and</span> <span class='c2'>alias</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeQueryTableWithAlias ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeQueryTableWithAlias !tableName !tableAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias ::</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty tableAlias)</span> <b><span class='c5'>then</span></b> <span class='c3'>tableName</span> <b><span class='c5'>else</span></b> <span class='c3'>tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>(makeTableReference tableName) fixedAlias;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>table</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>query</span> <span class='c2'>and</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>will</span> <span class='c2'>remove</span> <span class='c2'>any</span> <span class='c2'>ordering</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>(unless</span> <span class='c2'>it</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>TopN</span><span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subquery</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>to</span> <span class='c2'>use</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>If</span> <span class='c2'>an</span> <span class='c2'>empty</span> <span class='c2'>alias</span> <span class='c2'>is</span> <span class='c2'>specified,</span> <span class='c2'>then</span> <span class='c2'>a</span> <span class='c2'>default</span> <span class='c2'>one</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>generated.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>query</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>alias</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeSubQueryTable ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeSubQueryTable subquery !tableAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias ::</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty tableAlias)</span> <b><span class='c5'>then</span></b> <span class='c7'>"Q"</span> <b><span class='c5'>else</span></b> <span class='c3'>tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>(fixSubqueryOrdering subquery) fixedAlias;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>table</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>query</span> <span class='c2'>text</span> <span class='c2'>and</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>query</span> <span class='c2'>text</span> <span class='c2'>must</span> <span class='c2'>be</span> <span class='c2'>valid</span> <span class='c2'>when</span> <span class='c2'>used</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>subquery.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>In</span> <span class='c2'>most</span> <span class='c2'>cases,</span> <span class='c2'>this</span> <span class='c2'>means</span> <span class='c2'>that</span> <span class='c2'>it</span> <span class='c2'>cannot</span> <span class='c2'>contain</span> <span class='c2'>an</span> <span class='c2'>ORDER</span> <span class='c2'>BY</span> <span class='c2'>clause.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subqueryText</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>SELECT</span> <span class='c2'>statement</span> <span class='c2'>text</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>tableAlias</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>alias</span> <span class='c2'>to</span> <span class='c2'>use</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>If</span> <span class='c2'>an</span> <span class='c2'>empty</span> <span class='c2'>alias</span> <span class='c2'>is</span> <span class='c2'>specified,</span> <span class='c2'>then</span> <span class='c2'>a</span> <span class='c2'>default</span> <span class='c2'>one</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>generated.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>nested</span> <span class='c2'>SELECT</span> <span class='c2'>query</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>alias</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeOpaqueSubQueryTable ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeOpaqueSubQueryTable subqueryText !tableAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias ::</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedAlias =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty tableAlias)</span> <b><span class='c5'>then</span></b> <span class='c7'>"Q"</span> <b><span class='c5'>else</span></b> <span class='c3'>tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span> <span class='c3'>subqueryText fixedAlias;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>queryTable</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>True</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>(or</span> <span class='c2'>opaque</span> <span class='c2'>subquery)</span> <span class='c2'>table;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>False</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>base</span> <span class='c2'>database</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isSubqueryTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isSubqueryTable !queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SubQueryTable</span> <span class='c3'>|</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>(without</span> <span class='c2'>quotes).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>empty</span> <span class='c2'>string</span> <span class='c2'>is</span> <span class='c2'>returned</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>queryTable</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>base</span> <span class='c2'>database</span> <span class='c2'>table,</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>or</span> <span class='c2'>an</span> <span class='c2'>empty</span> <span class='c2'>string</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>a</span> <span class='c2'>subquery</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getQueryTableName ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getQueryTableName !queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableRef} -&gt; getTableNameFromReference tableRef;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c7'>""</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>composition</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>base</span> <span class='c2'>alias</span> <span class='c2'>and</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>ID</span> <span class='c2'>to</span> <span class='c2'>give</span> <span class='c2'>a</span> <span class='c2'>distinct</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>queryTable</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>alias</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getQueryTableAlias ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getQueryTableAlias !queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (</span><span class='c6'>BaseTable</span> <span class='c3'>|</span> <span class='c6'>SubQueryTable</span> <span class='c3'>|</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {tableAlias} -&gt; tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Query</span> <span class='c2'>tables</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>compared</span> <span class='c2'>for</span> <span class='c2'>equality.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>is</span> <span class='c2'>based</span> <span class='c2'>only</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>aliases,</span> <span class='c2'>not</span> <span class='c2'>the</span> <span class='c2'>actual</span> <span class='c2'>table</span> <span class='c2'>information.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Eq</span> <span class='c6'>QueryTable</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; equals = equalsQueryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; notEquals = notEqualsQueryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>equalsQueryTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>equalsQueryTable table1 table2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>table1</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>table2</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: should this compare the tables as well? (This breaks the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// SqlParser code currently.)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableAlias = tableAlias2} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias == tableAlias2;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; table == table2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>table2</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: should this compare the subqueries as well? (This breaks the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// SqlParser code currently.)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{tableAlias = tableAlias2} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias == tableAlias2;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; subQuery == subQuery2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span> <span class='c3'>{tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>table2</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span> <span class='c3'>{tableAlias = tableAlias2} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias == tableAlias2;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; subqueryText == subqueryText2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>notEqualsQueryTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>notEqualsQueryTable table1 table2 = not (equalsQueryTable table1 table2);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Query</span> <span class='c2'>tables</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>shown.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>subquery</span> <span class='c2'>tables,</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>text</span> <span class='c2'>will</span> <span class='c2'>not</span> <span class='c2'>be</span> <span class='c2'>shown</span> <span class='c2'>since</span> <span class='c2'>this</span> <span class='c2'>may</span> <span class='c2'>be</span> <span class='c2'>too</span> <span class='c2'>verbose.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Debug</span><span class='c3'>.</span><span class='c6'>Show</span> <span class='c6'>QueryTable</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; show = showQueryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>showQueryTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>showQueryTable table =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>table</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableRef, tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(getTableNameFromReference tableRef == tableAlias)</span> <b><span class='c5'>then</span></b> <span class='c3'>tableAlias</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>(show tableRef) ++</span> <span class='c7'>" AS "</span> <span class='c3'>++ tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp; (</span><span class='c6'>SubQueryTable</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {tableAlias} -&gt;</span> <span class='c7'>"&lt;subquery&gt; AS "</span><span class='c3'>++ tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Options</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>QueryOption</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>only</span> <span class='c2'>distinct</span> <span class='c2'>rows</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>Distinct</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>N</span> <span class='c2'>rows</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>n</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>number</span> <span class='c2'>of</span> <span class='c2'>rows</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>returned</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>percent</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>if</span> <span class='c2'>True</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>number</span> <span class='c2'>with</span> <span class='c2'>be</span> <span class='c2'>interpretted</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>percentage</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>full</span> <span class='c2'>set</span> <span class='c2'>of</span> <span class='c2'>rows,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>if</span> <span class='c2'>False</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>number</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>interpretted</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>number</span> <span class='c2'>of</span> <span class='c2'>rows</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>withTies</span><span class='c3'>&nbsp;</span> <span class='c2'>if</span> <span class='c2'>True</span> <span class='c2'>then</span> <span class='c2'>any</span> <span class='c2'>rows</span> <span class='c2'>that</span> <span class='c2'>are</span> <span class='c2'>considered</span> <span class='c2'>equivalent</span> <span class='c2'>order-wise</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>Nth</span> <span class='c2'>row</span> <span class='c2'>will</span> <span class='c2'>also</span> <span class='c2'>be</span> <span class='c2'>included</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>results;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>if</span> <span class='c2'>False</span> <span class='c2'>then</span> <span class='c2'>only</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>N</span> <span class='c2'>rows</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned,</span> <span class='c2'>even</span> <span class='c2'>if</span> <span class='c2'>there</span> <span class='c2'>are</span> <span class='c2'>ties</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>TopN</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: !</span><span class='c6'>Int</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; percent&nbsp; :: !</span><span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; withTies :: !</span><span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>option</span> <span class='c2'>specifies</span> <span class='c2'>TopN</span> <span class='c2'>criteria.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>option</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>option</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>True</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>option</span> <span class='c2'>specifies</span> <span class='c2'>TopN</span> <span class='c2'>criteria</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isTopNOption ::</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isTopNOption !option =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>option</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TopN</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Information</span> <span class='c2'>about</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>between</span> <span class='c2'>2</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>JoinInfo</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>Information</span> <span class='c2'>about</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>between</span> <span class='c2'>2</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftTable</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>one</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>tables</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>rightTable</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>other</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>fieldJoinExprs</span><span class='c3'>&nbsp;</span> <span class='c2'>Boolean</span> <span class='c2'>expressions</span> <span class='c2'>joining</span> <span class='c2'>fields</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>tables</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinType</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>being</span> <span class='c2'>performed</span> <span class='c2'>(inner,</span> <span class='c2'>left</span> <span class='c2'>outer,</span> <span class='c2'>right</span> <span class='c2'>outer,</span> <span class='c2'>or</span> <span class='c2'>full</span> <span class='c2'>outer)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>JoinInfo</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftTable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: !</span><span class='c6'>QueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTable&nbsp;&nbsp;&nbsp;&nbsp; :: !</span><span class='c6'>QueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldJoinExprs :: [</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: !</span><span class='c6'>JoinType</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>info</span> <span class='c2'>specified.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>expressions</span> <span class='c2'>provided</span> <span class='c2'>must</span> <span class='c2'>both</span> <span class='c2'>be</span> <span class='c4'>{@link</span> <span class='c2'>QueryField@}s.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>link</span> <span class='c2'>expressions</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>created</span> <span class='c2'>to</span> <span class='c2'>compare</span> <span class='c2'>each</span> <span class='c2'>pair</span> <span class='c2'>of</span> <span class='c2'>fields</span> <span class='c2'>using</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span> <span class='c2'>'='</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>other</span> <span class='c2'>link</span> <span class='c2'>comparison</span> <span class='c2'>are</span> <span class='c2'>required,</span> <span class='c2'>the</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>JoinInfo</span><span class='c4'>@}</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>constructed</span> <span class='c2'>with</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>these</span> <span class='c2'>explicitly.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftField</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>left</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>rightField</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>right</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinType</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>being</span> <span class='c2'>performed</span> <span class='c2'>(inner,</span> <span class='c2'>left</span> <span class='c2'>outer,</span> <span class='c2'>right</span> <span class='c2'>outer,</span> <span class='c2'>or</span> <span class='c2'>full</span> <span class='c2'>outer)</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>between</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>fields</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeJoinInfo ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>JoinType</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinInfo</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeJoinInfo !leftField !rightField !joinType =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableFromQueryField fieldExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>(toUntypedExpr fieldExpr)</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{queryTable} -&gt; queryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c3'>(</span><span class='c7'>"The join fields must be QueryFields"</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;leftTable ::</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftTable&nbsp; = tableFromQueryField leftField;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTable ::</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTable = tableFromQueryField rightField;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldJoinExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldJoinExpr = eqExpr leftField rightField;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinInfo</span> <span class='c3'>leftTable rightTable [fieldJoinExpr] joinType;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>between</span> <span class='c2'>2</span> <span class='c2'>tables</span> <span class='c2'>using</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>linking</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftTable</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>one</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>tables</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>rightTable</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>other</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>linkingExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>expression</span> <span class='c2'>joining</span> <span class='c2'>fields</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>tables</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinType</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>being</span> <span class='c2'>performed</span> <span class='c2'>(inner,</span> <span class='c2'>left</span> <span class='c2'>outer,</span> <span class='c2'>right</span> <span class='c2'>outer,</span> <span class='c2'>or</span> <span class='c2'>full</span> <span class='c2'>outer)</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeJoinInfo2 ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinType</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinInfo</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeJoinInfo2 !leftTable !rightTable linkingExpr !joinType =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinInfo</span> <span class='c3'>leftTable rightTable [linkingExpr] joinType;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>types</span> <span class='c2'>of</span> <span class='c2'>joins</span> <span class='c2'>that</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>performed</span> <span class='c2'>between</span> <span class='c2'>two</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>JoinType</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>inner</span> <span class='c2'>join</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>rows</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>where</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>condition</span> <span class='c2'>between</span> <span class='c2'>the</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>satisfied.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>InnerJoin</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>left</span> <span class='c2'>outer</span> <span class='c2'>join</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>all</span> <span class='c2'>rows</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>left</span> <span class='c2'>table</span> <span class='c2'>should</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>be</span> <span class='c2'>included</span> <span class='c2'>along</span> <span class='c2'>with</span> <span class='c2'>values</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>right</span> <span class='c2'>table</span> <span class='c2'>where</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>condition</span> <span class='c2'>is</span> <span class='c2'>satisfied.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>LeftOuterJoin</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>right</span> <span class='c2'>outer</span> <span class='c2'>join</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>all</span> <span class='c2'>rows</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>right</span> <span class='c2'>table</span> <span class='c2'>should</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>be</span> <span class='c2'>included</span> <span class='c2'>along</span> <span class='c2'>with</span> <span class='c2'>values</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>left</span> <span class='c2'>table</span> <span class='c2'>where</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>condition</span> <span class='c2'>is</span> <span class='c2'>satisfied.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>RightOuterJoin</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>full</span> <span class='c2'>outer</span> <span class='c2'>join</span> <span class='c2'>option</span> <span class='c2'>indicates</span> <span class='c2'>that</span> <span class='c2'>all</span> <span class='c2'>rows</span> <span class='c2'>satisfying</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>condition</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>returned</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>as</span> <span class='c2'>well</span> <span class='c2'>as</span> <span class='c2'>any</span> <span class='c2'>unmatched</span> <span class='c2'>rows</span> <span class='c2'>from</span> <span class='c2'>both</span> <span class='c2'>the</span> <span class='c2'>left</span> <span class='c2'>and</span> <span class='c2'>right</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>FullOuterJoin</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>binary</span> <span class='c2'>tree</span> <span class='c2'>structure</span> <span class='c2'>for</span> <span class='c2'>representing</span> <span class='c2'>joins.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>JoinNode</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>node</span> <span class='c2'>representing</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>query</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>table</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>JoinTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>QueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>node</span> <span class='c2'>specifying</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>between</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>two</span> <span class='c2'>join</span> <span class='c2'>trees.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftNode</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>one</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>trees</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>rightNode</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>other</span> <span class='c2'>join</span> <span class='c2'>tree</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>joined</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>linkingExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>expression</span> <span class='c2'>joining</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>trees</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinType</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>performed</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>JoinSubtree</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftNode&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JoinNode</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightNode&nbsp;&nbsp; ::</span> <span class='c6'>JoinNode</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkingExpr :: (</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinType&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JoinType</span><span class='c3'>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Join</span> <span class='c2'>nodes</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>shown.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Debug</span><span class='c3'>.</span><span class='c6'>Show</span> <span class='c6'>JoinNode</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; show = showJoinNode;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>showJoinNode ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>showJoinNode !node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>joinTable -&gt; show joinTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt;</span> <span class='c7'>"{"</span> <span class='c3'>++ (showJoinNode leftNode) ++</span> <span class='c7'>" -&gt; "</span> <span class='c3'>++ (showJoinNode rightNode) ++</span> <span class='c7'>"}"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>named</span> <span class='c2'>set</span> <span class='c2'>of</span> <span class='c2'>joins.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>JoinSet</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>named</span> <span class='c2'>set</span> <span class='c2'>of</span> <span class='c2'>joins.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>name</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joins</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>root</span> <span class='c2'>join</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>JoinSet</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name&nbsp; :: !</span><span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joins ::</span> <span class='c6'>JoinNode</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>JoinInfo</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>name</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joins</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>joins</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>part</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>name</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeJoinSet ::</span> <span class='c6'>String</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinInfo</span><span class='c3'>] -&gt;</span> <span class='c6'>JoinSet</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeJoinSet !name joins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; makeJoinSet2 name (buildJoinTree joins);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>JoinNode</span> <span class='c2'>tree</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>name</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinTree</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>root</span> <span class='c2'>join</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>name</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeJoinSet2 ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinSet</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeJoinSet2 !name joinTree =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSet</span> <span class='c3'>name joinTree;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>joinSet</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>root</span> <span class='c2'>join</span> <span class='c2'>node</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>set</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>joinSetJoinTree ::</span> <span class='c6'>JoinSet</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>joinSetJoinTree !joinSet =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; joinSet.</span><span class='c6'>JoinSet</span><span class='c3'>.joins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>// Implement the UniquelyNamedItem class.</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>UniquelyNamedItem</span> <span class='c6'>JoinSet</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; getDisplayName = joinSetName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; getUniqueIdentifier = joinSetUniqueIdentifier;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>joinSetName !joinSet = joinSet.</span><span class='c6'>JoinSet</span><span class='c3'>.name;</span></p>
<p class="Clz"><span class='c3'>joinSetUniqueIdentifier !joinSet = makeUniqueIdentifierByName (joinSetName joinSet);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>Expr</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>reference</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>fieldName</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>field</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>queryTable</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>QueryField</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldName&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTable&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>QueryTable</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>literal</span> <span class='c2'>value</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>constantValue</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>ConstExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constantValue ::</span> <span class='c6'>ConstValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>parameter</span> <span class='c2'>placeholder</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>parameter</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>ParameterExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameter&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>database</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>listValues</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>ListExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listValues&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Expr</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>func</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>identifier</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>arguments</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>argument</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>FunctionExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>DbFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arguments&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Expr</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>subquery</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>subquery</span> <span class='c2'>must</span> <span class='c2'>have</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>projected</span> <span class='c2'>column.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subquery</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>SubQueryExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subquery&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>list.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>list;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isListExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isListExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>expressions</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>value</span> <span class='c2'>expressions</span> <span class='c2'>form</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getListFromListExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getListFromListExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt; listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a list expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>containing</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>literal;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isStringConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isStringConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>StringValue</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>string</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>string</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getStringValueFromConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getStringValueFromConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>StringValue</span> <span class='c3'>{strValue} -&gt; strValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a string constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>containing</span> <span class='c2'>a</span> <span class='c2'>number</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>literal;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isNumberConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isNumberConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NumberValue</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>number</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>numeric</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getNumberValueFromConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getNumberValueFromConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NumberValue</span> <span class='c3'>{numValue} -&gt; numValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a number constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>containing</span> <span class='c2'>a</span> <span class='c2'>boolean</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>constant;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isBooleanConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isBooleanConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BooleanValue</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>boolean</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>Boolean</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getBooleanValueFromConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getBooleanValueFromConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BooleanValue</span> <span class='c3'>{boolValue} -&gt; boolValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a boolean constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>containing</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>constant;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isTimeConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isTimeConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TimeValue</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>time</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>constant</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>time</span> <span class='c2'>value</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getTimeValueFromConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getTimeValueFromConstExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TimeValue</span> <span class='c3'>{timeValue} -&gt; timeValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a time constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a constant expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>table;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isQueryFieldExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isQueryFieldExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>field</span> <span class='c2'>name</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getFieldNameFromQueryFieldExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getFieldNameFromQueryFieldExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{fieldName} -&gt; fieldName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a query field expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>field</span> <span class='c2'>name</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>table</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getQueryTableFromQueryFieldExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getQueryTableFromQueryFieldExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{queryTable} -&gt; queryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a query field expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>(or</span> <span class='c2'>operator)</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>application.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>function</span> <span class='c2'>expression;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isFunctionExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isFunctionExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>type</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>identifier</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getFunctionFromFunctionExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>DbFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getFunctionFromFunctionExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func} -&gt; func;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a function expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>arguments</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>exception</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>expressions</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getArgumentsFromFunctionExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getArgumentsFromFunctionExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{arguments} -&gt; arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Not a function expression"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>an</span> <span class='c2'>operator</span> <span class='c2'>applied</span> <span class='c2'>to</span> <span class='c2'>one</span> <span class='c2'>or</span> <span class='c2'>more</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>arguments.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c4'>{@link</span> <span class='c2'>True</span><span class='c4'>@}</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>represents</span> <span class='c2'>an</span> <span class='c2'>operator</span> <span class='c2'>applied</span> <span class='c2'>to</span> <span class='c2'>one</span> <span class='c2'>or</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>more</span> <span class='c2'>arguments;</span> <span class='c4'>{@link</span> <span class='c2'>False</span><span class='c4'>@}</span> <span class='c2'>otherwise</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isOperatorExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isOperatorExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func} -&gt; isOperator func;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@code</span> <span class='c2'>TypedExpr</span><span class='c4'>@}</span> <span class='c2'>wraps</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c4'>{@link</span> <span class='c2'>Expr</span><span class='c4'>@}</span> <span class='c2'>and</span> <span class='c2'>adds</span> <span class='c2'>information</span> <span class='c2'>about</span> <span class='c2'>the</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>data</span> <span class='c2'>type.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>TypedExpr</span> <span class='c3'>a =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>TypedExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedExpr ::</span> <span class='c6'>Expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>untyped</span> <span class='c2'>expression</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>typed</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>typedExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>typed</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>toUntypedExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>toUntypedExpr !typedExpr = typedExpr.</span><span class='c6'>TypedExpr</span><span class='c3'>.untypedExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>typed</span> <span class='c2'>expression</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>untyped</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>untypedExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>typed</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>toTypedExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>toTypedExpr =</span> <span class='c6'>TypedExpr</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>values</span> <span class='c2'>represented</span> <span class='c2'>by</span> <span class='c2'>this</span> <span class='c2'>typed</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>typeOfExpr ::</span> <span class='c6'>Prelude</span><span class='c3'>.</span><span class='c6'>Typeable</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Prelude</span><span class='c3'>.</span><span class='c6'>TypeRep</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>typeOfExpr !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; head (</span><span class='c6'>Prelude</span><span class='c3'>.typeArguments (</span><span class='c6'>Prelude</span><span class='c3'>.</span><span class='c6'>typeOf</span> <span class='c3'>expr));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>// Allow typed expressions to be compared for equality.</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Eq</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c3'>a)</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; equals = equalsTypedExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; notEquals = notEqualsTypedExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>// Allow typed expressions to be shown.</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Show</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c3'>a)</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; show = showTypedExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>showTypedExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>showTypedExpr !typedExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; show typedExpr.</span><span class='c6'>TypedExpr</span><span class='c3'>.untypedExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Checks</span> <span class='c2'>whether</span> <span class='c2'>2</span> <span class='c2'>typed</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>equal.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>equalsTypedExpr !expr1 !expr2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (toUntypedExpr expr1) == (toUntypedExpr expr2);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>notEqualsTypedExpr !expr1 !expr2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; not (equalsTypedExpr expr1 expr2);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>constant</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>private</span></b> <span class='c6'>ConstValue</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>NullValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>StringValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; strValue::</span><span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>NumberValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; numValue::</span><span class='c6'>Double</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>BooleanValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolValue::</span><span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>TimeValue</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeValue::</span><span class='c6'>Time</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>literal.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>strValue</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>string</span> <span class='c2'>literal</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>string</span> <span class='c2'>literal</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>stringConstant ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>stringConstant strValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c3'>(</span><span class='c6'>StringValue</span> <span class='c3'>strValue));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>literal.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>numValue</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>numeric</span> <span class='c2'>literal</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>numeric</span> <span class='c2'>literal</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>numericConstant ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt; a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>numericConstant numValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c3'>(</span><span class='c6'>NumberValue</span> <span class='c3'>(toDouble numValue)));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>boolValue</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>booleanConstant ::</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>booleanConstant !boolValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>boolValue</span> <b><span class='c5'>then</span></b> <span class='c3'>trueConstant</span> <b><span class='c5'>else</span></b> <span class='c3'>falseConstant;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span> <span class='c2'>True.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span> <span class='c2'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>trueConstant ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>trueConstant =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c3'>(</span><span class='c6'>BooleanValue</span> <span class='c6'>True</span><span class='c3'>));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span> <span class='c2'>False.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>Boolean</span> <span class='c2'>value</span> <span class='c2'>False</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>falseConstant ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>falseConstant =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c3'>(</span><span class='c6'>BooleanValue</span> <span class='c6'>False</span><span class='c3'>));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>literal.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>timeValue</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>time</span> <span class='c2'>literal</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>time</span> <span class='c2'>literal</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>timeConstant ::</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>timeConstant timeValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c3'>(</span><span class='c6'>TimeValue</span> <span class='c3'>timeValue));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>null</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>some</span> <span class='c2'>data</span> <span class='c2'>type.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>null</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>nullValue ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>nullValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ConstExpr</span> <span class='c6'>NullValue</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Tests</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>expression</span> <span class='c2'>has</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>null.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>does</span> <span class='c2'>not</span> <span class='c2'>check</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>expression</span> <span class='c2'>evaluates</span> <span class='c2'>to</span> <span class='c2'>null</span> <span class='c2'>--</span> <span class='c2'>it</span> <span class='c2'>simply</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>checks</span> <span class='c2'>whether</span> <span class='c2'>it</span> <span class='c2'>has</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>null.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>True</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>has</span> <span class='c2'>the</span> <span class='c2'>constant</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>null</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isNullValue ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isNullValue !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NullValue</span> <span class='c3'>-&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>parameter</span> <span class='c2'>that</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>place</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>value</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>SQL</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>parameter</span> <span class='c2'>values</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>bound</span> <span class='c2'>in</span> <span class='c2'>when</span> <span class='c2'>executing</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>is</span> <span class='c2'>often</span> <span class='c2'>used</span> <span class='c2'>to</span> <span class='c2'>execute</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>statement</span> <span class='c2'>multiple</span> <span class='c2'>times</span> <span class='c2'>with</span> <span class='c2'>different</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>private</span></b> <span class='c6'>Parameter</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>parameter</span> <span class='c2'>without</span> <span class='c2'>a</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>values</span> <span class='c2'>for</span> <span class='c2'>unnamed</span> <span class='c2'>parameters</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>bound</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>position</span> <span class='c2'>of</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>parameter</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>UnnamedParameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>parameter</span> <span class='c2'>with</span> <span class='c2'>an</span> <span class='c2'>associated</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*</span> <span class='c2'>Note:</span> <span class='c2'>JDBC</span> <span class='c2'>3.0</span> <span class='c2'>only</span> <span class='c2'>supports</span> <span class='c2'>named</span> <span class='c2'>parameter</span> <span class='c2'>for</span> <span class='c2'>CallableStatement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>NamedParameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name ::</span> <span class='c6'>String</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>named</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>param</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>True</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>is</span> <span class='c2'>named</span> <span class='c2'>one;</span> <span class='c2'>False</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>is</span> <span class='c2'>unnamed</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isUnnamedParameter ::</span> <span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isUnnamedParameter !param =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>param</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UnnamedParameter</span> <span class='c3'>-&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>named</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>error</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>is</span> <span class='c2'>unnamed.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>param</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>named</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getParameterName ::</span> <span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getParameterName !param =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>param</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NamedParameter</span> <span class='c3'>{name} -&gt; name;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Only a named parameter has a name!"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>string</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>stringParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>stringParameter !maybeParamName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>$ untypedParameter maybeParamName;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>integerParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>integerParameter !maybeParamName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>$ untypedParameter maybeParamName;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>double</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>double</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>doubleParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>doubleParameter !maybeParamName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>$ untypedParameter maybeParamName;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>Boolean</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>booleanParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>booleanParameter !maybeParamName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>$ untypedParameter maybeParamName;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>time</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>timeParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>timeParameter !maybeParamName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>$ untypedParameter maybeParamName;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>Nothing</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>name,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>parameter</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>an</span> <span class='c2'>unnamed</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>maybeParamName</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>optional</span> <span class='c2'>name</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>parameter</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedParameter ::</span> <span class='c6'>Maybe</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>untypedParameter !maybeParamName =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>maybeParamName</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>paramName -&gt;</span> <span class='c6'>ParameterExpr</span> <span class='c3'>$</span> <span class='c6'>NamedParameter</span> <span class='c3'>paramName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>ParameterExpr</span> <span class='c3'>$</span> <span class='c6'>UnnamedParameter</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>listValues</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>database</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>values</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedListExpr :: [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedListExpr listValues =</span> <span class='c6'>ListExpr</span> <span class='c3'>listValues;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>typed</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>probably</span> <span class='c2'>doesn't</span> <span class='c2'>need</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>exposed</span> <span class='c2'>since</span> <span class='c2'>it</span> <span class='c2'>can</span> <span class='c2'>only</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>with</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>IN</span> <span class='c2'>binary</span> <span class='c2'>operator</span> <span class='c2'>anyway.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>listValues</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>database</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>typed</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>values</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>listExpr :: [</span><span class='c6'>TypedExpr</span> <span class='c3'>a] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>[a];</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>listExpr listValues =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>ListExpr</span> <span class='c3'>(map toUntypedExpr listValues));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>a</span> <span class='c2'>subquery.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Any</span> <span class='c2'>ordering</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>removed</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>(unless</span> <span class='c2'>it</span> <span class='c2'>uses</span> <span class='c4'>{@link</span> <span class='c2'>TopN</span><span class='c4'>@}</span><span class='c2'>).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>subquery</span> <span class='c2'>must</span> <span class='c2'>have</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>projected</span> <span class='c2'>column.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subquery</span><span class='c3'>&nbsp;</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>treated</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>subquery</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>subQueryExpr ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>subQueryExpr !subquery =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove any ordering from the subquery (unless it uses TopN).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedSubquery = fixSubqueryOrdering subquery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check that there is only 1 return column in the subquery.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: is there a way to make this typed based on the (one and only) result column in the query?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isSingletonList (getProjectedColumns fixedSubquery))</span> <b><span class='c5'>then</span></b> <span class='c6'>SubQueryExpr</span> <span class='c3'>fixedSubquery</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>error</span> <span class='c7'>"Only subqueries returning a single column can be used as field expressions"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Database</span> <span class='c2'>expression</span> <span class='c2'>functions</span> <span class='c2'>and</span> <span class='c2'>operators.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>DbFunction</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Unary operators.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>OpNot</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpBitNot</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpNegate</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpIsNull</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpIsNotNull</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpExists</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Binary operators</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpEq</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpLt</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpLtEq</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpGt</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpGtEq</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpNotEq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpAnd</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpOr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpLike</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpIn</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpCat</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpPlus</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpMinus</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpMul</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpDiv</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpMod</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpBitAnd</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpBitOr</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpBitXor</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Other operators</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>OpBetween</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpCase_Simple</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>OpCase_Searched</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Conversion functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>ConvertToStringFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>ConvertToIntFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>ConvertToDoubleFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>ConvertToTimeFunction</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Numeric functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AbsFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AcosFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AsinFucntion</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AtanFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>Atan2Function</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>CeilingFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>CosFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>CotFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>DegreesFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>ExpFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>FloorFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>LogFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>Log10Function</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>ModFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>PiFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>PowerFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RadiansFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RandFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RoundFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>SignFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>SinFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>SqrtFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>TanFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>TruncateFunction</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// String functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AsciiFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>CharFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>DifferenceFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>InsertFunction</span><span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>LcaseFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>LeftFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>LengthFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>LocateFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>LtrimFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RepeatFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>ReplaceFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RightFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>RtrimFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>SoundexFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>SpaceFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>SubstringFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>UcaseFunction</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// System functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>DatabaseFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>UserFunction</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Null-handling functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>IfNullFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>NullIfFunction</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// DateTime functions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>DayNameFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>DayOfWeekFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>DayOfMonthFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>DayOfYearFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>HourFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>MinuteFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>MonthFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>MonthNameFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>NowFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>QuarterFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>SecondFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>WeekFunction</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>YearFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>DateTimeAddFunction</span> <span class='c3'>timeInterval ::</span> <span class='c6'>TimeInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>DateTimeDiffFunction</span> <span class='c3'>timeInterval ::</span> <span class='c6'>TimeInterval</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Aggregation functions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrCount</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrSum</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrAvg</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrMin</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrMax</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrDistinctCount</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrDistinctSum</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrDistinctAvg</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrCountAll</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrStdDev</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrStdDevP</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrVar</span> <span class='c3'>|</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrVarP</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>AggrOther</span><span class='c3'>&nbsp; other ::</span> <span class='c6'>String</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// A function with the specified name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>FunctionOther</span> <span class='c3'>funcName ::</span> <span class='c6'>String</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Possible</span> <span class='c2'>time</span> <span class='c2'>interval</span> <span class='c2'>values</span> <span class='c2'>for</span> <span class='c2'>working</span> <span class='c2'>with</span> <span class='c2'>date/time</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>TimeInterval</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>public</span></b> <span class='c6'>YearInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>QuarterInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>MonthInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>DayInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>HourInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>MinuteInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <b><span class='c5'>public</span></b> <span class='c6'>SecondInterval</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Indicates</span> <span class='c2'>whether</span> <span class='c2'>a</span> <span class='c2'>specified</span> <span class='c2'>function</span> <span class='c2'>is</span> <span class='c2'>an</span> <span class='c2'>aggregation</span> <span class='c2'>function</span> <span class='c2'>or</span> <span class='c2'>not.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>fn</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>function</span> <span class='c2'>identifier</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;</span> <span class='c2'>True</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>function</span> <span class='c2'>is</span> <span class='c2'>an</span> <span class='c2'>aggregation</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isAggregationFunction ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isAggregationFunction !fn =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>fn</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp; (</span><span class='c6'>AggrCount</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrSum</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrAvg</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrMin</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrMax</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctCount</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctSum</span><span class='c3'>&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctAvg</span><span class='c3'>&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrCountAll</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrStdDev</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrStdDevP</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrVar</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrVarP</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrOther</span><span class='c3'>) {} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>default</span> <span class='c2'>name</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>defaultFunctionName ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>defaultFunctionName !func =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>func</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; ConvertFunction -&gt; "CONVERT";</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AbsFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ABS"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AcosFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ACOS"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AsinFucntion</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ASIN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AtanFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ATAN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Atan2Function</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ATAN2"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CeilingFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"CEILING"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CosFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"COS"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CotFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"COT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DegreesFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DEGREES"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ExpFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"EXP"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FloorFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"FLOOR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LogFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"LOG"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Log10Function</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"LOG10"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ModFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"MOD"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PiFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"PI"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PowerFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"POWER"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RadiansFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"RADIANS"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RandFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"RAND"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RoundFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ROUND"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SignFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"SIGN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SinFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"SIN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SqrtFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"SQRT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TanFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"TAN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TruncateFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"TRUNCATE"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AsciiFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"ASCII"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CharFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"CHAR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: use the OpCat operator instead...</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; ConcatFunction&nbsp; -&gt; "CONCAT";</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DifferenceFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DIFFERENCE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"INSERT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LcaseFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"LCASE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LeftFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"LEFT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LengthFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"LENGTH"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LocateFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"LOCATE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LtrimFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"LTRIM"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RepeatFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"REPEAT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ReplaceFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"REPLACE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RightFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"RIGHT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RtrimFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"RTRIM"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SoundexFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"SOUNDEX"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SpaceFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"SPACE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubstringFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"SUBSTRING"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UcaseFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"UCASE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DatabaseFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DATABASE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>IfNullFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"IFNULL"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NullIfFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"NULLIF"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UserFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"USER"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DayNameFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DAYNAME"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DayOfWeekFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"WEEKDAY"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DayOfMonthFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DAY"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DayOfYearFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"DAYOFYEAR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>HourFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"HOUR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>MinuteFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"MINUTE"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>MonthFunction</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"MONTH"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>MonthNameFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"MONTHNAME"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NowFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"NOW"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QuarterFunction</span> <span class='c3'>-&gt;</span> <span class='c7'>"QUARTER"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SecondFunction</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>"SECOND"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; TimestampAddFunction -&gt; "TIMESTAMPADD";</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; TimestampDiffFunction -&gt; "TIMESTAMPDIFF";</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>WeekFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"WEEK"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>YearFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"YEAR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DateTimeAddFunction</span> <span class='c3'>{} -&gt;</span> <span class='c7'>"DATEADD"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DateTimeDiffFunction</span> <span class='c3'>{} -&gt;</span> <span class='c7'>"DATEDIFF"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrCount</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"COUNT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrSum</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"SUM"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrAvg</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"AVG"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrMin</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"MIN"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrMax</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"MAX"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrStdDev</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"STDDEV"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrStdDevP</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"STDDEVP"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrVar</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"VAR"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrVarP</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"VARP"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrOther</span> <span class='c3'>{other} -&gt; other;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Note:&nbsp; the following block of functions are generated specially, but names are included here for</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; purposes of outputing to Java.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctCount</span> <span class='c3'>-&gt;</span> <span class='c7'>"DISTINCT COUNT"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctSum</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"DISTINCT SUM"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrDistinctAvg</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>"DISTINCT AVG"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>AggrCountAll</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>"COUNT ALL"</span><span class='c3'>;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionOther</span> <span class='c3'>{funcName} -&gt; funcName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// SQL Functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>call</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>No</span> <span class='c2'>checking</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>done</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>number</span> <span class='c2'>or</span> <span class='c2'>types</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>arguments.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Where</span> <span class='c2'>possible</span> <span class='c2'>the</span> <span class='c2'>appropriate</span> <span class='c2'>type-safe</span> <span class='c2'>function</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>called</span> <span class='c2'>to</span> <span class='c2'>construct</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>func</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>identifier</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>arguments</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>database</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>arguments</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>call</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedFunctionExpr ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedFunctionExpr func arguments =</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func arguments;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>// Helper functions to construct typed function expressions.</span></p>
<p class="Clz"><span class='c1'>// These should not be exposed.</span></p>
<p class="Clz"><span class='c3'>functionExpr0 ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionExpr0 func =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr func []);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>functionExpr1 ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionExpr1 func arg1 =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr func [toUntypedExpr arg1]);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>functionExpr2 ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>c;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionExpr2 func arg1 arg2 =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr func [toUntypedExpr arg1, toUntypedExpr arg2]);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>functionExpr3 ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>c -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>d;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionExpr3 func arg1 arg2 arg3 =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr func [toUntypedExpr arg1, toUntypedExpr arg2, toUntypedExpr arg3]);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>functionExpr4 ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>c -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>d -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>e;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionExpr4 func arg1 arg2 arg3 arg4 =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr func [toUntypedExpr arg1, toUntypedExpr arg2, toUntypedExpr arg3, toUntypedExpr arg4]);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Unary operator expressions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>unary</span> <span class='c2'>operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>No</span> <span class='c2'>checking</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>done</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>type</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>argument.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Where</span> <span class='c2'>possible</span> <span class='c2'>the</span> <span class='c2'>appropriate</span> <span class='c2'>type-safe</span> <span class='c2'>function</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>called</span> <span class='c2'>to</span> <span class='c2'>construct</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>func</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>identifier</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>unary</span> <span class='c2'>operator</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>argument</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>which</span> <span class='c2'>the</span> <span class='c2'>unary</span> <span class='c2'>operator</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>applied</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>unary</span> <span class='c2'>operator</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedUnaryExpr ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedUnaryExpr func argument =</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func [argument];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>'not'</span> <span class='c2'>operator</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>argument.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>boolExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>'not'</span> <span class='c2'>operator</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>notExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>notExpr = functionExpr1</span> <span class='c6'>OpNot</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>bitwise</span> <span class='c2'>'not'</span> <span class='c2'>operator</span> <span class='c2'>to</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>argument.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>intExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>bitwise</span> <span class='c2'>'not'</span> <span class='c2'>operator</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>bitwiseNotExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>bitwiseNotExpr = functionExpr1</span> <span class='c6'>OpBitNot</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>negation</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>numeric</span> <span class='c2'>argument</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>numExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>negation</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>negateExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>negateExpr = functionExpr1</span> <span class='c6'>OpNegate</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>argument</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>null.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>argument</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>null</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isNullExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isNullExpr = functionExpr1</span> <span class='c6'>OpIsNull</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>argument</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>non-null.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>an</span> <span class='c2'>argument</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>non-null</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isNotNullExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isNotNullExpr = functionExpr1</span> <span class='c6'>OpIsNotNull</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>subquery</span> <span class='c2'>expression</span> <span class='c2'>returns</span> <span class='c2'>any</span> <span class='c2'>rows.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>subqueryExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>subquery</span> <span class='c2'>expressoin</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>argument</span> <span class='c2'>subquery</span> <span class='c2'>expression</span> <span class='c2'>returns</span> <span class='c2'>any</span> <span class='c2'>rows</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>existsExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>[a] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>existsExpr subqueryExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: is there any way to make this only accept subqueries?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; functionExpr1</span> <span class='c6'>OpExists</span> <span class='c3'>subqueryExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Binary operator expressions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>binary</span> <span class='c2'>operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>No</span> <span class='c2'>checking</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>done</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>types</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>arguments.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Where</span> <span class='c2'>possible</span> <span class='c2'>the</span> <span class='c2'>appropriate</span> <span class='c2'>type-safe</span> <span class='c2'>function</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>called</span> <span class='c2'>to</span> <span class='c2'>construct</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>function</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>func</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>identifier</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>binary</span> <span class='c2'>operator</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftArgument</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>left</span> <span class='c2'>argument</span> <span class='c2'>to</span> <span class='c2'>which</span> <span class='c2'>the</span> <span class='c2'>operator</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>applied</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>rightArgument</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>right</span> <span class='c2'>argument</span> <span class='c2'>to</span> <span class='c2'>which</span> <span class='c2'>the</span> <span class='c2'>operator</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>applied</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>untyped</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>application</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>binary</span> <span class='c2'>operator</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedBinaryExpr ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedBinaryExpr func leftArgument rightArgument =</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func [leftArgument, rightArgument];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>which</span> <span class='c2'>test</span> <span class='c2'>two</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>equality.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>equality</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>eqExpr ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>eqExpr = functionExpr2</span> <span class='c6'>OpEq</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>which</span> <span class='c2'>tests</span> <span class='c2'>two</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>inequality.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>for</span> <span class='c2'>inequality</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>notEqExpr ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>notEqExpr = functionExpr2</span> <span class='c6'>OpNotEq</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>less</span> <span class='c2'>than</span> <span class='c2'>the</span> <span class='c2'>second.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>less</span> <span class='c2'>than</span> <span class='c2'>the</span> <span class='c2'>second</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>ltExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ltExpr = functionExpr2</span> <span class='c6'>OpLt</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>greater</span> <span class='c2'>than</span> <span class='c2'>the</span> <span class='c2'>second.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>greater</span> <span class='c2'>than</span> <span class='c2'>the</span> <span class='c2'>second</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>gtExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>gtExpr = functionExpr2</span> <span class='c6'>OpGt</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>less</span> <span class='c2'>than</span> <span class='c2'>or</span> <span class='c2'>equal</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>second.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>less</span> <span class='c2'>than</span> <span class='c2'>or</span> <span class='c2'>equal</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>second</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>ltEqExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ltEqExpr = functionExpr2</span> <span class='c6'>OpLtEq</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>greater</span> <span class='c2'>than</span> <span class='c2'>or</span> <span class='c2'>equal</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>second.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>greater</span> <span class='c2'>than</span> <span class='c2'>or</span> <span class='c2'>equal</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>second</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>gtEqExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>gtEqExpr = functionExpr2</span> <span class='c6'>OpGtEq</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>both</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>True.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>b1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>b2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>both</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>andExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>andExpr !b1 b2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(b1 == trueConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>b2</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(b2 == trueConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>b1</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(b1 == falseConstant || b2 == falseConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>falseConstant</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>functionExpr2</span> <span class='c6'>OpAnd</span> <span class='c3'>b1 b2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>either</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>True.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>b1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>b2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>either</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>operand</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>orExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>orExpr b1 b2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(b1 == falseConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>b2</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(b2 == falseConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>b1</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(b1 == trueConstant || b2 == trueConstant)</span> <b><span class='c5'>then</span></b> <span class='c3'>trueConstant</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>functionExpr2</span> <span class='c6'>OpOr</span> <span class='c3'>b1 b2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>string</span> <span class='c2'>operand</span> <span class='c2'>expression</span> <span class='c2'>matches</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>pattern</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>strExpr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>patternExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>pattern</span> <span class='c2'>against</span> <span class='c2'>which</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>tested</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>first</span> <span class='c2'>string</span> <span class='c2'>operand</span> <span class='c2'>expression</span> <span class='c2'>matches</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>pattern</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>likeExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>likeExpr = functionExpr2</span> <span class='c6'>OpLike</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>equal</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>one</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftExpr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>listValueExprs</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>values</span> <span class='c2'>against</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>tested</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>one</span> <span class='c2'>of</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>values</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>operand</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>inExpr ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt; [</span><span class='c6'>TypedExpr</span> <span class='c3'>a] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>inExpr leftExpr listValueExprs = functionExpr2</span> <span class='c6'>OpIn</span> <span class='c3'>leftExpr (listExpr listValueExprs);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>one</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>values</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>operand</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftExpr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>listValuesExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>values</span> <span class='c2'>against</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>tested</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span> <span class='c2'>is</span> <span class='c2'>one</span> <span class='c2'>of</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>values</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>operand</span> <span class='c2'>expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>inExpr2 ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>[a] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>inExpr2 leftExpr listValuesExpr = functionExpr2</span> <span class='c6'>OpIn</span> <span class='c3'>leftExpr listValuesExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>concatenate</span> <span class='c2'>two</span> <span class='c2'>string</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>concatenate</span> <span class='c2'>the</span> <span class='c2'>string</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>concatExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>concatExpr = functionExpr2</span> <span class='c6'>OpCat</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>helper</span> <span class='c2'>function</span> <span class='c2'>for</span> <span class='c2'>constructing</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>binary</span> <span class='c2'>operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Do</span> <span class='c2'>not</span> <span class='c2'>expose</span> <span class='c2'>this.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>numBinaryExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>numBinaryExpr = functionExpr2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>add</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>add</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>addExpr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = numBinaryExpr</span> <span class='c6'>OpPlus</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>subtract</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>subtract</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>subtractExpr = numBinaryExpr</span> <span class='c6'>OpMinus</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>multiply</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>multiply</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>multiplyExpr = numBinaryExpr</span> <span class='c6'>OpMul</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>divide</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>divide</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>divideExpr&nbsp;&nbsp; = numBinaryExpr</span> <span class='c6'>OpDiv</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>return</span> <span class='c2'>the</span> <span class='c2'>modulus</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>numeric</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>return</span> <span class='c2'>the</span> <span class='c2'>modulus</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modulusExpr&nbsp; = numBinaryExpr</span> <span class='c6'>OpMod</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>helper</span> <span class='c2'>function</span> <span class='c2'>for</span> <span class='c2'>constructing</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>binary</span> <span class='c2'>operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Do</span> <span class='c2'>not</span> <span class='c2'>expose</span> <span class='c2'>this.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>intBinaryExpr ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>intBinaryExpr = functionExpr2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'and'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'and'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>bitwiseAndExpr = intBinaryExpr</span> <span class='c6'>OpBitAnd</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'or'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'or'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>bitwiseOrExpr&nbsp; = intBinaryExpr</span> <span class='c6'>OpBitOr</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'xor'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr1</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr2</span><span class='c3'>&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>operand</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>a</span> <span class='c2'>bitwise</span> <span class='c2'>'xor'</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>numeric</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>bitwiseXorExpr = intBinaryExpr</span> <span class='c6'>OpBitXor</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Other operator expressions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>which</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>one</span> <span class='c2'>operand</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>between</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>other</span> <span class='c2'>operand</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>leftExpr</span><span class='c3'>&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>tested</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>lowerExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>lower</span> <span class='c2'>bound</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>range</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>upperExpr</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>upper</span> <span class='c2'>bound</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>range</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>test</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>one</span> <span class='c2'>operand</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>between</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>other</span> <span class='c2'>operand</span> <span class='c2'>expressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>betweenExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>betweenExpr leftExpr lowerExpr upperExpr = functionExpr3</span> <span class='c6'>OpBetween</span> <span class='c3'>leftExpr lowerExpr upperExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>simple</span> <span class='c2'>case</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>When</span> <span class='c2'>this</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>evaluated,</span> <span class='c2'>the</span> <span class='c2'>result</span> <span class='c2'>value</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>matching</span> <span class='c2'>WHEN</span> <span class='c2'>clause</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>none</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>WHEN</span> <span class='c2'>values</span> <span class='c2'>match</span> <span class='c2'>the</span> <span class='c2'>case</span> <span class='c2'>value,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>ELSE</span> <span class='c2'>value</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>caseExpr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>tested</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>whenValueAndResults</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>pairs</span> <span class='c2'>of</span> <span class='c2'>comparison</span> <span class='c2'>values</span> <span class='c2'>and</span> <span class='c2'>the</span> <span class='c2'>corresponding</span> <span class='c2'>result</span> <span class='c2'>values</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>elseValue</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>if</span> <span class='c2'>none</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>WHEN</span> <span class='c2'>clauses</span> <span class='c2'>match</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>simple</span> <span class='c2'>case</span> <span class='c2'>statement</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>simpleCaseExpr ::</span> <span class='c6'>Eq</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt; [(</span><span class='c6'>TypedExpr</span> <span class='c3'>a,</span> <span class='c6'>TypedExpr</span> <span class='c3'>b)] -&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c3'>b) -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>simpleCaseExpr caseExpr whenValueAndResults elseValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unTypedExprs = toUntypedExpr caseExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : concatMap (\pr -&gt; [toUntypedExpr (fst pr), toUntypedExpr (snd pr)]) whenValueAndResults</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++ map toUntypedExpr (maybeToList elseValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr</span> <span class='c6'>OpCase_Simple</span> <span class='c3'>unTypedExprs);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Construct</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>searched</span> <span class='c2'>case</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Each</span> <span class='c2'>WHEN</span> <span class='c2'>clause</span> <span class='c2'>will</span> <span class='c2'>contain</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>expression</span> <span class='c2'>and</span> <span class='c2'>a</span> <span class='c2'>result</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>result</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>the</span> <span class='c2'>result</span> <span class='c2'>value</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>WHEN</span> <span class='c2'>clause</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>condition</span> <span class='c2'>that</span> <span class='c2'>returns</span> <span class='c2'>True.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>none</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>WHEN</span> <span class='c2'>clause</span> <span class='c2'>expressions</span> <span class='c2'>return</span> <span class='c2'>True,</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>ELSE</span> <span class='c2'>value</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>whenConditionAndResults</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>pairs</span> <span class='c2'>of</span> <span class='c2'>Boolean</span> <span class='c2'>condition</span> <span class='c2'>expressions</span> <span class='c2'>and</span> <span class='c2'>result</span> <span class='c2'>values</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>elseValue</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>if</span> <span class='c2'>none</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>WHEN</span> <span class='c2'>clauses</span> <span class='c2'>evaluate</span> <span class='c2'>to</span> <span class='c2'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>expression</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>searched</span> <span class='c2'>case</span> <span class='c2'>statement</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>searchedCaseExpr :: [(</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>,</span> <span class='c6'>TypedExpr</span> <span class='c3'>b)] -&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c3'>b) -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>searchedCaseExpr whenConditionAndResults elseValue =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unTypedExprs = concatMap (\pr -&gt; [toUntypedExpr (fst pr), toUntypedExpr (snd pr)]) whenConditionAndResults</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++ map toUntypedExpr (maybeToList elseValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(untypedFunctionExpr</span> <span class='c6'>OpCase_Searched</span> <span class='c3'>unTypedExprs);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Numeric functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>absExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>absExpr = functionExpr1</span> <span class='c6'>AbsFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>acosExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>acosExpr = functionExpr1</span> <span class='c6'>AcosFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>asinExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>asinExpr = functionExpr1</span> <span class='c6'>AsinFucntion</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>atanExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>atanExpr = functionExpr1</span> <span class='c6'>AtanFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>atan2Expr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>atan2Expr = functionExpr2</span> <span class='c6'>Atan2Function</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>ceilingExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ceilingExpr = functionExpr1</span> <span class='c6'>CeilingFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>cosExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>cosExpr = functionExpr1</span> <span class='c6'>CosFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>cotExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>cotExpr = functionExpr1</span> <span class='c6'>CotFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>degreesExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>degreesExpr = functionExpr1</span> <span class='c6'>DegreesFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>expExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>expExpr = functionExpr1</span> <span class='c6'>ExpFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>floorExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>floorExpr = functionExpr1</span> <span class='c6'>FloorFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>logExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>logExpr = functionExpr1</span> <span class='c6'>LogFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>log10Expr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>log10Expr = functionExpr1</span> <span class='c6'>Log10Function</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>modExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modExpr = functionExpr2</span> <span class='c6'>ModFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>piExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>piExpr = functionExpr0</span> <span class='c6'>PiFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>powerExpr :: (</span><span class='c6'>Num</span> <span class='c3'>a,</span> <span class='c6'>Num</span> <span class='c3'>b) =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>b -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>powerExpr = functionExpr2</span> <span class='c6'>PowerFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>radiansExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>radiansExpr = functionExpr1</span> <span class='c6'>RadiansFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>randExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>randExpr = functionExpr1</span> <span class='c6'>RandFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>roundExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>roundExpr = functionExpr2</span> <span class='c6'>RoundFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>signExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>signExpr = functionExpr1</span> <span class='c6'>SignFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>sinExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>sinExpr = functionExpr1</span> <span class='c6'>SinFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>sqrtExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>sqrtExpr = functionExpr1</span> <span class='c6'>SqrtFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>tanExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>tanExpr = functionExpr1</span> <span class='c6'>TanFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>is</span> <span class='c2'>this</span> <span class='c2'>the</span> <span class='c2'>correct</span> <span class='c2'>signature?</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>truncateExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>truncateExpr = functionExpr1</span> <span class='c6'>TruncateFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Conversion functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Converts</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>double</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>assumption</span> <span class='c2'>here</span> <span class='c2'>is</span> <span class='c2'>that</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>will</span> <span class='c2'>do</span> <span class='c2'>an</span> <span class='c2'>implicit</span> <span class='c2'>conversion</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>between</span> <span class='c2'>these</span> <span class='c2'>2</span> <span class='c2'>types,</span> <span class='c2'>so</span> <span class='c2'>no</span> <span class='c2'>function</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>applied</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>generated</span> <span class='c2'>SQL.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>function</span> <span class='c2'>could</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>here</span> <span class='c2'>if</span> <span class='c2'>necessary.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>intToDoubleExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>intToDoubleExpr expr = toTypedExpr (toUntypedExpr expr);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Converts</span> <span class='c2'>a</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertToStringExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>convertToStringExpr = functionExpr1</span> <span class='c6'>ConvertToStringFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Converts</span> <span class='c2'>a</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>int</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertToIntExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>convertToIntExpr = functionExpr1</span> <span class='c6'>ConvertToIntFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Converts</span> <span class='c2'>a</span> <span class='c2'>value</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>double</span> <span class='c2'>value.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertToDoubleExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>convertToDoubleExpr = functionExpr1</span> <span class='c6'>ConvertToDoubleFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// String functions</span></p>
<p class="Clz"><span class='c3'>asciiExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>asciiExpr = functionExpr1</span> <span class='c6'>AsciiFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>charExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>charExpr = functionExpr1</span> <span class='c6'>CharFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>differenceExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>differenceExpr = functionExpr2</span> <span class='c6'>DifferenceFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>insertExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>insertExpr stringExpr start length insertStr = functionExpr4</span> <span class='c6'>InsertFunction</span> <span class='c3'>stringExpr start length insertStr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>lcaseExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>lcaseExpr = functionExpr1</span> <span class='c6'>LcaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>leftExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>leftExpr = functionExpr2</span> <span class='c6'>LeftFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>lengthExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>lengthExpr = functionExpr1</span> <span class='c6'>LengthFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>locateExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>locateExpr searchExpr stringExpr = functionExpr2</span> <span class='c6'>LocateFunction</span> <span class='c3'>searchExpr stringExpr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>locate2Expr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>locate2Expr searchExpr stringExpr start = functionExpr3</span> <span class='c6'>LocateFunction</span> <span class='c3'>searchExpr stringExpr start;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>ltrimExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ltrimExpr = functionExpr1</span> <span class='c6'>LtrimFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>repeatExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>repeatExpr stringExpr count = functionExpr2</span> <span class='c6'>RepeatFunction</span> <span class='c3'>stringExpr count;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>replaceExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>replaceExpr stringExpr searchStr replacementStr = functionExpr3</span> <span class='c6'>ReplaceFunction</span> <span class='c3'>stringExpr searchStr replacementStr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>rightExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>rightExpr = functionExpr2</span> <span class='c6'>RightFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>rtrimExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>rtrimExpr = functionExpr1</span> <span class='c6'>RtrimFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>soundexExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>soundexExpr = functionExpr1</span> <span class='c6'>SoundexFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>spaceExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>spaceExpr nSpaces = functionExpr1</span> <span class='c6'>SpaceFunction</span> <span class='c3'>nSpaces;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>substringExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>substringExpr stringExpr start length = functionExpr3</span> <span class='c6'>SubstringFunction</span> <span class='c3'>stringExpr start length;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>ucaseExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ucaseExpr = functionExpr1</span> <span class='c6'>UcaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Misc functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>databaseExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>databaseExpr = functionExpr0</span> <span class='c6'>DatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>ifNullExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>ifNullExpr = functionExpr2</span> <span class='c6'>IfNullFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>nullIfExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>nullIfExpr = functionExpr2</span> <span class='c6'>NullIfFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>userExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>userExpr = functionExpr0</span> <span class='c6'>UserFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Date/Time functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dayNameExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dayNameExpr = functionExpr1</span> <span class='c6'>DayNameFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dayOfWeekExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dayOfWeekExpr = functionExpr1</span> <span class='c6'>DayOfWeekFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dayOfMonthExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dayOfMonthExpr = functionExpr1</span> <span class='c6'>DayOfMonthFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dayOfYearExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dayOfYearExpr = functionExpr1</span> <span class='c6'>DayOfYearFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>hourExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>hourExpr = functionExpr1</span> <span class='c6'>HourFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>minuteExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>minuteExpr = functionExpr1</span> <span class='c6'>MinuteFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>monthExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>monthExpr = functionExpr1</span> <span class='c6'>MonthFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>monthNameExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>monthNameExpr = functionExpr1</span> <span class='c6'>MonthNameFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>nowExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>nowExpr = functionExpr0</span> <span class='c6'>NowFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>quarterExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>quarterExpr = functionExpr1</span> <span class='c6'>QuarterFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>secondExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>secondExpr = functionExpr1</span> <span class='c6'>SecondFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: create helper functions for TimestampAddFunction and</span></p>
<p class="Clz"><span class='c1'>// TimestampDiffFunction...</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>weekExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>weekExpr = functionExpr1</span> <span class='c6'>WeekFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>yearExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>yearExpr = functionExpr1</span> <span class='c6'>YearFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dateTimeAddExpr ::</span> <span class='c6'>TimeInterval</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dateTimeAddExpr timeInterval =&nbsp; functionExpr2 (</span><span class='c6'>DateTimeAddFunction</span> <span class='c3'>timeInterval);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>dateTimeDiffExpr ::</span> <span class='c6'>TimeInterval</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>dateTimeDiffExpr timeInterval = functionExpr2 (</span><span class='c6'>DateTimeDiffFunction</span> <span class='c3'>timeInterval);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Aggregate functions</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>untypedAggregationExpr ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedAggregationExpr aggrOp baseExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isAggregationFunction aggrOp)</span> <b><span class='c5'>then</span></b> <span class='c6'>FunctionExpr</span> <span class='c3'>aggrOp [baseExpr]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>error</span> <span class='c7'>"The specified function is not an aggregation function."</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>countExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>countExpr = functionExpr1</span> <span class='c6'>AggrCount</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>sumExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>sumExpr = functionExpr1</span> <span class='c6'>AggrSum</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>avgExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>avgExpr = functionExpr1</span> <span class='c6'>AggrAvg</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>minExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>minExpr = functionExpr1</span> <span class='c6'>AggrMin</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>maxExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>maxExpr = functionExpr1</span> <span class='c6'>AggrMax</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>distinctCountExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>distinctCountExpr = functionExpr1</span> <span class='c6'>AggrDistinctCount</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>distinctSumExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>distinctSumExpr = functionExpr1</span> <span class='c6'>AggrDistinctSum</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>distinctAvgExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>distinctAvgExpr = functionExpr1</span> <span class='c6'>AggrDistinctAvg</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>countAllExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>countAllExpr = functionExpr0</span> <span class='c6'>AggrCountAll</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>stdDevExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>stdDevExpr = functionExpr1</span> <span class='c6'>AggrStdDev</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>stdDevPExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>stdDevPExpr = functionExpr1</span> <span class='c6'>AggrStdDevP</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>varianceExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>varianceExpr = functionExpr1</span> <span class='c6'>AggrVar</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>variancePExpr ::</span> <span class='c6'>Num</span> <span class='c3'>a =&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>variancePExpr = functionExpr1</span> <span class='c6'>AggrVarP</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>A</span> <span class='c2'>database</span> <span class='c2'>SELECT</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>Query</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; options&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>QueryOption</span><span class='c3'>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; columns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restriction&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>Maybe</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>))&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>JoinNode</span><span class='c3'>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groups&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Expr</span><span class='c3'>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupRestriction :: (</span><span class='c6'>Maybe</span> <span class='c3'>(</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>)) |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>Union</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unionAll&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Boolean</span><span class='c3'>&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Eq</span><span class='c3'>,</span> <span class='c6'>Show</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>a</span> <span class='c2'>new,</span> <span class='c2'>empty</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>newQuery ::</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>newQuery =</span> <span class='c6'>Query</span> <span class='c3'>[] []</span> <span class='c6'>Nothing</span> <span class='c3'>[] [] []</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Combines</span> <span class='c2'>the</span> <span class='c2'>2</span> <span class='c2'>queries</span> <span class='c2'>into</span> <span class='c2'>a</span> <span class='c2'>Union</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>unionQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>unionQuery query1 query2 unionAll =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query1Cols = getProjectedColumns query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query2Cols = getProjectedColumns query2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove any ordering from the first query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedQuery1 = removeOrdering query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check that the queries have the same number of columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(length query1Cols == length query2Cols)</span> <b><span class='c5'>then</span></b> <span class='c6'>Union</span> <span class='c3'>updatedQuery1 query2 unionAll</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>error</span> <span class='c7'>"Both queries in a Union must have the same number of columns"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Produces</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>returns</span> <span class='c2'>the</span> <span class='c2'>intersection</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>specified</span> <span class='c2'>queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>final</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>intersection</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>performed</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>corresponding</span> <span class='c2'>columns</span> <span class='c2'>in</span> <span class='c2'>each</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>It</span> <span class='c2'>is</span> <span class='c2'>ok</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>queries</span> <span class='c2'>to</span> <span class='c2'>have</span> <span class='c2'>different</span> <span class='c2'>numbers</span> <span class='c2'>of</span> <span class='c2'>columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>intersectionQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>intersectionQuery query1 query2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origAliases = map snd (projectedColumnsWithAliases query1);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set a known alias for the colums.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itemColumnAliases = map (\i -&gt;</span> <span class='c7'>"COL_VALUE"</span> <span class='c3'>++ (intToString i)) (upFrom</span> <span class='c7'>1</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Wrap these subqueries in tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable1 = makeSubQueryTable (setColumnAliases query1 itemColumnAliases)</span> <span class='c7'>"Q1"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable2 = makeSubQueryTable (setColumnAliases query2 itemColumnAliases)</span> <span class='c7'>"Q2"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nJoinColumns = length (zip (getProjectedColumns query1) (getProjectedColumns query2));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinInfos = map (\alias -&gt; makeJoinInfo (stringField subQueryTable1 alias) (stringField subQueryTable2 alias)</span> <span class='c6'>InnerJoin</span><span class='c3'>) (take nJoinColumns itemColumnAliases);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resultCols = zip (map (untypedField subQueryTable1) itemColumnAliases) origAliases;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join2 (projectWithAliases newQuery resultCols) joinInfos;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Produces</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>returns</span> <span class='c2'>the</span> <span class='c2'>intersection</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>specified</span> <span class='c2'>queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>final</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>intersection</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>performed</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>intersectionQuery2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Expr</span><span class='c3'>)] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>intersectionQuery2 query1 query2 compareExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origAliases = map snd (projectedColumnsWithAliases query1);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compareExprs1 =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty compareExprs)</span> <b><span class='c5'>then</span></b> <span class='c3'>getProjectedColumns query1</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>map fst compareExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compareExprs2 =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty compareExprs)</span> <b><span class='c5'>then</span></b> <span class='c3'>getProjectedColumns query2</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>map snd compareExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Ensure that all the comparison expressions are projected from both</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryAllColumns1 = projectColumnsIfNecessary query1 compareExprs1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryAllColumns2 = projectColumnsIfNecessary query2 compareExprs2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set a known alias for the colums.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itemColumnAliases = map defaultColumnAlias (upFrom</span> <span class='c7'>0</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Wrap these subqueries in tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable1 = makeSubQueryTable (setColumnAliases queryAllColumns1 itemColumnAliases)</span> <span class='c7'>"Q1"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable2 = makeSubQueryTable (setColumnAliases queryAllColumns2 itemColumnAliases)</span> <span class='c7'>"Q2"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Find the join expression for each of the comparison expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupJoinExpr origQuery subQueryTable origExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; indexInOrigQuery = fromJust (elemIndex origExpr (getProjectedColumns origQuery));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alias = defaultColumnAlias indexInOrigQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stringField subQueryTable alias;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinExprs1 = map (lookupJoinExpr queryAllColumns1 subQueryTable1) compareExprs1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;joinExprs2 = map (lookupJoinExpr queryAllColumns2 subQueryTable2) compareExprs2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinInfos = zipWith (\e1 e2 -&gt; makeJoinInfo e1 e2</span> <span class='c6'>InnerJoin</span><span class='c3'>) joinExprs1 joinExprs2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resultCols = zip (map (untypedField subQueryTable1) itemColumnAliases) origAliases;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; join2 (projectWithAliases newQuery resultCols) joinInfos;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>is</span> <span class='c2'>an</span> <span class='c2'>alternate</span> <span class='c2'>version</span> <span class='c2'>of</span> <span class='c4'>{@link</span> <span class='c2'>intersectionQuery</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Instead</span> <span class='c2'>of</span> <span class='c2'>creating</span> <span class='c2'>2</span> <span class='c2'>subqueries</span> <span class='c2'>and</span> <span class='c2'>linking</span> <span class='c2'>them,</span> <span class='c2'>this</span> <span class='c2'>function</span> <span class='c2'>creates</span> <span class='c2'>a</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>subquery</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>second</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>and</span> <span class='c2'>links</span> <span class='c2'>it</span> <span class='c2'>directly</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query</span> <span class='c2'>(although</span> <span class='c2'>special</span> <span class='c2'>handling</span> <span class='c2'>is</span> <span class='c2'>needed</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>uses</span> <span class='c4'>{@link</span> <span class='c2'>TopN</span><span class='c4'>@}</span><span class='c2'>).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>should</span> <span class='c2'>give</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>results</span> <span class='c2'>as</span> <span class='c4'>{@code</span> <span class='c2'>intersectionQuery</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>check</span> <span class='c2'>which</span> <span class='c2'>option</span> <span class='c2'>is</span> <span class='c2'>most</span> <span class='c2'>efficient</span> <span class='c2'>and</span> <span class='c2'>get</span> <span class='c2'>rid</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>other</span> <span class='c2'>one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>alternateIntersectionQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>alternateIntersectionQuery query1 query2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origAliases = map snd (projectedColumnsWithAliases query1);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set a known alias for the colums.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itemColumnAliases = map defaultColumnAlias (upFrom</span> <span class='c7'>0</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nJoinColumns = length (zip (getProjectedColumns query1) (getProjectedColumns query2));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; needToWrapQuery query = isTopNQuery query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrapQueryIfNeeded query =</span> <b><span class='c5'>if</span></b> <span class='c3'>(needToWrapQuery query)</span> <b><span class='c5'>then</span></b> <span class='c3'>wrapQuery query</span> <b><span class='c5'>else</span></b> <span class='c3'>query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedQuery1 = wrapQueryIfNeeded query1;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable2 = makeSubQueryTable (setColumnAliases query2 itemColumnAliases)</span> <span class='c7'>""</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinInfos = zipWith (\query1Col alias -&gt; makeJoinInfo (toTypedExpr query1Col) (stringField subQueryTable2 alias)</span> <span class='c6'>InnerJoin</span><span class='c3'>) (getProjectedColumns updatedQuery1) (take nJoinColumns itemColumnAliases);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setColumnAliases (join2 updatedQuery1 joinInfos) origAliases;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Produces</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>returns</span> <span class='c2'>the</span> <span class='c2'>difference</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>specified</span> <span class='c2'>queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>final</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>difference</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>performed</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>corresponding</span> <span class='c2'>columns</span> <span class='c2'>in</span> <span class='c2'>each</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>It</span> <span class='c2'>is</span> <span class='c2'>ok</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>queries</span> <span class='c2'>to</span> <span class='c2'>have</span> <span class='c2'>different</span> <span class='c2'>numbers</span> <span class='c2'>of</span> <span class='c2'>columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>differenceQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>differenceQuery query1 query2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; differenceQuery2 query1 query2 (zip (getProjectedColumns query1) (getProjectedColumns query2));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Produces</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>returns</span> <span class='c2'>the</span> <span class='c2'>difference</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>two</span> <span class='c2'>specified</span> <span class='c2'>queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>final</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>difference</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>performed</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>differenceQuery2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Expr</span><span class='c3'>)] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>differenceQuery2 query1 query2 compareExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origAliases = map snd (projectedColumnsWithAliases query1);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compareExprs1 =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty compareExprs)</span> <b><span class='c5'>then</span></b> <span class='c3'>getProjectedColumns query1</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>map fst compareExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compareExprs2 =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty compareExprs)</span> <b><span class='c5'>then</span></b> <span class='c3'>getProjectedColumns query2</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>map snd compareExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Ensure that all the comparison expressions are projected from both</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryAllColumns1 = projectColumnsIfNecessary query1 compareExprs1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryAllColumns2 = projectColumnsIfNecessary query2 compareExprs2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Take the first query, and add a restriction of the following form:</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp; NOT EXISTS (SELECT ... WHERE qry2Field1 &lt;&gt; qry1Field1 AND qry2Field2</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// &lt;&gt; qry1Field2 AND ....</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; needToWrapQuery query = isTopNQuery query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrapQueryIfNeeded query =</span> <b><span class='c5'>if</span></b> <span class='c3'>(needToWrapQuery query)</span> <b><span class='c5'>then</span></b> <span class='c3'>wrapQuery query</span> <b><span class='c5'>else</span></b> <span class='c3'>query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedQuery1 = wrapQueryIfNeeded queryAllColumns1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedQuery2 = wrapQueryIfNeeded queryAllColumns2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Find the updated expression for each of the comparison expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupUpdatedExpr origQuery updatedQuery origExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupMap = zip (getProjectedColumns origQuery) (getProjectedColumns updatedQuery);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fromJust (</span><span class='c6'>List</span><span class='c3'>.lookup origExpr lookupMap);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedCompareExprs1 = map (lookupUpdatedExpr queryAllColumns1 updatedQuery1) compareExprs1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedCompareExprs2 = map (lookupUpdatedExpr queryAllColumns2 updatedQuery2) compareExprs2;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exclusionRestrictions = zipWith (\q2Col q1Col -&gt; toTypedExpr (untypedBinaryExpr</span> <span class='c6'>OpEq</span> <span class='c3'>q2Col q1Col)) updatedCompareExprs2 updatedCompareExprs1;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exclusionExpr = notExpr (existsExpr (toTypedExpr (subQueryExpr (restrict2 updatedQuery2 exclusionRestrictions))));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restrictedQuery = restrict updatedQuery1 exclusionExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allResultExpr = getProjectedColumns restrictedQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set the correct aliases and truncate the projected columns to match</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// the original list.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; projectWithAliases (removeProjectedColumns restrictedQuery) (zip allResultExpr origAliases);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>default</span> <span class='c2'>column</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>column</span> <span class='c2'>index</span> <span class='c2'>is</span> <span class='c2'>the</span> <span class='c2'>zero-based</span> <span class='c2'>index</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query's</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>projected</span> <span class='c2'>columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>defaultColumnAlias ::</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>defaultColumnAlias colIndex =</span> <span class='c7'>"COL_VALUE"</span> <span class='c3'>++ (intToString (colIndex +</span> <span class='c7'>1</span><span class='c3'>));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns,</span> <span class='c2'>if</span> <span class='c2'>it</span> <span class='c2'>isn't</span> <span class='c2'>already</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>projected.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectColumnIfNecessary ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>projectColumnIfNecessary !query !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isElem expr (getProjectedColumns query))</span> <b><span class='c5'>then</span></b> <span class='c3'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>project query [expr];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns,</span> <span class='c2'>if</span> <span class='c2'>they</span> <span class='c2'>aren't</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>already</span> <span class='c2'>projected.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectColumnsIfNecessary ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>projectColumnsIfNecessary query exprs = foldLeftStrict projectColumnIfNecessary query exprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Wraps</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>in</span> <span class='c2'>an</span> <span class='c2'>outer</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>projects</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>columns</span> <span class='c2'>as</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>original.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>ordering</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>original</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>also</span> <span class='c2'>preserved.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>wrapQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>wrapQuery query = fst (wrapQuery2 query []);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Wraps</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>in</span> <span class='c2'>an</span> <span class='c2'>outer</span> <span class='c2'>query</span> <span class='c2'>which</span> <span class='c2'>projects</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>columns</span> <span class='c2'>as</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>original.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>ordering</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>original</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>also</span> <span class='c2'>preserved.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>wrapped</span> <span class='c2'>query</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>along</span> <span class='c2'>with</span> <span class='c2'>wrapped</span> <span class='c2'>versions</span> <span class='c2'>of</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>specified</span> <span class='c2'>additional</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>wrapQuery2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt; (</span><span class='c6'>Query</span><span class='c3'>, [</span><span class='c6'>Expr</span><span class='c3'>]);</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>wrapQuery2 query additionalExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origAliases = projectedColumnAliases query ++ repeat</span> <span class='c7'>""</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; originalOrdering = orderingExpressions query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;origProjectedExprs = getProjectedColumns query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origOrderingExprs = map fst originalOrdering;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; additionalProjectedExprs = deleteFirsts (removeDuplicates (origOrderingExprs ++ additionalExprs)) origProjectedExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; itemColumnAliases = map defaultColumnAlias (upFrom</span> <span class='c7'>0</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQueryTable = makeSubQueryTable (setColumnAliases (project query additionalProjectedExprs) itemColumnAliases)</span> <span class='c7'>""</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allSubqueryProjectedExprs = origProjectedExprs ++ additionalProjectedExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappedQueryExprs = map (untypedField subQueryTable) itemColumnAliases;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappedQueryProjectedExprs = take (length origProjectedExprs) wrappedQueryExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprMap = zip allSubqueryProjectedExprs wrappedQueryExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupNewExpr origExpr = lookupWithDefault origExpr exprMap (</span><span class='c6'>error</span> <span class='c7'>"Failed to find expression in wrapped query"</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Preverse the ordering from the original query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newOrdering = map (\pr -&gt; (lookupNewExpr (fst pr), snd pr)) originalOrdering;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappedQuery = order2 (projectWithAliases newQuery (zip wrappedQueryProjectedExprs origAliases)) newOrdering;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wrappedAdditionalExprs = map lookupNewExpr additionalExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (wrappedQuery, wrappedAdditionalExprs);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>query</span> <span class='c2'>field</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>untypedField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>untypedField table fieldName =</span> <span class='c6'>QueryField</span> <span class='c3'>fieldName table;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>stringField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>stringField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>booleanField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>booleanField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>doubleField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Double</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>doubleField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>intField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>intField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>timeField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>timeField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>binaryField ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>Array</span> <span class='c6'>Byte</span><span class='c3'>);</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>binaryField table fieldName =</span> <span class='c6'>TypedExpr</span> <span class='c3'>(</span><span class='c6'>QueryField</span> <span class='c3'>fieldName table);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>options.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>queries,</span> <span class='c2'>this</span> <span class='c2'>will</span> <span class='c2'>return</span> <span class='c2'>the</span> <span class='c2'>options</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>queryOptions ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryOption</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>queryOptions query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{options} -&gt; options;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1}&nbsp; -&gt; queryOptions query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>an</span> <span class='c2'>option</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>addOption ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>addOption !query !newOption =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>(removeOption query newOption)</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>(options ++ [newOption]) columns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Add the option to both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(addOption query1 newOption) (addOption query2 newOption) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>the</span> <span class='c2'>option</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>type</span> <span class='c2'>as</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>one</span> <span class='c2'>(even</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>exact</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>values</span> <span class='c2'>don't</span> <span class='c2'>match).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeOption ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeOption query optionTypeToRemove =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remainingOptions = filter (\o -&gt; not (isSameOptionType optionTypeToRemove o)) options;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>remainingOptions columns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove the option from both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeOption query1 optionTypeToRemove) (removeOption query2 optionTypeToRemove) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>options</span> <span class='c2'>are</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>type</span> <span class='c2'>(not</span> <span class='c2'>necessarily</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>value).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isSameOptionType ::</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>isSameOptionType !option1 !option2 =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>option1</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Distinct</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>option2</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Distinct</span> <span class='c3'>-&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TopN</span> <span class='c3'>{} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>option2</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TopN</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>TopN</span><span class='c4'>@}</span> <span class='c2'>option</span> <span class='c2'>is</span> <span class='c2'>specified</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isTopNQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>isTopNQuery !query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{options} -&gt; any isTopNOption options;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether either query is a topN query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2} -&gt; isTopNQuery query1 || isTopNQuery query2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>result</span> <span class='c2'>column</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectColumn ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectColumn query newColumn =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; project query [toUntypedExpr newColumn];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>result</span> <span class='c2'>column</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectColumnWithAlias ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectColumnWithAlias query newColumn columnAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; projectWithAliases query [(toUntypedExpr newColumn, columnAlias)];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions</span> <span class='c2'>as</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>project ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>project query newColumns =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumnsAndAliases = zip newColumns (repeat</span> <span class='c7'>""</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; projectWithAliases query newColumnsAndAliases;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions</span> <span class='c2'>as</span> <span class='c2'>result</span> <span class='c2'>columns</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>corresponding</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>aliases</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>don't</span> <span class='c2'>add</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>field</span> <span class='c2'>multiple</span> <span class='c2'>times...</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectWithAliases ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectWithAliases query newColumns =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options (columns ++ newColumns) restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Product the column in both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(projectWithAliases query1 newColumns) (projectWithAliases query2 newColumns) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>query,</span> <span class='c2'>this</span> <span class='c2'>will</span> <span class='c2'>return</span> <span class='c2'>only</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>rename</span> <span class='c2'>this</span> <span class='c2'>to</span> <span class='c2'>projectedColumns...</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getProjectedColumns ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getProjectedColumns query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns} -&gt; map fst columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1}&nbsp; -&gt; getProjectedColumns query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>query,</span> <span class='c2'>this</span> <span class='c2'>will</span> <span class='c2'>return</span> <span class='c2'>only</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectedColumnsWithAliases ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectedColumnsWithAliases query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns} -&gt; columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1}&nbsp; -&gt; projectedColumnsWithAliases query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>aliases</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query's</span> <span class='c2'>projected</span> <span class='c2'>columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectedColumnAliases ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectedColumnAliases query = map snd (projectedColumnsWithAliases query);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>all</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeProjectedColumns ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeProjectedColumns query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options [] restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove the projected columns from both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeProjectedColumns query1) (removeProjectedColumns query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>list.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>queries,</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>removed</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>both</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>queries</span> <span class='c2'>along</span> <span class='c2'>with</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>corresponding</span> <span class='c2'>columns</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>other</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeProjectedColumn ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeProjectedColumn query exprToRemove =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options (filter (\c -&gt; (fst c) != exprToRemove) columns) restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprIndicesInQuery qry =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>qry</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>List</span><span class='c3'>.findIndices (\c -&gt; fst c == exprToRemove) columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2} -&gt; removeDuplicates (exprIndicesInQuery query1 ++ exprIndicesInQuery query2);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Determine the combined set of indices to be removed.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; indicesToRemove = exprIndicesInQuery query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove the appropriate columns from a query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeExprs qry =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>qry</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns = map snd (filter (\pr -&gt; not (isElem (fst pr) indicesToRemove)) (zip (upFrom</span> <span class='c7'>0</span><span class='c3'>) columns));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options newColumns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeExprs query1) (removeExprs query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeExprs query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Sets</span> <span class='c2'>the</span> <span class='c2'>aliases</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>N</span> <span class='c2'>projected</span> <span class='c2'>columns.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Any</span> <span class='c2'>other</span> <span class='c2'>existing</span> <span class='c2'>aliases</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>left</span> <span class='c2'>untouched.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>setColumnAliases ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>setColumnAliases query newAliases =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oldAliases = map snd columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; projectedExprs = map fst columns;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finalAliases = newAliases ++ (drop (length newAliases) oldAliases);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns = zip projectedExprs finalAliases;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options newColumns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set the column aliases in both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(setColumnAliases query1 newAliases) (setColumnAliases query2 newAliases) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>a</span> <span class='c2'>restriction</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>rows</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>restrict ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>restrict !query !newRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Returns a list of expressions which are ANDed together, if any.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getAndedExprs ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt; [</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getAndedExprs expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>(toUntypedExpr) expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>func</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpAnd</span> <span class='c3'>-&gt; concatMap (</span><span class='c6'>Prelude</span><span class='c3'>.compose getAndedExprs toTypedExpr) arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [expr];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [expr];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restrictHelper ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restrictHelper !query !newRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mergedRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; newRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionValue -&gt; andExpr restrictionValue newRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mergedGroupRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>groupRestriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; newRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span><span class='c3'>groupRestrictionValue -&gt; andExpr groupRestrictionValue newRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Don't change anything if the new criteria is simply</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// 'True'.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(newRestriction == trueConstant)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(isGroupRestriction newRestriction)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups (</span><span class='c6'>Just</span> <span class='c3'>mergedGroupRestriction)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns (</span><span class='c6'>Just</span> <span class='c3'>mergedRestriction) orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Restrict both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(restrict query1 newRestriction) (restrict query2 newRestriction) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Split up the restriction into separate ANDed expressions and apply</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// each individually.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// This is needed in cases where the restriction expression contains</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// some record restrictions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// and some group restrictions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foldLeftStrict restrictHelper query (getAndedExprs newRestriction);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>restrictions</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>rows</span> <span class='c2'>returned</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>restrict2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>restrict2 query newRestrictions =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; foldLeftStrict restrict query newRestrictions;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>restriction</span> <span class='c2'>expression</span> <span class='c2'>applies</span> <span class='c2'>to</span> <span class='c2'>groups</span> <span class='c2'>or</span> <span class='c2'>record</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isGroupRestriction ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>isGroupRestriction restriction = exprUsesAggregation (toUntypedExpr restriction);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>uses</span> <span class='c2'>aggregate</span> <span class='c2'>functions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>is</span> <span class='c2'>there</span> <span class='c2'>anything</span> <span class='c2'>else</span> <span class='c2'>to</span> <span class='c2'>look</span> <span class='c2'>for?</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>exprUsesAggregation ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>exprUsesAggregation expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp; (</span><span class='c6'>QueryField</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span><span class='c3'>) {} -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt; any exprUsesAggregation listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt; isAggregationFunction func || (any exprUsesAggregation arguments);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>restriction</span> <span class='c2'>expressions</span> <span class='c2'>(including</span> <span class='c2'>group</span> <span class='c2'>restrictions)</span> <span class='c2'>for</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>query,</span> <span class='c2'>this</span> <span class='c2'>only</span> <span class='c2'>returns</span> <span class='c2'>the</span> <span class='c2'>restrictions</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>restrictionExpressions ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>restrictionExpressions query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{restriction, groupRestriction} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>Prelude</span><span class='c3'>.maybeToList restriction) ++ (</span><span class='c6'>Prelude</span><span class='c3'>.maybeToList groupRestriction);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restrictionExpressions query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>sorting</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>order ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>order query sortExpr sortAscending = order2 query [(toUntypedExpr sortExpr, sortAscending)];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>sorting</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>fields.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>order2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>order2 query newOrderings =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction (orderings ++ newOrderings) joins groups groupRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Add ordering to only the 2nd query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 (order2 query2 newOrderings) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>ordering</span> <span class='c2'>info</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>orderingExpressions ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>orderingExpressions query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{orderings} -&gt;&nbsp; orderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query2} -&gt; orderingExpressions query2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>all</span> <span class='c2'>ordering</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeOrdering ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeOrdering query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction [] joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// Remove ordering from both queries (even though the first one</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// shouldn't have any ordering to begin with).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeOrdering query1) (removeOrdering query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Projects</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expressions</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>and</span> <span class='c2'>group</span> <span class='c2'>and</span> <span class='c2'>order</span> <span class='c2'>(ASC)</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>projectGroupAndOrder ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>projectGroupAndOrder !query !exprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; order2 (group2 (project query exprs) exprs) (zip exprs $ repeat</span> <span class='c6'>True</span><span class='c3'>);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>a</span> <span class='c2'>join</span> <span class='c2'>between</span> <span class='c2'>2</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>join ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinInfo</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>join !query newJoinInfo =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newJoinNodes = applyJoinInfo joins newJoinInfo;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings newJoinNodes groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Add the join to both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(join query1 newJoinInfo) (join query2 newJoinInfo) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>joins</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>join2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinInfo</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>join2 query newJoins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; foldLeft join query newJoins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>join</span> <span class='c2'>nodes</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>addJoins ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>addJoins query newJoins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; setJoins query (joins query ++ newJoins);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Sets</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>information</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>node</span> <span class='c2'>trees.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>will</span> <span class='c2'>replace</span> <span class='c2'>any</span> <span class='c2'>existing</span> <span class='c2'>join</span> <span class='c2'>info.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>setJoins ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>setJoins query newJoins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings (cleanupJoinNodes newJoins) groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Set the joins in both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(setJoins query1 newJoins) (setJoins query2 newJoins) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>information</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>Union</span><span class='c4'>@}</span> <span class='c2'>query,</span> <span class='c2'>the</span> <span class='c2'>joins</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>joins ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>joins query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{joins} -&gt; joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1} -&gt; joins query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>join</span> <span class='c2'>tree</span> <span class='c2'>based</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>items.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>will</span> <span class='c2'>throw</span> <span class='c2'>an</span> <span class='c2'>error</span> <span class='c2'>if</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>set</span> <span class='c2'>of</span> <span class='c2'>joins</span> <span class='c2'>cannot</span> <span class='c2'>be</span> <span class='c2'>produced</span> <span class='c2'>from</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>items</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>(which</span> <span class='c2'>would</span> <span class='c2'>likely</span> <span class='c2'>mean</span> <span class='c2'>that</span> <span class='c2'>there</span> <span class='c2'>are</span> <span class='c2'>tables</span> <span class='c2'>or</span> <span class='c2'>groups</span> <span class='c2'>of</span> <span class='c2'>tables</span> <span class='c2'>which</span> <span class='c2'>are</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>not</span> <span class='c2'>linked</span> <span class='c2'>in</span> <span class='c2'>some</span> <span class='c2'>way).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildJoinTree :: [</span><span class='c6'>JoinInfo</span><span class='c3'>] -&gt;</span> <span class='c6'>JoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>buildJoinTree joinInfo =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTrees = foldLeftStrict applyJoinInfo [] joinInfo;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty joinInfo)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>error</span> <span class='c7'>"No join info items were specified"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(isSingletonList joinTrees)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; head joinTrees</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>error</span> <span class='c7'>"The join info items could not be combined into a single join tree"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Apply</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>join</span> <span class='c2'>info</span> <span class='c2'>item</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>nodes.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>new</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>top-level</span> <span class='c2'>join</span> <span class='c2'>nodes.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>applyJoinInfo :: [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>JoinInfo</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>applyJoinInfo !oldNodes !joinInfo =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinInfo</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinInfo</span> <span class='c3'>{leftTable, rightTable, fieldJoinExprs, joinType} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Returns whether the join node subtree contains a node for the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// specified table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinSubtreeIncludesTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinSubtreeIncludesTable table node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{table=joinTable} -&gt; table == joinTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (joinSubtreeIncludesTable table leftNode) || (joinSubtreeIncludesTable table rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Determine which join trees contain the left and right tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// The first item, if any, in each list will be the join tree</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// containing the appropriate table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftResults&nbsp; = snd (</span><span class='c6'>List</span><span class='c3'>.break (joinSubtreeIncludesTable leftTable) oldNodes);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightResults = snd (</span><span class='c6'>List</span><span class='c3'>.break (joinSubtreeIncludesTable rightTable) oldNodes);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftTableTree&nbsp; =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>leftResults</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt;</span> <span class='c6'>JoinTable</span> <span class='c3'>leftTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftResultsHead : _ -&gt; leftResultsHead;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTableTree =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>rightResults</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt;</span> <span class='c6'>JoinTable</span> <span class='c3'>rightTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightResultsHead : _ -&gt; rightResultsHead;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether both tables are already used in the same join node</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// tree.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesFromSameTree = (length leftResults == length rightResults) &amp;&amp; not (isEmpty leftResults);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Combine the individual field join expressions into a single</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// linking expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkingExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkingExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>fieldJoinExprs</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt;</span> <span class='c6'>error</span> <span class='c7'>"No field join expressions were specified for a join."</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>List</span><span class='c3'>.foldRight1 andExpr fieldJoinExprs;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: is this correct?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Construct a new join node tree which includes the join between</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// the left and right tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newNode =</span> <b><span class='c5'>if</span></b> <span class='c3'>(tablesFromSameTree)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addLinkExprInSubtree leftTableTree</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>leftTableTree rightTableTree linkingExpr joinType;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If the left and right tables already belong to the same join</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// tree, then the linking criteria</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// will need to be added to an existing join node in this tree.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// This will be added to the first node (closest to the table nodes)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// that has both tables in its subtree.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addLinkExprInSubtree ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addLinkExprInSubtree node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{} -&gt; node;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode, linkingExpr=oldLinkingExpr, joinType} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</span><span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: perhaps the join types should be compared (and</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// an error raised if they are not compatible).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It would also be important to check whether the join</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// is reversed in this case.</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// This will return whether this is the first node which</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// has the 2 tables in common.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isCommonNodeForTables ::</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isCommonNodeForTables =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{} -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (joinSubtreeIncludesTable leftTable leftNode) &amp;&amp; (joinSubtreeIncludesTable rightTable rightNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; || (joinSubtreeIncludesTable rightTable leftNode) &amp;&amp; (joinSubtreeIncludesTable leftTable rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; combinedLinkingExpr = andExpr oldLinkingExpr linkingExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b><span class='c3'>(isCommonNodeForTables)</span> <b><span class='c5'>then</span></b> <span class='c6'>JoinSubtree</span> <span class='c3'>leftNode rightNode combinedLinkingExpr joinType</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>JoinSubtree</span><span class='c3'>(addLinkExprInSubtree leftNode) (addLinkExprInSubtree rightNode) linkingExpr joinType;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Remove the appropriate node(s) from the old list of join trees.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodesToPreserve = filter (\node -&gt; not (joinSubtreeIncludesTable leftTable node || joinSubtreeIncludesTable rightTable node)) oldNodes;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newNodes = cleanupJoinNodes (newNode : nodesToPreserve);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: remove this debugging code later...</span></p>
<p class="Clz"><span class='c1'>//Debug.trace ("applyJoinInfo: " ++ (show leftTable) ++ " to " ++ (show</span></p>
<p class="Clz"><span class='c1'>// rightTable) ++ "\n result = " ++ (showJoinNodes newNodes) ++ "\n\n")</span></p>
<p class="Clz"><span class='c1'>// newNodes;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newNodes;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Connects</span> <span class='c2'>up</span> <span class='c2'>any</span> <span class='c2'>separate</span> <span class='c2'>join</span> <span class='c2'>trees</span> <span class='c2'>with</span> <span class='c2'>common</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Also,</span> <span class='c2'>clean</span> <span class='c2'>up</span> <span class='c2'>any</span> <span class='c2'>unlinked</span> <span class='c2'>tables</span> <span class='c2'>which</span> <span class='c2'>also</span> <span class='c2'>are</span> <span class='c2'>included</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>join.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>cleanupJoinNodes :: [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>cleanupJoinNodes joinNodes =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allJoinTables :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allJoinTables = concatMap getJoinTreeTables joinNodes;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesWithSpecifiedAlias :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesWithSpecifiedAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filter (\t -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>t</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableRef, tableAlias} -&gt; getTableNameFromReference tableRef != tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allJoinTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixTableName table = fromMaybe table (find (equals table) tablesWithSpecifiedAlias);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixJoinTableNames join =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>join</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>table -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>(fixTableName table);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>leftNode rightNode linkingExpr joinType -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>(fixJoinTableNames leftNode) (fixJoinTableNames rightNode) linkingExpr joinType;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinNodesWithFixedTableNames :: [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinNodesWithFixedTableNames = map fixJoinTableNames joinNodes;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Removed any unjoined tables which are included in a join.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cleanupUnjoinedTables :: [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cleanupUnjoinedTables joinNodes =</span></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isUnlinkedTable node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getUnlinkedTable node = node.</span><span class='c6'>JoinTable</span><span class='c3'>.table;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isTableUsedInJoin table =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinSubtreeNodes = filter (compose not isUnlinkedTable) joinNodes;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesUsedInJoins = removeDuplicates (concatMap getJoinTreeTables joinSubtreeNodes);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isElem table tablesUsedInJoins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filter (\n -&gt; not (isUnlinkedTable n &amp;&amp; isTableUsedInJoin (getUnlinkedTable n))) joinNodes;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Combine join trees with tables in common, where possible.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; consolidateJoinNodes :: [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; consolidateJoinNodes nodes =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>nodes</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n : ns -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nTables&nbsp; = getJoinTreeTables n;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nsTables = removeDuplicates (concatMap getJoinTreeTables ns);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesOverlap = not (isEmpty (intersect nTables nsTables));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Attempt to break the first node into a list of JoinInfo</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// items.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodeJoinInfos :: [</span><span class='c6'>JoinInfo</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodeJoinInfos = joinNodeToJoinInfo n;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If the first node has tables in common with one or more</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// of the other nodes</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// then attempt to break it into JoinInfo items and apply</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// them to the remaining nodes.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(tablesOverlap &amp;&amp; not (isEmpty nodeJoinInfos))</span> <b><span class='c5'>then</span></b> <span class='c3'>foldLeftStrict applyJoinInfo ns nodeJoinInfos</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>n : consolidateJoinNodes ns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; consolidateJoinNodes (cleanupUnjoinedTables joinNodesWithFixedTableNames);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Attempts</span> <span class='c2'>to</span> <span class='c2'>break</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>JoinNode</span><span class='c4'>@}</span> <span class='c2'>into</span> <span class='c2'>one</span> <span class='c2'>or</span> <span class='c2'>more</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>JoinInfo@}s.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>empty</span> <span class='c2'>list</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>node</span> <span class='c2'>could</span> <span class='c2'>not</span> <span class='c2'>be</span> <span class='c2'>represented</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>using</span> <span class='c4'>{@code</span> <span class='c2'>JoinInfo@}s.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>instead</span> <span class='c2'>of</span> <span class='c2'>converting</span> <span class='c2'>JoinNodes</span> <span class='c2'>to</span> <span class='c2'>JoinInfo,</span> <span class='c2'>it</span> <span class='c2'>would</span> <span class='c2'>be</span> <span class='c2'>better</span> <span class='c2'>to</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>combine</span> <span class='c2'>JoinNodes</span> <span class='c2'>directly...</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>joinNodeToJoinInfo ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinInfo</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>joinNodeToJoinInfo joinNode =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinNode</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode, linkingExpr, joinType} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftTables&nbsp; = getJoinTreeTables leftNode;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTables = getJoinTreeTables rightNode;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkExprTables = getExpressionTables</span> <span class='c6'>False</span> <span class='c3'>(toUntypedExpr linkingExpr);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftTable&nbsp; =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isSingletonList leftTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>listToMaybe leftTables</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>find (\t -&gt; isElem t linkExprTables) leftTables;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightTable =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isSingletonList rightTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>listToMaybe rightTables</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>find (\t -&gt; isElem t linkExprTables) rightTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftJoinInfos&nbsp; = joinNodeToJoinInfo leftNode;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rightJoinInfos = joinNodeToJoinInfo leftNode;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinInfos =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>leftTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>leftTableValue -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>rightTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span class='c6'>Nothing</span> <span class='c3'>-&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>rightTableValue -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [makeJoinInfo2 leftTableValue rightTableValue linkingExpr joinType];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; leftJoinInfos ++ rightJoinInfos ++ joinInfos;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Forces</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>included</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>even</span> <span class='c2'>if</span> <span class='c2'>no</span> <span class='c2'>fields</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>from</span> <span class='c2'>it</span> <span class='c2'>are</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>rest</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>addUnjoinedTable ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>addUnjoinedTable query newUnjoinedTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Only add the unjoined table if it doesn't already appear in the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// join trees.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTables = concatMap getJoinTreeTables joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newJoins =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isElem newUnjoinedTable joinTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>joins</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>joins ++ [</span><span class='c6'>JoinTable</span> <span class='c3'>newUnjoinedTable];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings newJoins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Add the table to both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(addUnjoinedTable query1 newUnjoinedTable) (addUnjoinedTable query2 newUnjoinedTable) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>grouping</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>groupUntyped ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>groupUntyped !query newGroup =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; group2 query [newGroup];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>grouping</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>group ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>group query newGroup = groupUntyped query (toUntypedExpr newGroup);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>grouping</span> <span class='c2'>on</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>fields.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>group2 ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>group2 query groupFields =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins (groups ++ groupFields) groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Add grouping to both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(group2 query1 groupFields) (group2 query2 groupFields) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>tables</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>will</span> <span class='c2'>only</span> <span class='c2'>include</span> <span class='c2'>fields</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>subqueries</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>option</span> <span class='c2'>is</span> <span class='c2'>specified.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getQueryTables ::</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getQueryTables includeSubqueryTables query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns, restriction, orderings, joins, groups, groupRestriction} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; columnExprs = map fst columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restrictionExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionValue -&gt; [toUntypedExpr restrictionValue];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupRestrictionExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>groupRestriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span><span class='c3'>groupRestrictionValue -&gt; [toUntypedExpr groupRestrictionValue];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderingExprs = map fst orderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allExprs = columnExprs ++ restrictionExprs ++ orderingExprs ++ groups ++ groupRestrictionExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprTables = concatMap (getExpressionTables includeSubqueryTables) allExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAndSubTables queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>BaseTable</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {} -&gt; [queryTable];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{subquery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>if</span></b><span class='c3'>(includeSubqueryTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>queryTable : getQueryTables</span> <span class='c6'>True</span> <span class='c3'>subquery</span> <b><span class='c5'>else</span></b> <span class='c3'>[queryTable];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTablesOnly = concatMap getJoinTreeTables joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTablesAndSubTables = concatMap tableAndSubTables joinTablesOnly;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTables =</span> <b><span class='c5'>if</span></b><span class='c3'>(includeSubqueryTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>joinTablesAndSubTables</span> <b><span class='c5'>else</span></b> <span class='c3'>joinTablesOnly;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicates (exprTables ++ joinTables);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicates ((getQueryTables includeSubqueryTables query1) ++ (getQueryTables includeSubqueryTables query2));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>all</span> <span class='c2'>the</span> <span class='c2'>tables</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getExpressionTables ::</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getExpressionTables includeSubqueryTables expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expressionTablesHelper expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{fieldName, queryTable} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>BaseTable</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {} -&gt; [queryTable];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{subquery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b><span class='c3'>includeSubqueryTables</span> <b><span class='c5'>then</span></b> <span class='c3'>queryTable : getQueryTables</span> <span class='c6'>True</span> <span class='c3'>subquery</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>[queryTable];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{} -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span><span class='c3'>&nbsp; {listValues} -&gt; concatMap expressionTablesHelper listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{arguments} -&gt; concatMap expressionTablesHelper arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{subquery} -&gt;</span> <b><span class='c5'>if</span></b><span class='c3'>(includeSubqueryTables)</span> <b><span class='c5'>then</span></b> <span class='c3'>getQueryTables</span> <span class='c6'>True</span> <span class='c3'>subquery</span> <b><span class='c5'>else</span></b> <span class='c3'>[];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicates (expressionTablesHelper expr);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>columns</span> <span class='c2'>that</span> <span class='c2'>belong</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>table</span> <span class='c2'>and</span> <span class='c2'>that</span> <span class='c2'>are</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>referenced</span> <span class='c2'>from</span> <span class='c2'>within</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>query.</span> <span class='c2'>Only</span> <span class='c2'>references</span> <span class='c2'>from</span> <span class='c2'>joins</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>and</span> <span class='c2'>QueryField</span> <span class='c2'>expressions</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>projected</span> <span class='c2'>columns</span> <span class='c2'>are</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>NOTE:</span> <span class='c2'>This</span> <span class='c2'>method</span> <span class='c2'>was</span> <span class='c2'>written</span> <span class='c2'>to</span> <span class='c2'>support</span> <span class='c2'>the</span> <span class='c2'>UBO</span> <span class='c2'>PoC,</span> <span class='c2'>so</span> <span class='c2'>it</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>meant</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>generally</span> <span class='c2'>useful.</span><span class='c3'>&nbsp;</span> <span class='c2'>See</span> <span class='c2'>module</span> <span class='c2'>AggregationInfo.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span> <span class='c2'>The</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>targetTable</span> <span class='c2'>The</span> <span class='c2'>table</span> <span class='c2'>we're</span> <span class='c2'>searching</span> <span class='c2'>for</span> <span class='c2'>references</span> <span class='c2'>to.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>A</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>expressions</span> <span class='c2'>that</span> <span class='c2'>represent</span> <span class='c2'>the</span> <span class='c2'>columns</span> <span class='c2'>belonging</span> <span class='c2'>to</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>targetTable.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getColumnsForTable ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getColumnsForTable query targetTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns, joins} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Search the list of columns for references to the given table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Only look for QueryField references, not references contained in</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// functions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; columnExprs = map fst columns;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprFilter ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprFilter expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{fieldName, queryTable} -&gt; queryTable == targetTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filteredColumns = filter exprFilter columnExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Search the list of joins for references to the given table.&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Include references inside functions because these are part of the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// join expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getColumnsFromExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getColumnsFromExpr expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{queryTable} -&gt;</span> <b><span class='c5'>if</span></b> <span class='c3'>(queryTable == targetTable)</span> <b><span class='c5'>then</span></b> <span class='c3'>[expr]</span> <b><span class='c5'>else</span></b><span class='c3'>&nbsp; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{arguments} -&gt; concatMap getColumnsFromExpr arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getColumnsFromJoins ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getColumnsFromJoins joinNode =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinNode</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{} -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode, linkingExpr} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expr = toUntypedExpr linkingExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (getColumnsFromExpr expr)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++ (getColumnsFromJoins leftNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++ (getColumnsFromJoins rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filteredJoins = concatMap getColumnsFromJoins joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicates (filteredColumns ++ filteredJoins);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>all</span> <span class='c2'>the</span> <span class='c2'>leaf</span> <span class='c2'>tables</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>join</span> <span class='c2'>tree.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getJoinTreeTables ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getJoinTreeTables rootJoinNode =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getTablesHelper node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{table} -&gt; [table];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt; (getTablesHelper leftNode) ++ (getTablesHelper rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeDuplicates (getTablesHelper rootJoinNode);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>all</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyTablesInQuery :: (</span><span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>) -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyTablesInQuery updateTableFn !query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;updateTypedExprTables ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateTypedExprTables expr = toTypedExpr (modifyTablesInExpr updateTableFn (toUntypedExpr expr));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateOrderingTables :: (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>) -&gt; (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateOrderingTables ordering = (modifyTablesInExpr updateTableFn (fst ordering), snd ordering);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns = map (\pr -&gt; (modifyTablesInExpr updateTableFn (fst pr), snd pr)) columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionValue -&gt;</span> <span class='c6'>Just</span> <span class='c3'>(updateTypedExprTables restrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroupRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>groupRestriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span><span class='c3'>groupRestrictionValue -&gt;</span> <span class='c6'>Just</span> <span class='c3'>(updateTypedExprTables groupRestrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newOrderings = map updateOrderingTables orderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newJoins = map (modifyTablesInJoinNode updateTableFn) joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroups = map (modifyTablesInExpr updateTableFn) groups;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options newColumns newRestriction newOrderings newJoins newGroups newGroupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(modifyTablesInQuery updateTableFn&nbsp; query1) (modifyTablesInQuery updateTableFn&nbsp; query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>all</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyTablesInExpr :: (</span><span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>) -&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyTablesInExpr updateTableFn !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{fieldName, queryTable} -&gt;</span> <span class='c6'>QueryField</span> <span class='c3'>fieldName (updateTableFn queryTable);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{} -&gt; expr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt;</span> <span class='c6'>ListExpr</span> <span class='c3'>(map (modifyTablesInExpr updateTableFn) listValues);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func (map (modifyTablesInExpr updateTableFn) arguments);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{subquery} -&gt;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>(modifyTablesInQuery updateTableFn subquery);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>all</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>typed</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyTablesInTypedExpr :: (</span><span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>) -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyTablesInTypedExpr updateTableFn !typedExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; toTypedExpr (modifyTablesInExpr updateTableFn (toUntypedExpr typedExpr));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>all</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>node.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyTablesInJoinNode :: (</span><span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>) -&gt;</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyTablesInJoinNode updateTableFn !join =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateBooleanExprTables ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateBooleanExprTables expr = toTypedExpr (modifyTablesInExpr updateTableFn (toUntypedExpr expr));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>join</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>table -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>(updateTableFn table);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>leftNode rightNode linkingExpr joinType -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span><span class='c3'>(modifyTablesInJoinNode updateTableFn leftNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (modifyTablesInJoinNode updateTableFn rightNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (updateBooleanExprTables linkingExpr) joinType;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>table</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>all</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>join</span> <span class='c2'>set.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyTablesInJoinSet :: (</span><span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span><span class='c3'>) -&gt;</span> <span class='c6'>JoinSet</span> <span class='c3'>-&gt;</span> <span class='c6'>JoinSet</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyTablesInJoinSet updateTableFn !joinSet =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinSet</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSet</span> <span class='c3'>{name, joins} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSet</span> <span class='c3'>name (modifyTablesInJoinNode updateTableFn joins);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Applies</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>query</span> <span class='c2'>modification</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>and</span> <span class='c2'>any</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>subqueries</span> <span class='c2'>that</span> <span class='c2'>it</span> <span class='c2'>contains.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>modifyQueries :: (</span><span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>) -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>modifyQueries updateQueryFn query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateTableQueries queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>BaseTable</span> <span class='c3'>|</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span><span class='c3'>) {} -&gt; queryTable;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{subquery, tableAlias} -&gt;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>(modifyQueries updateQueryFn subquery) tableAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateExprQueries expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>fieldName queryTable -&gt;</span> <span class='c6'>QueryField</span> <span class='c3'>fieldName (updateTableQueries queryTable);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>constantValue -&gt; expr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>listValues -&gt;</span> <span class='c6'>ListExpr</span> <span class='c3'>(map updateExprQueries listValues);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func arguments -&gt;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func (map updateExprQueries arguments);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>subquery -&gt;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>(modifyQueries updateQueryFn subquery);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateTypedExprQueries expr = toTypedExpr (updateExprQueries (toUntypedExpr expr));</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateOrderingQueries ordering = (updateExprQueries (fst ordering), snd ordering);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateJoinQueries join =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>join</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c6'>JoinTable</span> <span class='c3'>table -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>(updateTableQueries table);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>leftNode rightNode linkingExpr joinType -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>(updateJoinQueries leftNode) (updateJoinQueries rightNode) (updateTypedExprQueries linkingExpr) joinType;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns = map (\pr -&gt; (updateExprQueries (fst pr), snd pr)) columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionValue -&gt;</span> <span class='c6'>Just</span><span class='c3'>(updateTypedExprQueries restrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroupRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>groupRestriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>groupRestrictionValue -&gt;</span> <span class='c6'>Just</span><span class='c3'>(updateTypedExprQueries groupRestrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newOrderings = map updateOrderingQueries orderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newJoins = map updateJoinQueries joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroups = map updateExprQueries groups;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateQueryFn (</span><span class='c6'>Query</span> <span class='c3'>options newColumns newRestriction newOrderings newJoins newGroups newGroupRestriction);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateQueryFn (</span><span class='c6'>Union</span> <span class='c3'>(modifyQueries updateQueryFn query1) (modifyQueries updateQueryFn query2) unionAll);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removed</span> <span class='c2'>any</span> <span class='c2'>joins</span> <span class='c2'>which</span> <span class='c2'>are</span> <span class='c2'>including</span> <span class='c2'>any</span> <span class='c2'>tables</span> <span class='c2'>which</span> <span class='c2'>are</span> <span class='c2'>otherwise</span> <span class='c2'>unused</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>unused</span> <span class='c2'>table</span> <span class='c2'>will</span> <span class='c2'>not</span> <span class='c2'>be</span> <span class='c2'>removed</span> <span class='c2'>if</span> <span class='c2'>is</span> <span class='c2'>being</span> <span class='c2'>used</span> <span class='c2'>to</span> <span class='c2'>join</span> <span class='c2'>other</span> <span class='c2'>tables</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>that</span> <span class='c2'>are</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeUnusedTables ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeUnusedTables query = removeUnusedTables2 [] query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removed</span> <span class='c2'>any</span> <span class='c2'>joins</span> <span class='c2'>which</span> <span class='c2'>are</span> <span class='c2'>including</span> <span class='c2'>any</span> <span class='c2'>tables</span> <span class='c2'>which</span> <span class='c2'>are</span> <span class='c2'>otherwise</span> <span class='c2'>unused</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>unused</span> <span class='c2'>table</span> <span class='c2'>will</span> <span class='c2'>not</span> <span class='c2'>be</span> <span class='c2'>removed</span> <span class='c2'>if</span> <span class='c2'>is</span> <span class='c2'>being</span> <span class='c2'>used</span> <span class='c2'>to</span> <span class='c2'>join</span> <span class='c2'>other</span> <span class='c2'>tables</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>that</span> <span class='c2'>are</span> <span class='c2'>used</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Tables</span> <span class='c2'>used</span> <span class='c2'>by</span> <span class='c2'>the</span> <span class='c2'>anchorFields</span> <span class='c2'>expressions</span> <span class='c2'>will</span> <span class='c2'>not</span> <span class='c2'>be</span> <span class='c2'>removed</span> <span class='c2'>either.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeUnusedTables2 :: [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>removeUnusedTables2 anchorFields query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Get the list of tables used in the query, excluding the joins and</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// unjoined tables in the main query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTables :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTables = getQueryTables</span> <span class='c6'>False</span> <span class='c3'>(</span><span class='c6'>Query</span> <span class='c3'>options columns restriction orderings [] groups groupRestriction);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Get the list of tables used by the anchor field expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anchorFieldTables :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anchorFieldTables = concatMap (getExpressionTables</span> <span class='c6'>True</span><span class='c3'>) anchorFields;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Get the combined list of tables in use.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesInUse :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesInUse = removeDuplicates (queryTables ++ anchorFieldTables);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings (removeUnusedTablesInJoinSets tablesInUse joins) groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeUnusedTables2 anchorFields query1) (removeUnusedTables2 anchorFields query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>modified</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>join</span> <span class='c2'>nodes</span> <span class='c2'>containing</span> <span class='c2'>only</span> <span class='c2'>the</span> <span class='c2'>joins</span> <span class='c2'>required</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>will</span> <span class='c2'>call</span> <span class='c2'>itself</span> <span class='c2'>recursively</span> <span class='c2'>until</span> <span class='c2'>no</span> <span class='c2'>more</span> <span class='c2'>tables</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>removed.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeUnusedTablesInJoinSets :: [</span><span class='c6'>QueryTable</span><span class='c3'>] -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>removeUnusedTablesInJoinSets tablesInUse !joins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTables = removeDuplicates (concatMap getJoinTreeTables joins);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unusedJoinTables = deleteFirsts joinTables tablesInUse;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subtreeNodesInTree joinTree =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinTree</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt; joinTree : (subtreeNodesInTree leftNode) ++ (subtreeNodesInTree rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allSubtreeNodes = concatMap subtreeNodesInTree joins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Only allow this table to be removed if the only join node</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// that refers to it in the linking expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// is its parent subtree node (or none at all).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; canRemoveTable table =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subtreeUsesTableInLinkExpr node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{linkingExpr} -&gt; isElem table (getExpressionTables</span> <span class='c6'>False</span> <span class='c3'>(toUntypedExpr linkingExpr));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subtreesUsingTableInLinkExpr = filter subtreeUsesTableInLinkExpr allSubtreeNodes;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nodeJoinsTable node =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>node</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; childNodeIsTable childNode =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>childNode</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>childTable -&gt; childTable == table;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (childNodeIsTable leftNode) || (childNodeIsTable rightNode);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isEmpty subtreesUsingTableInLinkExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; || isEmpty (tail subtreesUsingTableInLinkExpr) &amp;&amp; nodeJoinsTable (head subtreesUsingTableInLinkExpr);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesToRemove = filter canRemoveTable unusedJoinTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;removeTablesFromJoinTree ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>Maybe</span> <span class='c6'>JoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeTablesFromJoinTree joinTree =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinTree</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{table} -&gt;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isElem table tablesToRemove)</span> <b><span class='c5'>then</span></b> <span class='c6'>Nothing</span> <b><span class='c5'>else</span></b> <span class='c6'>Just</span> <span class='c3'>joinTree;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode, linkingExpr, joinType} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newLeft = removeTablesFromJoinTree leftNode;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRight = removeTablesFromJoinTree rightNode;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>newLeft</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRight;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>newLeftValue -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>newRight</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newLeft;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>newRightValue -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>(</span><span class='c6'>JoinSubtree</span> <span class='c3'>newLeftValue newRightValue linkingExpr joinType);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newJoins =</span> <span class='c6'>List</span><span class='c3'>.mapJust removeTablesFromJoinTree joins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty tablesToRemove)</span> <b><span class='c5'>then</span></b> <span class='c3'>joins</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b><span class='c3'>removeUnusedTablesInJoinSets tablesInUse newJoins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>best</span> <span class='c2'>set</span> <span class='c2'>of</span> <span class='c2'>joins</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>fields</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>error</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>thrown</span> <span class='c2'>if</span> <span class='c2'>an</span> <span class='c2'>appropriate</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>cannot</span> <span class='c2'>be</span> <span class='c2'>found.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>multiple</span> <span class='c2'>join</span> <span class='c2'>sets</span> <span class='c2'>can</span> <span class='c2'>be</span> <span class='c2'>used</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>tables,</span> <span class='c2'>then</span> <span class='c2'>an</span> <span class='c2'>error</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>unless</span> <span class='c2'>each</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>compatible</span> <span class='c2'>join</span> <span class='c2'>sets</span> <span class='c2'>uses</span> <span class='c2'>the</span> <span class='c2'>same</span> <span class='c2'>joins</span> <span class='c2'>to</span> <span class='c2'>connect</span> <span class='c2'>these</span> <span class='c2'>tables</span> <span class='c2'>(ignoring</span> <span class='c2'>any</span> <span class='c2'>joins</span> <span class='c2'>unrelated</span> <span class='c2'>to</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>tables</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>table</span> <span class='c2'>is</span> <span class='c2'>required,</span> <span class='c2'>then</span> <span class='c2'>an</span> <span class='c2'>arbitrary</span> <span class='c2'>join</span> <span class='c2'>set</span> <span class='c2'>(containing</span> <span class='c2'>this</span> <span class='c2'>table)</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>no</span> <span class='c2'>tables</span> <span class='c2'>are</span> <span class='c2'>needed,</span> <span class='c2'>then</span> <span class='c4'>{@link</span> <span class='c2'>Nothing</span><span class='c4'>@}</span> <span class='c2'>is</span> <span class='c2'>returned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getBestJoinSetForQueryFields :: [</span><span class='c6'>JoinSet</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>(</span><span class='c6'>UniqueIdentifier</span> <span class='c6'>JoinSet</span><span class='c3'>) -&gt;</span> <span class='c6'>Maybe</span> <span class='c6'>JoinSet</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getBestJoinSetForQueryFields !joinSets !sqlQuery !anchorFieldExpressions !preferredJoinSetID =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Take anchor fields into account when determining which tables are in use.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; qryWithAnchorFields = project sqlQuery anchorFieldExpressions;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Don't include subquery tables or tables from within subqueries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTables = filter (\t -&gt; not (isSubqueryTable t)) (getQueryTables</span> <span class='c6'>False</span> <span class='c3'>qryWithAnchorFields);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Returns True if the join set contains all the query tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinSetContainsQueryTables ::</span> <span class='c6'>JoinSet</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinSetContainsQueryTables joinSet =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTree = joinSetJoinTree joinSet;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTreeTables = getJoinTreeTables joinTree;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether all the query tables are included in the join tree tables list.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isEmpty (</span><span class='c6'>List</span><span class='c3'>.deleteFirsts queryTables joinTreeTables);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Determine which of the join sets contain all the necessary tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compatibleJoinSets :: [</span><span class='c6'>JoinSet</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compatibleJoinSets = filter joinSetContainsQueryTables joinSets;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Try to find the preferred join set (if any) in the list of compatible sets.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preferredJoinSet ::</span> <span class='c6'>Maybe</span> <span class='c6'>JoinSet</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preferredJoinSet =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>preferredJoinSetID</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>preferredJoinSetID -&gt;</span> <span class='c6'>UniqueIdentifier</span><span class='c3'>.findMatchingUniquelyNamedItemById compatibleJoinSets preferredJoinSetID;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Return Nothing if no tables are involved.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty queryTables)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(</span><span class='c6'>List</span><span class='c3'>.isSingletonList queryTables)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Use an arbitrary join set if only 1 table is used.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Prelude</span><span class='c3'>.listToMaybe compatibleJoinSets</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty compatibleJoinSets)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Throw an error if there are multiple tables and no appropriate join set could be found.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>error</span> <span class='c3'>(</span><span class='c7'>"The dictionary does not contain a join set that includes all the specified fields."</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++</span> <span class='c7'>"\nQuery: "</span><span class='c3'>++ show sqlQuery</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++</span> <span class='c7'>"\nAnchorFieldExpressions: "</span><span class='c3'>++ show anchorFieldExpressions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++</span> <span class='c7'>"\nTables: "</span><span class='c3'>++ show queryTables</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++</span> <span class='c7'>"\nJoin Sets: "</span><span class='c3'>++ show joinSets</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(</span><span class='c6'>List</span><span class='c3'>.isSingletonList compatibleJoinSets)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If a single join set is compatible, then use it.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Prelude</span><span class='c3'>.listToMaybe compatibleJoinSets</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(isJust preferredJoinSet)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If there are multiple compatible join sets, then check whether one of them is the preferred one (if any).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preferredJoinSet</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// There are multiple compatible join sets (and no preferred one is specified).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Reduce each of these to the joins involving the query tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If the remaining joins are equivalent in each set, then it is safe to return an arbitrary one of these,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// since they will all be the same as far as this query is concerned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If the join sets use different joins to connect the tables in the query, then throw an error since</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// there is no way to know which join path is indended.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Reduce each compatible join set such that it only includes the query tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reducedJoinSets :: [[</span><span class='c6'>JoinNode</span><span class='c3'>]];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reducedJoinSets =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map (removeUnusedTablesInJoinSets queryTables</span> <span class='c6'>#</span> <span class='c6'>List</span><span class='c3'>.list1</span> <span class='c6'>#</span> <span class='c3'>joinSetJoinTree) compatibleJoinSets;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether each compatible join set uses the same joins to connect the query tables.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: perhaps more care needs to be taken when comparing whether 2 join nodes are equivalent...</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In some cases, the order and/or direction of the joins can be ignored.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(</span><span class='c6'>List</span><span class='c3'>.lengthAtLeast</span> <span class='c7'>2</span> <span class='c3'>(</span><span class='c6'>List</span><span class='c3'>.removeDuplicates reducedJoinSets))</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>error</span> <span class='c7'>"There is more than one join set compatible with the specified query."</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Prelude</span><span class='c3'>.listToMaybe compatibleJoinSets;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>the</span> <span class='c2'>necessary</span> <span class='c2'>grouping</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>make</span> <span class='c2'>it</span> <span class='c2'>valid</span> <span class='c2'>if</span> <span class='c2'>there</span> <span class='c2'>is</span> <span class='c2'>any</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>grouping</span> <span class='c2'>or</span> <span class='c2'>aggregation.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>fixQueryForGroupBy ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>fixQueryForGroupBy query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getExprAggregationExprs expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; concatMap getExprAggregationExprs listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isAggregationFunction func)</span> <b><span class='c5'>then</span></b> <span class='c3'>[expr]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>concatMap getExprAggregationExprs arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allExprs = map fst columns ++ map fst orderings ++ map toUntypedExpr (maybeToList groupRestriction);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aggregateExprs = concatMap getExprAggregationExprs allExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupByNeeded = not (isEmpty groups) || not (isEmpty aggregateExprs);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addGroupExprs !curGrouping !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// If the expression is already grouped then nothing else is</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// necessary.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isElem expr curGrouping)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; curGrouping</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{} -&gt; curGrouping ++ [expr];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{} -&gt; curGrouping;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt; foldLeftStrict addGroupExprs curGrouping listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b><span class='c3'>(isAggregationFunction func)</span> <b><span class='c5'>then</span></b> <span class='c3'>curGrouping</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>foldLeftStrict addGroupExprs curGrouping arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{} -&gt; curGrouping;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGrouping = foldLeftStrict addGroupExprs groups allExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(groupByNeeded)</span> <b><span class='c5'>then</span></b> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins newGrouping groupRestriction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(fixQueryForGroupBy query1) (fixQueryForGroupBy query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>any</span> <span class='c2'>constant</span> <span class='c2'>expressions</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>grouping</span> <span class='c2'>and</span> <span class='c2'>ordering</span> <span class='c2'>lists.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>removeConstantGroupingAndOrdering ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>removeConstantGroupingAndOrdering !query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroups :: [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newGroups = filter (not</span> <span class='c6'>#</span> <span class='c3'>isExprConstant) groups;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newOrderings :: [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;newOrderings = filter (\!ord -&gt; not (isExprConstant (field1 ord))) orderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Handle the (common) case where nothing needs to be changed.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(length newGroups == length groups || length newOrderings == length orderings)</span> <b><span class='c5'>then</span></b> <span class='c3'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>Query</span> <span class='c3'>options columns restriction newOrderings joins newGroups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(removeConstantGroupingAndOrdering query1) (removeConstantGroupingAndOrdering query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>expression</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>constant</span> <span class='c2'>value</span> <span class='c2'>or</span> <span class='c2'>an</span> <span class='c2'>expression</span> <span class='c2'>composed</span> <span class='c2'>of</span> <span class='c2'>only</span> <span class='c2'>constant</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isExprConstant ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>isExprConstant !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{} -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether all of the list values are constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>List</span><span class='c3'>.all isExprConstant listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Check whether all of the function argument values are constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span><span class='c6'>List</span><span class='c3'>.all isExprConstant arguments;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// For now, just assume that subqueries are never constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: should the case where the subquery contains only constant values be handled?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>//////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// SQL Builder</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>helper</span> <span class='c2'>object</span> <span class='c2'>which</span> <span class='c2'>is</span> <span class='c2'>passed</span> <span class='c2'>through</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>builder</span> <span class='c2'>code</span> <span class='c2'>to</span> <span class='c2'>keep</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>track</span> <span class='c2'>of</span> <span class='c2'>intermediate</span> <span class='c2'>state.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>SqlBuilderState</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>SqlBuilderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outerQueryTables :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>an</span> <span class='c2'>empty</span> <span class='c2'>SQL</span> <span class='c2'>builder</span> <span class='c2'>state</span> <span class='c2'>object.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>newSqlBuilderState =</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>[];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>getStateOuterQueryTables ::</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>getStateOuterQueryTables !builderState = builderState.</span><span class='c6'>SqlBuilderState</span><span class='c3'>.outerQueryTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>addQueryTablesToState ::</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryTable</span><span class='c3'>] -&gt;</span> <span class='c6'>SqlBuilderState</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>addQueryTablesToState builderState newTables =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>builderState</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>{outerQueryTables} -&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>(removeDuplicates (outerQueryTables ++ newTables));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>type</span> <span class='c2'>holds</span> <span class='c2'>various</span> <span class='c2'>functions</span> <span class='c2'>needed</span> <span class='c2'>for</span> <span class='c2'>converting</span> <span class='c2'>primitive</span> <span class='c2'>values</span> <span class='c2'>to</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>PrimitiveValueBuilder</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>PrimitiveValueBuilder</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (intVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doubleToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (doubleVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stringToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (stringVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TimeZone</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (timeVal, timeZone)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; booleanToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (boolVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullToSqlFn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Document</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeIntervalToSqlFn :: (</span><span class='c6'>TimeInterval</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (timeInterval)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>new</span> <span class='c2'>SQL</span> <span class='c2'>primitive</span> <span class='c2'>value</span> <span class='c2'>builder</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>functions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makePrimitiveValueBuilder :: (</span><span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// intToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (intVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// doubleToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (doubleVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// stringToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (stringVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TimeZone</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// timeToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (timeVal</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// timeZone)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// booleanToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (boolVal)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>Document</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// nullToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TimeInterval</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// timeIntervalToSql(timeInterval)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>PrimitiveValueBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makePrimitiveValueBuilder =</span> <span class='c6'>PrimitiveValueBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>SQL</span> <span class='c2'>Builder</span> <span class='c2'>holds</span> <span class='c2'>the</span> <span class='c2'>various</span> <span class='c2'>functions</span> <span class='c2'>needed</span> <span class='c2'>to</span> <span class='c2'>construct</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>text</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>typeConstructor</span> <span class='c2'>=</span> <span class='c2'>Query</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Different</span> <span class='c2'>instances</span> <span class='c2'>of</span> <span class='c2'>this</span> <span class='c2'>should</span> <span class='c2'>be</span> <span class='c2'>created</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>different</span> <span class='c2'>SQL</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'flavours'.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>SqlBuilder</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>SqlBuilder</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prepareQueryFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState query)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constructQueryFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState selectBody fromBody whereBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupByBody havingBody orderByBody)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constructUnionQueryFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState query1Text query2Text unionAll)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildSelectClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState options exprsAndAliases)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryOption</span><span class='c3'>] -&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildFromClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState joins)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildWhereClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState restrictions joins)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildOrderByClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState orderExpressions)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildGroupByClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState groupExpressions)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildHavingClauseFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState groupRestrictions)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateDatabaseStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (databaseRef skipIfDatabaseExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropDatabaseStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (databaseRef onlyIfDatabaseExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateTableStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (tableDesc skipIfTableExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateViewStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (viewRef viewDefinition)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropTableStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (tableRef onlyIfTableExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropViewStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (viewRef onlyIfViewExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertValuesStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (tableRef maybeDestColumns rowValues)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertQueryValuesStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (tableRef maybeDestColumns insertQuery)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildUpdateValuesStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState tableRef destColumns newValues condition)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDeleteRowsStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState tableRef, condition)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCommitStatementFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Document</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildFieldDescriptionFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (fieldDesc)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>FieldDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildFieldTypeFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (dataType)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlType</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameterToSqlFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listToSqlFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState exprList)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; functionToSqlFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState func argExprs)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addParensFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (exprText)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quoteIdentifierFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (indentifierText)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildTableAndAliasTextFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (queryTable)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeSafeNameFn ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (name)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; primitiveValueBuilder ::</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PrimitiveValueBuilder</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>new</span> <span class='c2'>SQL</span> <span class='c2'>builder</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>functions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeSqlBuilder :: (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// prepareQuery(builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// query)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// constructQuery</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// selectBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// fromBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// whereBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// groupByBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// havingBody</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// orderByBody)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;</span> <span class='c1'>// constructUnionQuery</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// query1Text</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// query2Text</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// unionAll)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryOption</span><span class='c3'>] -&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span> <span class='c1'>// buildSelectClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// options</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// exprsAndAliases)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// buildFromClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// joins)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildWhereClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// restrictions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// joins)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildOrderByClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// orderExpressions)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildGroupByClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// groupExpressions)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildHavingClause</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// groupRestrictions)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildCreateDatabaseStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (databaseRef</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// skipIfDatabaseExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildDropDatabaseStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (databaseRef</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// onlyIfDatabaseExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildCreateTableStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// fieldDescriptions</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// constraints</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// skipIfTableExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildCreateViewStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (viewRef</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// viewDefinition)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildDropTableStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// onlyIfTableExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildDropViewStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (viewRef</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// onlyIfViewExists)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildInsertValuesStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</span><span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// rowValues)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildInsertQueryValuesStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// insertQuery)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span> <span class='c1'>// buildUpdateValuesStatementFn</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// destColumns</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// newValues</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// condition</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span> <span class='c1'>// buildDeleteRowsStatementFn</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (table</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// condition)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>Document</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>FieldDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildFieldDescription</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (fieldDesc)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlType</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildFieldType</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (dataType)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// listToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// exprList)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// functionToSql</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (builderState</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// func</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// argExprs)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// addParens</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c1'>// (exprText)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// quoteIdentifier</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (indentifierText)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; (</span><span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// buildTableAndAliasText</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (queryTable)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;-&gt; (</span><span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// makeSafeName</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (name)</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>PrimitiveValueBuilder</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// primitiveValueBuilder</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c6'>SqlBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeSqlBuilder =</span> <span class='c6'>SqlBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>gives</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>builder</span> <span class='c2'>a</span> <span class='c2'>chance</span> <span class='c2'>to</span> <span class='c2'>alter</span> <span class='c2'>the</span> <span class='c2'>structure</span> <span class='c2'>of</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query</span> <span class='c2'>in</span> <span class='c2'>order</span> <span class='c2'>to</span> <span class='c2'>simplify</span> <span class='c2'>building</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>text.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>prepareToBuildQueryText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>prepareToBuildQueryText !sqlBuilder builderState query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.prepareQueryFn) builderState query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>complete</span> <span class='c2'>SQL</span> <span class='c2'>query</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>component</span> <span class='c2'>parts.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>constructQuery ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>constructQuery !sqlBuilder builderState selectBody fromBody whereBody groupByBody havingBody orderByBody =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.constructQueryFn) builderState selectBody fromBody whereBody groupByBody havingBody orderByBody;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>constructUnionQuery ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>constructUnionQuery !sqlBuilder builderState query1Text query2Text unionAll =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.constructUnionQueryFn) builderState query1Text query2Text unionAll;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>SELECT</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'SELECT'</span> <span class='c2'>keyword</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildSelectClause&nbsp; ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>QueryOption</span><span class='c3'>] -&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildSelectClause !sqlBuilder builderState options exprsAndAliases =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildSelectClauseFn) builderState options exprsAndAliases;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>FROM</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span> <span class='c2'>'FROM'</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>keyword</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildFromClause ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildFromClause !sqlBuilder builderState joins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildFromClauseFn) builderState joins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>WHERE</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'WHERE'</span> <span class='c2'>keyword</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildWhereClause ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt; [</span><span class='c6'>JoinNode</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildWhereClause !sqlBuilder builderState restrictions joins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildWhereClauseFn) builderState restrictions joins;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>ORDER</span> <span class='c2'>BY</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'ORDER</span> <span class='c2'>BY'</span> <span class='c2'>keyword</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildOrderByClause ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>)] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildOrderByClause !sqlBuilder builderState orderExpressions =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildOrderByClauseFn) builderState orderExpressions;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>GROUP</span> <span class='c2'>BY</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'GROUP</span> <span class='c2'>BY'</span> <span class='c2'>keyword</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildGroupByClause ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildGroupByClause !sqlBuilder builderState groupExpressions =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildGroupByClauseFn) builderState groupExpressions;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>HAVING</span> <span class='c2'>clause</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>not</span> <span class='c2'>including</span> <span class='c2'>the</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>'HAVING'</span> <span class='c2'>keywork</span> <span class='c2'>(or</span> <span class='c2'>equivalent).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildHavingClause ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; (</span><span class='c6'>Maybe</span> <span class='c6'>Expr</span><span class='c3'>) -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>buildHavingClause !sqlBuilder builderState groupRestrictions =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildHavingClauseFn) builderState groupRestrictions;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>primitive</span> <span class='c2'>value</span> <span class='c2'>builder</span> <span class='c2'>associated</span> <span class='c2'>with</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>builder.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>primitiveValueBuilder ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>PrimitiveValueBuilder</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>primitiveValueBuilder !sqlBuilder = sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.primitiveValueBuilder;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>an</span> <span class='c2'>int</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>intToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>intToSql !sqlBuilder intVal =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.intToSqlFn intVal;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>double</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>doubleToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>doubleToSql !sqlBuilder doubleVal =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.doubleToSqlFn doubleVal;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>string</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>stringToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>stringToSql !sqlBuilder stringVal =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.stringToSqlFn stringVal;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>timeToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>TimeZone</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>timeToSql !sqlBuilder timeVal timeZone =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.timeToSqlFn timeVal timeZone;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>boolean</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>booleanToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>booleanToSql !sqlBuilder boolVal =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.booleanToSqlFn boolVal;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>null</span> <span class='c2'>value</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>nullToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>nullToSql !sqlBuilder =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.nullToSqlFn;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>time</span> <span class='c2'>interval</span> <span class='c2'>constant.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>timeIntervalToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>TimeInterval</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>timeIntervalToSql !sqlBuilder timeInterval =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (primitiveValueBuilder sqlBuilder).</span><span class='c6'>PrimitiveValueBuilder</span><span class='c3'>.timeIntervalToSqlFn timeInterval;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>parameterToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>parameterToSql !sqlBuilder !parameter =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.parameterToSqlFn parameter;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>listToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>listToSql !sqlBuilder builderState exprList =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.listToSqlFn) builderState exprList;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>SQL</span> <span class='c2'>function</span> <span class='c2'>application.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>functionToSql ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>functionToSql !sqlBuilder builderState func argExprs =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.functionToSqlFn) builderState func argExprs;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>parentheses</span> <span class='c2'>around</span> <span class='c2'>some</span> <span class='c2'>expression</span> <span class='c2'>text.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>addParens ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>addParens !sqlBuilder exprText =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.addParensFn) exprText;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Adds</span> <span class='c2'>quotes</span> <span class='c2'>to</span> <span class='c2'>a</span> <span class='c2'>name</span> <span class='c2'>(such</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>table).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>quoteIdentifier ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>quoteIdentifier !sqlBuilder indentifierText =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.quoteIdentifierFn) indentifierText;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>a</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>and</span> <span class='c2'>optional</span> <span class='c2'>table</span> <span class='c2'>alias.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>buildTableAndAliasText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>buildTableAndAliasText !sqlBuilder builderState queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildTableAndAliasTextFn) builderState queryTable;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>a</span> <span class='c2'>'safe'</span> <span class='c2'>version</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeSafeSqlName ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeSafeSqlName !sqlBuilder name =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (sqlBuilder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.makeSafeNameFn) name;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>'safe'</span> <span class='c2'>versions</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>names.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>names</span> <span class='c2'>will</span> <span class='c2'>all</span> <span class='c2'>be</span> <span class='c2'>distinct.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeSafeSqlNames ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>String</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeSafeSqlNames sqlBuilder namesInUse names =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safeNames = map (makeSafeSqlName sqlBuilder) names;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeUniqueNames namesInUse safeNames;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>an</span> <span class='c2'>updated</span> <span class='c2'>version</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>name</span> <span class='c2'>list</span> <span class='c2'>where</span> <span class='c2'>each</span> <span class='c2'>name</span> <span class='c2'>is</span> <span class='c2'>unique.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>name</span> <span class='c2'>comparisons</span> <span class='c2'>are</span> <span class='c2'>not</span> <span class='c2'>case</span> <span class='c2'>sensitive.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>names</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>made</span> <span class='c2'>unique</span> <span class='c2'>by</span> <span class='c2'>appending</span> <span class='c2'>an</span> <span class='c2'>integer</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>end</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>perhaps</span> <span class='c2'>this</span> <span class='c2'>should</span> <span class='c2'>take</span> <span class='c2'>into</span> <span class='c2'>account</span> <span class='c2'>the</span> <span class='c2'>maximum</span> <span class='c2'>length</span> <span class='c2'>for</span> <span class='c2'>various</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>names</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>database...</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeUniqueNames :: [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>String</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeUniqueNames namesAlreadyInUse names =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeUniqueNamesHelper ::</span> <span class='c6'>Set</span> <span class='c6'>String</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>String</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeUniqueNamesHelper namesInUse names =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>names</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n : ns -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uniqueName = getUniqueName namesInUse n</span> <span class='c7'>0</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedNamesInUse =</span> <span class='c6'>Set</span><span class='c3'>.insert (toLowerCase uniqueName) namesInUse;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uniqueName : makeUniqueNamesHelper updatedNamesInUse ns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getUniqueName ::</span> <span class='c6'>Set</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getUniqueName namesInUse name attemptN =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attemptedName =</span> <b><span class='c5'>if</span></b> <span class='c3'>(attemptN ==</span> <span class='c7'>0</span><span class='c3'>)</span> <b><span class='c5'>then</span></b> <span class='c3'>name</span> <b><span class='c5'>else</span></b> <span class='c3'>name ++ (intToString attemptN);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty attemptedName)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attemptedName</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <b><span class='c5'>if</span></b> <span class='c3'>(</span><span class='c6'>Set</span><span class='c3'>.member (toLowerCase attemptedName) namesInUse)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getUniqueName namesInUse name (attemptN +</span> <span class='c7'>1</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; attemptedName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeUniqueNamesHelper (</span><span class='c6'>Set</span><span class='c3'>.fromList (map toLowerCase namesAlreadyInUse)) names;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Note</span> <span class='c2'>that</span> <span class='c2'>this</span> <span class='c2'>should</span> <span class='c2'>only</span> <span class='c2'>be</span> <span class='c2'>called</span> <span class='c2'>to</span> <span class='c2'>generate</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>top-level</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>For</span> <span class='c2'>expressions</span> <span class='c2'>embedded</span> <span class='c2'>in</span> <span class='c2'>a</span> <span class='c2'>SQL</span> <span class='c2'>query</span> <span class='c2'>or</span> <span class='c2'>other</span> <span class='c2'>expressions,</span> <span class='c2'>call</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>{@link</span> <span class='c2'>expressionText2</span><span class='c4'>@}</span> <span class='c2'>instead</span> <span class='c2'>and</span> <span class='c2'>provide</span> <span class='c2'>the</span> <span class='c2'>appropriate</span> <span class='c4'>{@code</span> <span class='c2'>builderState</span><span class='c4'>@}</span><span class='c2'>.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>expressionText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>expressionText builder expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayWidth =</span> <span class='c7'>1</span> <span class='c3'>::</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc = expressionText2 builder newSqlBuilderState expr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PrettyPrinter</span><span class='c3'>.pretty displayWidth doc;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>single</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>expressionText2 ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>expressionText2 builder builderState expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: how should this info be supplied?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeZone =</span> <span class='c6'>TimeZone</span><span class='c3'>.currentTimeZone;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class='c6'>QueryField</span> <span class='c3'>{fieldName, queryTable} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAlias = quoteIdentifier builder (getQueryTableAlias queryTable);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldNameText = quoteIdentifier builder fieldName;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty tableAlias)</span> <b><span class='c5'>then</span></b> <span class='c3'>fieldNameText</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>tableAlias ++ text</span> <span class='c7'>"."</span> <span class='c3'>++ fieldNameText;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NullValue</span> <span class='c3'>-&gt; nullToSql builder;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>StringValue</span> <span class='c3'>{strValue} -&gt; stringToSql builder strValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NumberValue</span> <span class='c3'>{numValue} -&gt; doubleToSql builder numValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BooleanValue</span> <span class='c3'>{boolValue} -&gt; booleanToSql builder boolValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TimeValue</span> <span class='c3'>{timeValue} -&gt; timeToSql builder timeValue timeZone;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"Unknown constant value type"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ParameterExpr</span> <span class='c3'>{parameter} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameterToSql builder parameter;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listToSql builder builderState listValues;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; functionToSql builder builderState func arguments;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{subquery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addParens builder (nest</span> <span class='c7'>4</span> <span class='c3'>(line ++ queryText2 builder builderState (fixSubqueryOrdering subquery)) ++ line);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>whether</span> <span class='c2'>the</span> <span class='c2'>function</span> <span class='c2'>is</span> <span class='c2'>really</span> <span class='c2'>an</span> <span class='c2'>operator</span> <span class='c2'>(in-fix).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isOperator ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isOperator func = operatorPrecedence func &gt;</span> <span class='c7'>0</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Returns</span> <span class='c2'>the</span> <span class='c2'>precedence</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>An</span> <span class='c2'>operation</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>higher</span> <span class='c2'>precendence</span> <span class='c2'>value</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>done</span> <span class='c2'>first.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>operatorPrecedence ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>operatorPrecedence func =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>func</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNot</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>5</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitNot</span> <span class='c3'>-&gt;</span> <span class='c7'>7</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNegate</span> <span class='c3'>-&gt;</span> <span class='c7'>7</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpEq</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLt</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLtEq</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpGt</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpGtEq</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNotEq</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpAnd</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>2</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpOr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>1</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLike</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIn</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCat</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>5</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpPlus</span><span class='c3'>&nbsp;&nbsp; -&gt;</span> <span class='c7'>5</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMinus</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>5</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMul</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>6</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpDiv</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>6</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMod</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt;</span> <span class='c7'>6</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBetween</span> <span class='c3'>-&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCase_Simple</span> <span class='c3'>-&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCase_Searched</span> <span class='c3'>-&gt;</span> <span class='c7'>4</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitAnd</span> <span class='c3'>-&gt;</span> <span class='c7'>3</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitOr</span><span class='c3'>&nbsp; -&gt;</span> <span class='c7'>3</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitXor</span> <span class='c3'>-&gt;</span> <span class='c7'>3</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpExists</span> <span class='c3'>-&gt;</span> <span class='c7'>9</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIsNull</span> <span class='c3'>-&gt;</span> <span class='c7'>8</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIsNotNull</span> <span class='c3'>-&gt;</span> <span class='c7'>8</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c7'>0</span><span class='c3'>;</span> <span class='c1'>// Not an operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>exprOperatorPrecedence ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>exprOperatorPrecedence expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func} -&gt; operatorPrecedence func;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c7'>0</span><span class='c3'>;</span> <span class='c1'>// Not an operator.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Removes</span> <span class='c2'>ordering</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>subquery</span> <span class='c2'>unless</span> <span class='c2'>it</span> <span class='c2'>is</span> <span class='c2'>required</span> <span class='c2'>(as</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c4'>{@link</span> <span class='c2'>TopN</span><span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>query).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>fixSubqueryOrdering subquery =</span> <b><span class='c5'>if</span></b> <span class='c3'>(isTopNQuery subquery)</span> <b><span class='c5'>then</span></b> <span class='c3'>subquery</span> <b><span class='c5'>else</span></b> <span class='c3'>removeOrdering subquery;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Builds</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>table</span> <span class='c2'>name</span> <span class='c2'>(including</span> <span class='c2'>quotes</span> <span class='c2'>where</span> <span class='c2'>needed).</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>tableNameText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>tableNameText builder builderState queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableRef} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quoteIdentifier builder (getTableNameFromReference tableRef);</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>:</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// quote</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// each</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// part of</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// the</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// qualified</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// name...</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{subquery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addParens builder (nest</span> <span class='c7'>4</span> <span class='c3'>(line ++ queryText2 builder builderState (fixSubqueryOrdering subquery)) ++ line);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span> <span class='c3'>{subqueryText} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addParens builder (nest</span> <span class='c7'>4</span> <span class='c3'>(line ++ multilineText subqueryText) ++ line);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>database</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>queryText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>queryText builder !forDisplay query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayWidth =</span> <span class='c7'>1</span> <span class='c3'>::</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; width =</span> <b><span class='c5'>if</span></b> <span class='c3'>forDisplay</span> <b><span class='c5'>then</span></b> <span class='c3'>displayWidth ::</span> <span class='c6'>Int</span> <b><span class='c5'>else</span></b> <span class='c6'>Prelude</span><span class='c3'>.maxBound;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PrettyPrinter</span><span class='c3'>.pretty width $ queryTextDocument builder query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>document</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>database</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>queryTextDocument ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>queryTextDocument builder query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; builderState = newSqlBuilderState;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fixedGroupingQuery = modifyQueries fixQueryForGroupBy query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removedConstantsQuery = modifyQueries removeConstantGroupingAndOrdering fixedGroupingQuery;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preparedQuery = modifyQueries (prepareToBuildQueryText builder builderState) removedConstantsQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryText2 builder builderState preparedQuery;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>database</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>queryText2 ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlBuilderState</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>queryText2 builder builderState query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>(checkValidQuery query)</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{options, columns, restriction, orderings, joins, groups, groupRestriction} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// For a subquery, exclude any tables which are used in outer</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allQueryTables = getQueryTables</span> <span class='c6'>False</span> <span class='c3'>query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outerQueryTables = getStateOuterQueryTables builderState;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTables = deleteFirsts allQueryTables outerQueryTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newBuilderState = addQueryTablesToState builderState queryTables;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionValue -&gt;</span> <span class='c6'>Just</span> <span class='c3'>(toUntypedExpr restrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedGroupRestriction =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>groupRestriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt;</span> <span class='c6'>Nothing</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span><span class='c3'>groupRestrictionValue -&gt;</span> <span class='c6'>Just</span> <span class='c3'>(toUntypedExpr groupRestrictionValue);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Include extra JoinTables for any tables in use in the query that</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// aren't already included in the joins.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedJoins =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joinTables = removeDuplicates (concatMap getJoinTreeTables joins);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablesNotInJoins = deleteFirsts queryTables joinTables;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joins ++ (map</span> <span class='c6'>JoinTable</span> <span class='c3'>tablesNotInJoins);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Avoid including the same expression multiple times in the GROUP</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// BY or ORDER BY clause.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedGrouping&nbsp; = removeDuplicates groups;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updatedOrderings = removeDuplicatesBy (\o1 o2 -&gt; fst o1 == fst o2) orderings;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; selectBody&nbsp; = buildSelectClause builder newBuilderState options columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fromBody&nbsp;&nbsp;&nbsp; = buildFromClause builder newBuilderState updatedJoins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; whereBody&nbsp;&nbsp; = buildWhereClause builder newBuilderState untypedRestriction updatedJoins;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupByBody = buildGroupByClause builder newBuilderState updatedGrouping;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; havingBody&nbsp; = buildHavingClause builder newBuilderState untypedGroupRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderByBody = buildOrderByClause builder newBuilderState updatedOrderings;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constructQuery builder newBuilderState selectBody fromBody whereBody groupByBody havingBody orderByBody;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2, unionAll} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Enclose any child UNION in quotes if its union type doesn't match</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// the outer one.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; childQueryText childQuery =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; baseQueryText = queryText2 builder builderState childQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>childQuery</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{unionAll=innerUnionAll} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(innerUnionAll != unionAll)</span> <b><span class='c5'>then</span></b> <span class='c3'>addParens builder baseQueryText</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>baseQueryText;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; baseQueryText;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query1Text = queryText2 builder builderState query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query2Text = childQueryText query2;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constructUnionQuery builder builderState query1Text query2Text unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>///**</span></p>
<p class="Clz"><span class='c1'>// * Assigns unique table aliases to each table in the query.</span></p>
<p class="Clz"><span class='c1'>// */</span></p>
<p class="Clz"><span class='c1'>//makeUniqueQueryTableAliases :: Query -&gt; Query;</span></p>
<p class="Clz"><span class='c1'>//public makeUniqueQueryTableAliases query =</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; let</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Get the list of all base alias and ID combinations from the query.</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allQueryTables :: [QueryTable];</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allQueryTables = getQueryTables True query;</span></p>
<p class="Clz"><span class='c1'>//</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aliasInfoForTable :: QueryTable -&gt; (String, Long);</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aliasInfoForTable table =</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case table of</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (BaseTable| SubQueryTable | OpaqueSubQueryTable) {baseAlias, tableID} -&gt; (baseAlias, tableID);</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c1'>//</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAliasInfo :: [(String, Long)];</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableAliasInfo = removeDuplicates (map aliasInfoForTable allQueryTables);</span></p>
<p class="Clz"><span class='c1'>//</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newTableAliasInfoMap :: [((String, Long), Long)];</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;newTableAliasInfoMap = map (\aliasInfo -&gt; (aliasInfo, nextTableID)) tableAliasInfo;</span></p>
<p class="Clz"><span class='c1'>//</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupNewTableAlias :: String -&gt; Long -&gt; Long;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lookupNewTableAlias baseAlias oldTableID = lookupWithDefault (baseAlias, oldTableID)</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newTableAliasInfoMap</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (error ("Failed to find new table alias for '" ++ baseAlias ++ "'"));</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateQueryTableFn table =</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case table of</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseTable table baseAlias tableID -&gt;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseTable table baseAlias (lookupNewTableAlias baseAlias tableID);</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SubQueryTable subquery baseAlias tableID -&gt;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SubQueryTable (modifyTablesInQuery updateQueryTableFn subquery) baseAlias (lookupNewTableAlias baseAlias tableID);</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OpaqueSubQueryTable subqueryText baseAlias tableID -&gt;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OpaqueSubQueryTable subqueryText baseAlias (lookupNewTableAlias baseAlias tableID);</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; in</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; modifyTablesInQuery updateQueryTableFn query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Throws</span> <span class='c2'>an</span> <span class='c2'>error</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>valid.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>checkValidQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>checkValidQuery query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: check other aspects of the query...</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; checkValidGroupByQuery (checkValidResultColumns query);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Checks</span> <span class='c2'>that</span> <span class='c2'>there</span> <span class='c2'>is</span> <span class='c2'>at</span> <span class='c2'>least</span> <span class='c2'>one</span> <span class='c2'>return</span> <span class='c2'>column.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <b><span class='c8'>TODO</span></b><span class='c2'>:</span> <span class='c2'>also</span> <span class='c2'>check</span> <span class='c2'>that</span> <span class='c2'>the</span> <span class='c2'>return</span> <span class='c2'>columns</span> <span class='c2'>are</span> <span class='c2'>of</span> <span class='c2'>valid</span> <span class='c2'>types....</span> <span class='c2'>(Is</span> <span class='c2'>a</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>ListExpr</span> <span class='c2'>valid</span> <span class='c2'>as</span> <span class='c2'>a</span> <span class='c2'>return</span> <span class='c2'>column?)</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>checkValidResultColumns ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>checkValidResultColumns query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty columns)</span> <b><span class='c5'>then</span></b> <span class='c6'>error</span> <span class='c7'>"At least one return column must be specified in the query."</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2, unionAll} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(checkValidResultColumns query1) (checkValidResultColumns query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>If</span> <span class='c2'>there</span> <span class='c2'>is</span> <span class='c2'>any</span> <span class='c2'>grouping</span> <span class='c2'>fields</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>query,</span> <span class='c2'>then</span> <span class='c2'>this</span> <span class='c2'>will</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>check</span> <span class='c2'>that</span> <span class='c2'>all</span> <span class='c2'>the</span> <span class='c2'>return</span> <span class='c2'>column</span> <span class='c2'>expressions</span> <span class='c2'>are</span> <span class='c2'>group</span> <span class='c2'>on</span> <span class='c2'>or</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>are</span> <span class='c2'>aggregate</span> <span class='c2'>expressions.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>checkValidGroupByQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>private</span></b> <span class='c3'>checkValidGroupByQuery query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{columns, groups} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; isGroupingExpression expr = isElem expr groups;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; expressionOk expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// First check whether this is one of the grouping</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// expressions for the query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isGroupingExpression expr)</span> <b><span class='c5'>then</span></b> <span class='c6'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// This is only ok if this is a grouping expression</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// (which has already been checked).</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Constant expressions are always ok.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span><span class='c3'>&nbsp; {listValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all expressionOk listValues;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: is this</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// correct?</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Aggregate expressions are always ok.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b><span class='c3'>(isAggregationFunction func)</span> <b><span class='c5'>then</span></b> <span class='c6'>True</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>all expressionOk arguments;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: is this ok?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; columnExprs&nbsp; = map fst columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allColumnsOk = all expressionOk columnExprs;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isEmpty groups || allColumnsOk)</span> <b><span class='c5'>then</span></b> <span class='c3'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c6'>error</span> <span class='c7'>"Invalid grouping query specified."</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2, unionAll} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(checkValidGroupByQuery query1) (checkValidGroupByQuery query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>SQL</span> <span class='c2'>statements</span> <span class='c2'>to</span> <span class='c2'>modify</span> <span class='c2'>tables</span> <span class='c2'>and/or</span> <span class='c2'>values.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>public</span></b> <span class='c6'>Statement</span> <span class='c3'>=</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>CreateDatabaseStatement</span> <span class='c1'>// CREATE DATABASE is not part of the SQL-92 standard, but most DB servers support it</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; databaseRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>DatabaseReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skipIfDatabaseExists ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>DropDatabaseStatement</span> <span class='c1'>// DROP DATABASE is not part of the SQL-92 standard, but most DB servers support it</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; databaseRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>DatabaseReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyIfDatabaseExists ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>CreateTableStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableDesc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableDescription</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skipIfTableExists ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>CreateViewStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewDefinition&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skipIfViewExists&nbsp; ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>DropTableStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyIfTableExists ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>DropViewStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; viewRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyIfViewExists&nbsp; ::</span> <span class='c6'>Boolean</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>InsertValuesStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maybeDestColumns&nbsp; :: (</span><span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>])</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rowValues&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Expr</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>InsertQueryValuesStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maybeDestColumns&nbsp; :: (</span><span class='c6'>Maybe</span> <span class='c3'>[</span><span class='c6'>String</span><span class='c3'>])</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insertQuery&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>Query</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>UpdateValuesStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destColumns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>String</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newValues&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Expr</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; condition&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>DeleteRowsStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tableRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>TableReference</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; condition&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: (</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>CommitStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>private</span></b> <span class='c6'>CompoundStatement</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; statements&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :: [</span><span class='c6'>Statement</span><span class='c3'>]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeCreateDatabaseStatement ::</span> <span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeCreateDatabaseStatement =</span> <span class='c6'>CreateDatabaseStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeDropDatabaseStatement ::</span> <span class='c6'>DatabaseReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeDropDatabaseStatement =</span> <span class='c6'>DropDatabaseStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeCreateTableStatement ::</span> <span class='c6'>TableDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeCreateTableStatement =</span> <span class='c6'>CreateTableStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeCreateViewStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeCreateViewStatement =</span> <span class='c6'>CreateViewStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeDropTableStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeDropTableStatement =</span> <span class='c6'>DropTableStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeDropViewStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeDropViewStatement =</span> <span class='c6'>DropViewStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeInsertValuesStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeInsertValuesStatement tableRef rowValues =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertValuesStatement</span> <span class='c3'>tableRef</span> <span class='c6'>Nothing</span> <span class='c3'>rowValues;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeInsertValuesByColumnStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeInsertValuesByColumnStatement tableRef destColumns rowValues =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertValuesStatement</span> <span class='c3'>tableRef (</span><span class='c6'>Just</span> <span class='c3'>destColumns) rowValues;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeInsertQueryValuesStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeInsertQueryValuesStatement tableRef insertQuery =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertQueryValuesStatement</span> <span class='c3'>tableRef</span> <span class='c6'>Nothing</span> <span class='c3'>insertQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeInsertQueryValuesByColumnStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b><span class='c3'>makeInsertQueryValuesByColumnStatement tableRef destColumns insertQuery =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertQueryValuesStatement</span> <span class='c3'>tableRef (</span><span class='c6'>Just</span> <span class='c3'>destColumns) insertQuery;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeUpdateValuesStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt; [</span><span class='c6'>Expr</span><span class='c3'>] -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeUpdateValuesStatement tableRef destColumns newValues condition =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UpdateValuesStatement</span> <span class='c3'>tableRef destColumns newValues condition;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeDeleteRowsStatement ::</span> <span class='c6'>TableReference</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeDeleteRowsStatement tableRef condition =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DeleteRowsStatement</span> <span class='c3'>tableRef condition;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>makeCommitStatement ::</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeCommitStatement =</span> <span class='c6'>CommitStatement</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Creates</span> <span class='c2'>a</span> <span class='c2'>compound</span> <span class='c2'>statement</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>statements.</span><span class='c3'>&nbsp;</span> <span class='c2'>This</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>will</span> <span class='c2'>attempt</span> <span class='c2'>to</span> <span class='c2'>flatten</span> <span class='c2'>any</span> <span class='c2'>compound</span> <span class='c2'>statements</span> <span class='c2'>contained</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>argument</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>list.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeCompoundStatement :: [</span><span class='c6'>Statement</span><span class='c3'>] -&gt;</span> <span class='c6'>Statement</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>makeCompoundStatement statements =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeCompoundStatementHelper ::</span> <span class='c6'>Statement</span> <span class='c3'>-&gt; [</span><span class='c6'>Statement</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeCompoundStatementHelper stmt =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>stmt</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CompoundStatement</span> <span class='c3'>{statements} -&gt; statements;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [stmt];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CompoundStatement</span> <span class='c3'>(concatMap makeCompoundStatementHelper statements);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Linearizes</span> <span class='c2'>the</span> <span class='c2'>structure</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>statement</span> <span class='c2'>by</span> <span class='c2'>extracting</span> <span class='c2'>all</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>statements</span> <span class='c2'>nested</span> <span class='c2'>in</span> <span class='c2'>any</span> <span class='c2'>compound</span> <span class='c2'>statement.</span><span class='c3'>&nbsp;</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>will</span> <span class='c2'>be</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>invoked</span> <span class='c2'>recursively</span> <span class='c2'>on</span> <span class='c2'>all</span> <span class='c2'>compound</span> <span class='c2'>statements.</span><span class='c3'>&nbsp;</span> <span class='c2'>If</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>statement</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>a</span> <span class='c2'>compound</span> <span class='c2'>statement,</span> <span class='c2'>then</span> <span class='c2'>it</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>returned</span> <span class='c2'>as</span> <span class='c2'>is.</span><span class='c3'>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>statement</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>A</span> <span class='c2'>linearized/flattened</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>linearizeStatement ::</span> <span class='c6'>Statement</span> <span class='c3'>-&gt; [</span><span class='c6'>Statement</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>linearizeStatement statement =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; serializeStatementFoldFn ::</span> <span class='c6'>Statement</span> <span class='c3'>-&gt; [</span><span class='c6'>Statement</span><span class='c3'>] -&gt; [</span><span class='c6'>Statement</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; serializeStatementFoldFn !stmt stmtList =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>stmt</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CompoundStatement</span> <span class='c3'>{statements} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foldRight serializeStatementFoldFn stmtList statements;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stmt : stmtList;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foldRight serializeStatementFoldFn [] [statement];</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Breaks</span> <span class='c2'>a</span> <span class='c2'>compound</span> <span class='c2'>statement</span> <span class='c2'>into</span> <span class='c2'>multiple</span> <span class='c2'>compound</span> <span class='c2'>statements</span> <span class='c2'>with</span> <span class='c2'>a</span> <span class='c2'>smaller</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>statement</span> <span class='c2'>count.</span><span class='c3'>&nbsp;</span> <span class='c2'>This</span> <span class='c2'>function</span> <span class='c2'>assumes</span> <span class='c2'>that</span> <span class='c2'>it</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>possible</span> <span class='c2'>to</span> <span class='c2'>create</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>nested</span> <span class='c2'>compound</span> <span class='c2'>statements.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>splitCompoundStatement ::</span> <span class='c6'>Statement</span> <span class='c3'>-&gt;</span> <span class='c6'>Int</span> <span class='c3'>-&gt; [</span><span class='c6'>Statement</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>splitCompoundStatement stmt maxCount =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>stmt</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CompoundStatement</span> <span class='c3'>{statements} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>List</span><span class='c3'>.map makeCompoundStatement (chop maxCount statements);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt; [stmt];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>SQL</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>statement.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>statementText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Statement</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>statementText !builder !forDisplay statement =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>builder</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SqlBuilder</span> <span class='c3'>{buildCreateDatabaseStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropDatabaseStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateTableStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateViewStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropTableStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropViewStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertValuesStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertQueryValuesStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildUpdateValuesStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDeleteRowsStatementFn,</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCommitStatementFn} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayWidth =</span> <span class='c7'>1</span> <span class='c3'>::</span> <span class='c6'>Int</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; width =</span> <b><span class='c5'>if</span></b> <span class='c3'>forDisplay</span> <b><span class='c5'>then</span></b> <span class='c3'>displayWidth ::</span> <span class='c6'>Int</span> <b><span class='c5'>else</span></b> <span class='c6'>Prelude</span><span class='c3'>.maxBound;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; docForStatement statement =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>statement</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CreateDatabaseStatement</span> <span class='c3'>{databaseRef, skipIfDatabaseExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateDatabaseStatementFn databaseRef skipIfDatabaseExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DropDatabaseStatement</span> <span class='c3'>{databaseRef, onlyIfDatabaseExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropDatabaseStatementFn databaseRef onlyIfDatabaseExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CreateTableStatement</span> <span class='c3'>{tableDesc, skipIfTableExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateTableStatementFn tableDesc skipIfTableExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CreateViewStatement</span> <span class='c3'>{viewRef, viewDefinition, skipIfViewExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCreateViewStatementFn viewRef viewDefinition skipIfViewExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DropTableStatement</span> <span class='c3'>{tableRef, onlyIfTableExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropTableStatementFn tableRef onlyIfTableExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DropViewStatement</span> <span class='c3'>{viewRef, onlyIfViewExists} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDropViewStatementFn viewRef onlyIfViewExists;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertValuesStatement</span> <span class='c3'>{tableRef, maybeDestColumns, rowValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertValuesStatementFn tableRef maybeDestColumns rowValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InsertQueryValuesStatement</span> <span class='c3'>{tableRef, maybeDestColumns, insertQuery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildInsertQueryValuesStatementFn tableRef maybeDestColumns insertQuery;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UpdateValuesStatement</span> <span class='c3'>{tableRef, destColumns, newValues, condition} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildUpdateValuesStatementFn newSqlBuilderState tableRef destColumns newValues condition;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>DeleteRowsStatement</span> <span class='c3'>{tableRef, condition} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildDeleteRowsStatementFn newSqlBuilderState tableRef condition;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>CommitStatement</span> <span class='c3'>-&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buildCommitStatementFn;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span><span class='c6'>CompoundStatement</span> <span class='c3'>{statements} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PrettyPrinter</span><span class='c3'>.group (</span><span class='c6'>PrettyPrinter</span><span class='c3'>.stack (map docForStatement statements));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>PrettyPrinter</span><span class='c3'>.pretty width (docForStatement statement);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>table</span> <span class='c2'>field</span> <span class='c2'>description.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>fieldDescriptionText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>FieldDescription</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>fieldDescriptionText !builder fieldDesc =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (builder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildFieldDescriptionFn) fieldDesc;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Generates</span> <span class='c2'>the</span> <span class='c2'>text</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>data</span> <span class='c2'>type.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>fieldTypeText ::</span> <span class='c6'>SqlBuilder</span> <span class='c3'>-&gt;</span> <span class='c6'>SqlType</span> <span class='c3'>-&gt;</span> <span class='c6'>Document</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>fieldTypeText !builder !dataType =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (builder.</span><span class='c6'>SqlBuilder</span><span class='c3'>.buildFieldTypeFn) dataType;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span> <span class='c2'>The</span> <span class='c2'>query</span> <span class='c2'>for</span> <span class='c2'>which</span> <span class='c2'>we</span> <span class='c2'>want</span> <span class='c2'>the</span> <span class='c2'>groups.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>The</span> <span class='c2'>list</span> <span class='c2'>of</span> <span class='c2'>groups</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>given</span> <span class='c2'>query,</span> <span class='c2'>or</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>union</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>then</span> <span class='c2'>the</span> <span class='c2'>groups</span> <span class='c2'>for</span> <span class='c2'>the</span> <span class='c2'>first</span> <span class='c2'>query</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>union.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getGroups ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getGroups query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{groups, columns} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filter expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{} -&gt; [expr];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cols = concatMap (\col -&gt; filter col.</span><span class='c6'>#1</span><span class='c3'>) columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groups ++ cols;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1} -&gt; getGroups query1;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>True</span> <span class='c2'>when</span> <span class='c2'>a</span> <span class='c2'>given</span> <span class='c2'>function</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>of</span> <span class='c2'>two</span> <span class='c2'>parameters</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isBinaryFunction ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isBinaryFunction dbFun =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>dbFun</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (</span><span class='c6'>OpEq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpLt</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpLtEq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpGt</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpGtEq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpNotEq</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpAnd</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpOr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpLike</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpIn</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpCat</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpPlus</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpMinus</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpMul</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpDiv</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpMod</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpBitAnd</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpBitOr</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; |</span> <span class='c6'>OpBitXor</span><span class='c3'>) -&gt;</span> <span class='c6'>True</span><span class='c3'>;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>It</span> <span class='c2'>applies</span> <span class='c2'>ConvertToTime</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>passed</span> <span class='c2'>in</span> <span class='c2'>expression.</span> <span class='c2'>Use</span> <span class='c2'>it</span> <span class='c2'>when</span> <span class='c2'>you</span> <span class='c2'>want</span> <span class='c2'>the</span> <span class='c2'>end</span> <span class='c2'>result</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>evaluated</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>explicit</span> <span class='c2'>cast</span> <span class='c2'>call.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>function</span> <span class='c2'>expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertToTimeExpr ::</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Time</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>convertToTimeExpr = functionExpr1</span> <span class='c6'>ConvertToTimeFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Use</span> <span class='c2'>it</span> <span class='c2'>to</span> <span class='c2'>check</span> <span class='c2'>if</span> <span class='c2'>the</span> <span class='c2'>expression's</span> <span class='c2'>part</span> <span class='c2'>uses</span> <span class='c2'>binary</span> <span class='c2'>function.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>True</span> <span class='c2'>when</span> <span class='c2'>expression</span> <span class='c2'>uses</span> <span class='c2'>binary</span> <span class='c2'>function</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>function</span> <span class='c2'>=</span> <span class='c2'>isBinaryFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>exprUsesBinaryFunction ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>exprUsesBinaryFunction expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>fieldName queryTable -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span><span class='c3'>&nbsp; constantValue -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span><span class='c3'>&nbsp; listValues -&gt; any exprUsesBinaryFunction listValues;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>func arguments -&gt; isBinaryFunction func || (any exprUsesBinaryFunction arguments);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>subquery -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>function</span> <span class='c2'>recurses</span> <span class='c2'>the</span> <span class='c2'>Expr</span> <span class='c2'>Boolean</span> <span class='c2'>and</span> <span class='c2'>makes</span> <span class='c2'>sure</span> <span class='c2'>that</span> <span class='c2'>every</span> <span class='c2'>item</span> <span class='c2'>involved</span> <span class='c2'>in</span> <span class='c2'>operation</span> <span class='c2'>against</span> <span class='c2'>time</span> <span class='c2'>constant</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>is</span> <span class='c2'>casted</span> <span class='c2'>to</span> <span class='c2'>datetime</span> <span class='c2'>format</span> <span class='c2'>explictly.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Use</span> <span class='c2'>it</span> <span class='c2'>to</span> <span class='c2'>make</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>evaluated</span> <span class='c2'>to</span> <span class='c2'>explicit</span> <span class='c2'>casts.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>transformed</span> <span class='c2'>expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>function</span> <span class='c2'>=</span> <span class='c2'>convertToTimeExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertDateQueryFieldsToTimeExprs ::</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>convertDateQueryFieldsToTimeExprs expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span><b><span class='c8'>TODO</span></b><span class='c1'>: get more metadata into the field object</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertNonTimeConstExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertNonTimeConstExpr exprToConvert =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isTimeConstExpr exprToConvert)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exprToConvert</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; toUntypedExpr(convertToTimeExpr (toTypedExpr exprToConvert));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertionHelper ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertionHelper untypedExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>untypedExpr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListExpr listValue -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//for binary functions, if only one arg is time const make sure</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//all others are casted</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>dbFunc args -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isBinaryFunction dbFunc)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lhs = convertionHelper (head args);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rhs = convertionHelper (head (tail args));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertedExprs = map convertNonTimeConstExpr args;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>((any isQueryFieldExpr args) &amp;&amp; (any isTimeConstExpr args))</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedFunctionExpr dbFunc convertedExprs</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;untypedFunctionExpr dbFunc [lhs, rhs]</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; untypedExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; toTypedExpr (convertionHelper (toUntypedExpr expr));</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c1'>///**</span></p>
<p class="Clz"><span class='c1'>// * The {@code replaceRestrictionExprs@} replaces a restriction of a query with a passed in values.</span></p>
<p class="Clz"><span class='c1'>// *&nbsp;</span></p>
<p class="Clz"><span class='c1'>// * @arg query</span></p>
<p class="Clz"><span class='c1'>// * @arg newRestriction</span></p>
<p class="Clz"><span class='c1'>// * @arg newGrpRestriction</span></p>
<p class="Clz"><span class='c1'>// * @return transformed query</span></p>
<p class="Clz"><span class='c1'>// * @see typeConstructor = Query</span></p>
<p class="Clz"><span class='c1'>// */&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c1'>//replaceRestrictionExprs :: Query -&gt; Maybe (TypedExpr Boolean) -&gt; Maybe (TypedExpr Boolean) -&gt; Query;</span></p>
<p class="Clz"><span class='c1'>//replaceRestrictionExprs query newRestriction newGrpRestriction =</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; case query of</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Query options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Query options columns newRestriction orderings joins groups newGrpRestriction;</span></p>
<p class="Clz"><span class='c1'>//</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt; error "unsupported query type for change of restrictions";</span></p>
<p class="Clz"><span class='c1'>//&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>transformQueryRestrictionExpr</span><span class='c4'>@}</span> <span class='c2'>takes</span> <span class='c2'>a</span> <span class='c2'>conversion</span> <span class='c2'>function</span> <span class='c2'>and</span> <span class='c2'>executes</span> <span class='c2'>it</span> <span class='c2'>against</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>restriction</span> <span class='c2'>expression</span> <span class='c2'>of</span> <span class='c2'>a</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>conversionFunction</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>transformed</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>transformQueryRestrictionExpr :: (</span><span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>) -&gt;</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>transformQueryRestrictionExpr conversionFunction query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>restriction</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Nothing</span> <span class='c3'>-&gt; query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Just</span> <span class='c3'>restrictionExpr -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newRestriction =</span> <span class='c6'>Just</span> <span class='c3'>(conversionFunction restrictionExpr);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns newRestriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// transform the restriction expressions in both queries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(transformQueryRestrictionExpr conversionFunction query1)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (transformQueryRestrictionExpr conversionFunction query2)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>isSubQueryExpr</span><span class='c4'>@}</span> <span class='c2'>tests</span> <span class='c2'>expression</span> <span class='c2'>if</span> <span class='c2'>it</span> <span class='c2'>is</span> <span class='c2'>of</span> <span class='c2'>SubQueryExpr</span> <span class='c2'>type.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>True</span> <span class='c2'>when</span> <span class='c2'>Expr</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c4'>{@code</span> <span class='c2'>SubQueryExpr</span><span class='c4'>@}</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>dataConstructor</span> <span class='c2'>=</span> <span class='c2'>SubQueryExpr</span><span class='c3'>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isSubQueryExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isSubQueryExpr expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{} -&gt;</span> <span class='c6'>True</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>False</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>isSubQueryExpr</span><span class='c4'>@}</span> <span class='c2'>retrieves</span> <span class='c2'>the</span> <span class='c4'>{@code</span> <span class='c2'>Query</span><span class='c4'>@}</span> <span class='c2'>type</span> <span class='c2'>from</span> <span class='c2'>untyped</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Throws</span> <span class='c2'>error</span> <span class='c2'>when</span> <span class='c2'>argument</span> <span class='c2'>is</span> <span class='c2'>not</span> <span class='c2'>of</span> <span class='c2'>SubQueryType</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>expr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>Query</span> <span class='c2'>part</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>SubQueryExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>dataConstructor</span> <span class='c2'>=</span> <span class='c2'>SubQueryExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>function</span> <span class='c2'>=</span> <span class='c2'>isSubQueryExpr</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>getSubQueryFromExpr ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>getSubQueryFromExpr expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>query -&gt; query;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"unable to extract query from non SubQueryExpr"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>isSubQueryExpr</span><span class='c4'>@}</span> <span class='c2'>tests</span> <span class='c2'>passed</span> <span class='c2'>in</span> <span class='c2'>query</span> <span class='c2'>if</span> <span class='c2'>it</span> <span class='c2'>going</span> <span class='c2'>to</span> <span class='c2'>retrieve</span> <span class='c2'>single</span> <span class='c2'>column</span> <span class='c2'>and</span> <span class='c2'>value</span> <span class='c2'>in</span> <span class='c2'>the</span> <span class='c2'>result</span> <span class='c2'>set.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>test</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>True</span> <span class='c2'>when</span> <span class='c2'>expected</span> <span class='c2'>resultset</span> <span class='c2'>is</span> <span class='c2'>using</span> <span class='c2'>single</span> <span class='c2'>column</span> <span class='c2'>with</span> <span class='c2'>applied</span> <span class='c2'>aggregate</span> <span class='c2'>function</span> <span class='c2'>and</span> <span class='c2'>the</span> <span class='c2'>query</span> <span class='c2'>has</span> <span class='c2'>no</span> <span class='c2'>groupings.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>isSingletonResultQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>isSingletonResultQuery query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cols :: [</span><span class='c6'>Expr</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cols = getProjectedColumns query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headCol ::</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headCol = head cols;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbFunc ::</span> <span class='c6'>DbFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbFunc = getFunctionFromFunctionExpr headCol;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>List</span><span class='c3'>.isSingletonList cols</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; isFunctionExpr headCol</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; isEmpty (getGroups query)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; isAggregationFunction dbFunc;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>assignMissingColumnAliases</span><span class='c4'>@}</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>transformation</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>assign</span> <span class='c2'>the</span> <span class='c2'>missing</span> <span class='c2'>aliases</span> <span class='c2'>for</span> <span class='c2'>all</span> <span class='c2'>columns</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>of</span> <span class='c2'>the</span> <span class='c2'>passed</span> <span class='c2'>in</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Use</span> <span class='c2'>it</span> <span class='c2'>in</span> <span class='c2'>conjunction</span> <span class='c2'>with</span> <span class='c4'>{@code</span> <span class='c2'>modifyQueries</span><span class='c4'>@}</span> <span class='c2'>function</span> <span class='c2'>which</span> <span class='c2'>can</span> <span class='c2'>help</span> <span class='c2'>to</span> <span class='c2'>perfrom</span> <span class='c2'>the</span> <span class='c2'>transaformation</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>for</span> <span class='c2'>all</span> <span class='c2'>subqueries</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>transform</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>transformed</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>function</span> <span class='c2'>=</span> <span class='c2'>modifyQueries</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>assignMissingColumnAliases ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>protected</span></b> <span class='c3'>assignMissingColumnAliases query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assignDefaultAlias :: (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>) -&gt;</span> <span class='c6'>Int</span> <span class='c3'>-&gt; (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assignDefaultAlias column aliasIndex =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>column</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (columnExpr, columnAlias) -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>if</span></b> <span class='c3'>(columnAlias ==</span> <span class='c7'>""</span><span class='c3'>)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; defaultColumnAlias aliasIndex</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; columnAlias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (columnExpr, newAlias);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns :: [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns =</span> <span class='c6'>List</span><span class='c3'>.mapIndexed assignDefaultAlias columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options newColumns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>(assignMissingColumnAliases query1) (assignMissingColumnAliases query2) unionAll;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"unsupported type passed to assign missing aliases"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c4'>{@code</span> <span class='c2'>convertQueryColumnsToCartesianJoins</span><span class='c4'>@}</span> <span class='c2'>is</span> <span class='c2'>a</span> <span class='c2'>transformation</span> <span class='c2'>function</span> <span class='c2'>pushing</span> <span class='c2'>the</span> <span class='c2'>sub-queries</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>nested</span> <span class='c2'>as</span> <span class='c2'>select</span> <span class='c2'>items</span> <span class='c2'>down</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>from</span> <span class='c2'>clause</span> <span class='c2'>to</span> <span class='c2'>perform</span> <span class='c2'>cartesian</span> <span class='c2'>join</span> <span class='c2'>between</span> <span class='c2'>datasources.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>It</span> <span class='c2'>is</span> <span class='c2'>useful</span> <span class='c2'>on</span> <span class='c2'>platforms</span> <span class='c2'>like</span> <span class='c2'>Teradata</span> <span class='c2'>that</span> <span class='c2'>do</span> <span class='c2'>not</span> <span class='c2'>support</span> <span class='c2'>nested</span> <span class='c2'>subqueries</span> <span class='c2'>in</span> <span class='c2'>select</span> <span class='c2'>items.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>The</span> <span class='c2'>conversion</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>applied</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>passed</span> <span class='c2'>in</span> <span class='c2'>query</span> <span class='c2'>and</span> <span class='c2'>all</span> <span class='c2'>its</span> <span class='c2'>subqueries.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>After</span> <span class='c2'>all</span> <span class='c2'>missign</span> <span class='c2'>aliases</span> <span class='c2'>have</span> <span class='c2'>been</span> <span class='c2'>assigned.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>It</span> <span class='c2'>expects</span> <span class='c2'>all</span> <span class='c2'>aliases</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>assigned</span> <span class='c2'>therefore</span> <span class='c2'>make</span> <span class='c2'>sure</span> <span class='c4'>{@code</span> <span class='c2'>assignMissingColumnAliases</span><span class='c4'>@}</span> <span class='c2'>is</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>applied</span> <span class='c2'>before</span> <span class='c2'>this</span> <span class='c2'>transform.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Use</span> <span class='c2'>it</span> <span class='c2'>in</span> <span class='c2'>conjunction</span> <span class='c2'>with</span> <span class='c4'>{@code</span> <span class='c2'>modifyQueries</span><span class='c4'>@}</span> <span class='c2'>function</span> <span class='c2'>which</span> <span class='c2'>can</span> <span class='c2'>help</span> <span class='c2'>to</span> <span class='c2'>perfrom</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>the</span> <span class='c2'>transaformation</span> <span class='c2'>for</span> <span class='c2'>all</span> <span class='c2'>subqueries</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>query</span> <span class='c2'>to</span> <span class='c2'>transform</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span> <span class='c2'>transformed</span> <span class='c2'>query</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@see</span> <span class='c2'>function</span> <span class='c2'>=</span> <span class='c2'>modifyQueries,</span> <span class='c2'>assignMissingColumnAliases</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>convertQueryColumnsToCartesianJoins ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>protected</span></b> <span class='c3'>convertQueryColumnsToCartesianJoins !query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertToCartesianQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertToCartesianQuery !queryToConvert =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryToConvert</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options columns restriction orderings joins groups groupRestriction -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// For a subquery column, replace it with a reference to a subquery table field.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Ensure that the generated table aliases are unique, even from the other ones generated here.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateSubQueryColumns :: [</span><span class='c6'>String</span><span class='c3'>] -&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)] -&gt; [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateSubQueryColumns reservedAliases !columns =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>columns</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [] -&gt; [];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headColumn : tailColumns -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>headColumn</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (columnExpr, columnAlias) -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(isSubQueryExpr columnExpr)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQuery ::</span> <span class='c6'>Query</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subQuery = getSubQueryFromExpr columnExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b><span class='c3'>(isSingletonResultQuery subQuery)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; singletonAlias ::</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; singletonAlias = head $ projectedColumnAliases subQuery;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Find a unique alias for this table within the query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;queryTableAlias ::</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queryTableAlias = makeUniqueTableAliasForQuery query reservedAliases</span> <span class='c7'>"Q"</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newQueryTable ::</span> <span class='c6'>QueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newQueryTable = makeSubQueryTable subQuery queryTableAlias;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Apply MIN function on singleton query to avoid grouping.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Use MIN in case the data type is non-numeric.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumnExpr ::</span> <span class='c6'>Expr</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumnExpr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; untypedFunctionExpr</span> <span class='c6'>AggrMin</span> <span class='c3'>[untypedField newQueryTable singletonAlias];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (newColumnExpr, columnAlias) : updateSubQueryColumns (queryTableAlias : reservedAliases) tailColumns</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headColumn : updateSubQueryColumns reservedAliases tailColumns</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headColumn : updateSubQueryColumns reservedAliases tailColumns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns :: [(</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>)];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newColumns = updateSubQueryColumns [] columns;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>options newColumns restriction orderings joins groups groupRestriction;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>query1 query2 unionAll -&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span><span class='c3'>(convertToCartesianQuery query1) (convertToCartesianQuery query2) unionAll;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ -&gt;</span> <span class='c6'>error</span> <span class='c7'>"invalid query type when converting joins"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convertToCartesianQuery query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Constructs</span> <span class='c2'>a</span> <span class='c2'>table</span> <span class='c2'>alias</span> <span class='c2'>from</span> <span class='c2'>the</span> <span class='c2'>base</span> <span class='c2'>name</span> <span class='c2'>which</span> <span class='c2'>is</span> <span class='c2'>distinct</span> <span class='c2'>within</span> <span class='c2'>the</span> <span class='c2'>query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>makeUniqueTableAliasForQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt; [</span><span class='c6'>String</span><span class='c3'>] -&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>makeUniqueTableAliasForQuery !query !otherReservedAliases !baseAlias =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Get the list of all base alias and ID combinations from the query.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allQueryTables :: [</span><span class='c6'>QueryTable</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allQueryTables = getQueryTables</span> <span class='c6'>True</span> <span class='c3'>query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allUsedTableAliases ::</span> <span class='c6'>Set</span> <span class='c6'>String</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allUsedTableAliases =</span> <span class='c6'>Set</span><span class='c3'>.fromList (otherReservedAliases ++ map getQueryTableAlias allQueryTables);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; potentialAliases :: [</span><span class='c6'>String</span><span class='c3'>];</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; potentialAliases = baseAlias : map (\!indx -&gt; baseAlias ++ intToString indx) (upFrom</span> <span class='c7'>2</span><span class='c3'>);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; head $ filter (\potentialAlias -&gt; not $</span> <span class='c6'>Set</span><span class='c3'>.member potentialAlias allUsedTableAliases) potentialAliases;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c2'>/**</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c2'>Convert</span> <span class='c2'>a</span> <span class='c2'>range</span> <span class='c2'>of</span> <span class='c2'>values</span> <span class='c2'>for</span> <span class='c2'>a</span> <span class='c2'>field</span> <span class='c2'>or</span> <span class='c2'>expression</span> <span class='c2'>into</span> <span class='c2'>the</span> <span class='c2'>equivalent</span> <span class='c2'>restriction</span> <span class='c2'>expression.</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>makeConstantFn</span><span class='c3'>&nbsp;</span> <span class='c2'>a</span> <span class='c2'>function</span> <span class='c2'>to</span> <span class='c2'>produce</span> <span class='c2'>a</span> <span class='c2'>database</span> <span class='c2'>constant</span> <span class='c2'>expression</span> <span class='c2'>from</span> <span class='c2'>a</span> <span class='c2'>value</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>field</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>database</span> <span class='c2'>field</span> <span class='c2'>or</span> <span class='c2'>expression</span> <span class='c2'>to</span> <span class='c2'>be</span> <span class='c2'>restricted</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@arg</span> <span class='c2'>range</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>the</span> <span class='c2'>range</span> <span class='c2'>of</span> <span class='c2'>values</span> <span class='c2'>to</span> <span class='c2'>which</span> <span class='c2'>the</span> <span class='c2'>field</span> <span class='c2'>will</span> <span class='c2'>be</span> <span class='c2'>restricted</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*</span> <span class='c4'>@return</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c2'>a</span> <span class='c2'>Boolean</span> <span class='c2'>expression</span> <span class='c2'>restricting</span> <span class='c2'>the</span> <span class='c2'>field</span> <span class='c2'>to</span> <span class='c2'>the</span> <span class='c2'>specified</span> <span class='c2'>range</span></p>
<p class="Clz"><span class='c3'>&nbsp;</span><span class='c2'>*/</span></p>
<p class="Clz"><span class='c3'>rangeToRestrictionExpr ::</span> <span class='c6'>Ord</span> <span class='c3'>a =&gt; (a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a) -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c3'>a -&gt;</span> <span class='c6'>Range</span> <span class='c3'>a -&gt;</span> <span class='c6'>TypedExpr</span> <span class='c6'>Boolean</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>public</span></b> <span class='c3'>rangeToRestrictionExpr makeConstantFn field !range =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>let</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startValue = makeConstantFn (leftEndpoint range);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startOperator =</span> <b><span class='c5'>if</span></b><span class='c3'>(includesLeftEndpoint range)</span> <b><span class='c5'>then</span></b> <span class='c3'>gtEqExpr</span> <b><span class='c5'>else</span></b> <span class='c3'>gtExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startRestriction = startOperator field startValue;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endValue = makeConstantFn (rightEndpoint range);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endOperator =</span> <b><span class='c5'>if</span></b><span class='c3'>(includesRightEndpoint range)</span> <b><span class='c5'>then</span></b> <span class='c3'>ltEqExpr</span> <b><span class='c5'>else</span></b> <span class='c3'>ltExpr;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endRestriction = endOperator field endValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>in</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(hasLeftEndpoint range)</span> <b><span class='c5'>then</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(hasRightEndpoint range)</span> <b><span class='c5'>then</span></b> <span class='c3'>andExpr startRestriction endRestriction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>startRestriction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>if</span></b> <span class='c3'>(hasRightEndpoint range)</span> <b><span class='c5'>then</span></b> <span class='c3'>endRestriction</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>else</span></b> <span class='c3'>trueConstant;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output CAL Queries and Expressions (and dependant types) to Java.</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output QueryTables.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.QueryTable"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JQueryTable</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.QueryTable$BaseTable"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeBaseTable ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.QueryTable$SubQueryTable"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeSubQueryTable ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JQuery</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>QueryTable</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputQueryTableAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQueryTable ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryTable</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQueryTable !queryTable =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryTable</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BaseTable</span> <span class='c3'>{tableRef, tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeBaseTable tableAlias (getTableNameFromReference tableRef);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryTable</span> <span class='c3'>{subquery, tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeSubQueryTable tableAlias (outputQuery subquery);</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpaqueSubQueryTable</span> <span class='c3'>{subqueryText, tableAlias} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// The Java model doesn't have a class for an opaque subquery table.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c1'>//</span> <b><span class='c8'>TODO</span></b><span class='c1'>: would it be possible to parse the query and construct a regular query table object instead?</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>error</span> <span class='c7'>"case not implemented"</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQueryTableAsJObject ::</span> <span class='c6'>QueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQueryTableAsJObject !queryTable = output $ outputQueryTable queryTable;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output QueryOptions.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.QueryOption"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JQueryOption</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static method org.openquark.cal.foreignsupport.module.Sql.QueryOption.makeDistinctOption"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeDistinctOption ::</span> <span class='c6'>JQueryOption</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static method org.openquark.cal.foreignsupport.module.Sql.QueryOption.makeTopNOption"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeTopNOption ::</span> <span class='c6'>Int</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryOption</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>QueryOption</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputQueryOptionAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQueryOption ::</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryOption</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQueryOption !queryOption =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>queryOption</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Distinct</span> <span class='c3'>{} -&gt; jMakeDistinctOption;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TopN</span> <span class='c3'>{n, percent, withTies} -&gt; jMakeTopNOption n percent withTies;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQueryOptionAsJObject ::</span> <span class='c6'>QueryOption</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQueryOptionAsJObject !queryOption = output $ outputQueryOption queryOption;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output JoinTypes.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.JoinType"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JJoinType</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.JoinType.INNER_JOIN"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jINNER_JOIN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JJoinType</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.JoinType.LEFT_OUTER_JOIN"</span><span class='c3'>&nbsp; jLEFT_OUTER_JOIN&nbsp; ::</span> <span class='c6'>JJoinType</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.JoinType.RIGHT_OUTER_JOIN"</span> <span class='c3'>jRIGHT_OUTER_JOIN ::</span> <span class='c6'>JJoinType</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.JoinType.FULL_OUTER_JOIN"</span><span class='c3'>&nbsp; jFULL_OUTER_JOIN&nbsp; ::</span> <span class='c6'>JJoinType</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>JoinType</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputJoinTypeAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputJoinType ::</span> <span class='c6'>JoinType</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinType</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputJoinType !joinType =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinType</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>InnerJoin</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jINNER_JOIN;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>LeftOuterJoin</span><span class='c3'>&nbsp; -&gt; jLEFT_OUTER_JOIN;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>RightOuterJoin</span> <span class='c3'>-&gt; jRIGHT_OUTER_JOIN;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FullOuterJoin</span><span class='c3'>&nbsp; -&gt; jFULL_OUTER_JOIN;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputJoinTypeAsJObject ::</span> <span class='c6'>JoinType</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputJoinTypeAsJObject !joinType = output $ outputJoinType joinType;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output JoinNodes.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.JoinNode"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JJoinNode</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.JoinNode$JoinTable"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeJoinTableNode ::</span> <span class='c6'>JQueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.JoinNode$JoinSubtree"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeJoinSubtreeNode ::</span> <span class='c6'>JJoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinType</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>JoinNode</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputJoinNodeAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputJoinNode ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JJoinNode</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputJoinNode !joinNode =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>joinNode</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinTable</span> <span class='c3'>{table} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeJoinTableNode $ outputQueryTable table;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JoinSubtree</span> <span class='c3'>{leftNode, rightNode, linkingExpr, joinType} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeJoinSubtreeNode (outputJoinNode leftNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputJoinNode rightNode)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputExpression $ toUntypedExpr linkingExpr)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputJoinType joinType);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputJoinNodeAsJObject ::</span> <span class='c6'>JoinNode</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputJoinNodeAsJObject !joinNode = output $ outputJoinNode joinNode;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output DbFunctions.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JDatabaseFunction</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Function"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeDatabaseFunction ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.NOT_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jNotOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.BITWISE_NOT_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jBitwiseNotOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.NEGATE_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jNegateOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.ISNULL_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jIsNullOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.ISNOTNULL_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jIsNotNullOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.EXISTS_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jExistsOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.EQUAL_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jEqualOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.LESS_THAN_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jLessThanOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.LESS_THAN_OR_EQUAL_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp; jLessThanOrEqualOperator&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.GREATER_THAN_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jGreaterThanOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.GREATER_THAN_OR_EQUAL_OPERATOR"</span><span class='c3'>jGreaterThanOrEqualOperator ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.NOT_EQUAL_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jNotEqualOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.AND_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jAndOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.OR_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jOrOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.LIKE_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jLikeOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.IN_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jInOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.CONCAT_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jConcatOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.PLUS_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jPlusOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.MINUS_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMinusOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.MULTIPLY_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMultiplyOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.DIVIDE_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jDivideOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.MODULUS_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jModulusOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.BITWISE_AND_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jBitwiseAndOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.BITWISE_OR_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jBitwiseOrOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.BITWISE_XOR_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jBitwiseXOrOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.BETWEEN_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jBetweenOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.SIMPLE_CASE_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jSimpleCaseOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Operator.SEARCHED_CASE_OPERATOR"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jSearchedCaseOperator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Conversion.CONVERSION_TO_STRING"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jConvertToString&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Conversion.CONVERSION_TO_INT"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jConvertToInt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Conversion.CONVERSION_TO_DOUBLE"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jConvertToDouble&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static field org.openquark.cal.foreignsupport.module.Sql.DatabaseFunction$Conversion.CONVERSION_TO_TIME"</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jConvertToTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>DbFunction</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputDbFunctionAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputDbFunction ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>JDatabaseFunction</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputDbFunction !func =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>func</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Handle operators specially.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNot</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jNotOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitNot</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jBitwiseNotOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNegate</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jNegateOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIsNull</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jIsNullOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIsNotNull</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jIsNotNullOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpExists</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jExistsOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpEq</span><span class='c3'>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; jEqualOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLt</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jLessThanOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLtEq</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jLessThanOrEqualOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpGt</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jGreaterThanOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpGtEq</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jGreaterThanOrEqualOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpNotEq</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jNotEqualOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpAnd</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jAndOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpOr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jOrOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpLike</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jLikeOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpIn</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jInOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCat</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jConcatOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpPlus</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jPlusOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMinus</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jMinusOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMul</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jMultiplyOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpDiv</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jDivideOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpMod</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jModulusOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitAnd</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jBitwiseAndOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitOr</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jBitwiseOrOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBitXor</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jBitwiseXOrOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpBetween</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jBetweenOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCase_Simple</span><span class='c3'>&nbsp;&nbsp; -&gt; jSimpleCaseOperator;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>OpCase_Searched</span> <span class='c3'>-&gt; jSearchedCaseOperator;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// Handle conversion functions specially as well.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConvertToStringFunction</span> <span class='c3'>-&gt; jConvertToString;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConvertToIntFunction</span><span class='c3'>&nbsp;&nbsp;&nbsp; -&gt; jConvertToInt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConvertToDoubleFunction</span> <span class='c3'>-&gt; jConvertToDouble;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConvertToTimeFunction</span><span class='c3'>&nbsp;&nbsp; -&gt; jConvertToTime;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c1'>// For other functions, just output the default function name.</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; _ -&gt; jMakeDatabaseFunction $ defaultFunctionName func;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputDbFunctionAsJObject ::</span> <span class='c6'>DbFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputDbFunctionAsJObject !func = output $ outputDbFunction func;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output Expressions.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.SqlExpression"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JExpression</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$QueryField"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeQueryFieldExpression ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryTable</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static method org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ConstantExpression$NullConstant.nullConstant"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeNullConstantExpression ::</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ConstantExpression$StringConstant"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeStringConstantExpression ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ConstantExpression$NumericConstant"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeNumericConstantExpression ::</span> <span class='c6'>Double</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ConstantExpression$BooleanConstant"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeBooleanConstantExpression ::</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ConstantExpression$TimeConstant"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeTimeConstantExpression ::</span> <span class='c6'>Time</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ParameterExpression"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeParameterExpression ::</span> <span class='c6'>JParameter</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$ListExpression"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeListExpression ::</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$FunctionExpression"</span></p>
<p class="Clz"><span class='c3'>&nbsp; &nbsp;&nbsp;jMakeFunctionExpression ::</span> <span class='c6'>JDatabaseFunction</span> <span class='c3'>-&gt;</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlExpression$SubQueryExpression"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeSubQueryExpression ::</span> <span class='c6'>JQuery</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>Expr</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputExprAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputExpression ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputExpression !expr =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>expr</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>QueryField</span> <span class='c3'>{fieldName, queryTable} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeQueryFieldExpression fieldName (outputQueryTable queryTable);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ConstExpr</span> <span class='c3'>{constantValue} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>constantValue</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NullValue</span><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; jMakeNullConstantExpression;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>StringValue</span><span class='c3'>&nbsp; {strValue}&nbsp; -&gt; jMakeStringConstantExpression strValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NumberValue</span><span class='c3'>&nbsp; {numValue}&nbsp; -&gt; jMakeNumericConstantExpression numValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>BooleanValue</span> <span class='c3'>{boolValue} -&gt; jMakeBooleanConstantExpression boolValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span class='c6'>TimeValue</span><span class='c3'>&nbsp;&nbsp;&nbsp; {timeValue} -&gt; jMakeTimeConstantExpression timeValue;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ParameterExpr</span> <span class='c3'>{parameter} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeParameterExpression (outputParameter parameter);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>ListExpr</span> <span class='c3'>{listValues} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeListExpression (outputList listValues);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>FunctionExpr</span> <span class='c3'>{func, arguments} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeFunctionExpression (outputDbFunction func) (outputList arguments);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>SubQueryExpr</span> <span class='c3'>{subquery} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeSubQueryExpression (outputQuery subquery);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputExprAsJObject ::</span> <span class='c6'>Expr</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputExprAsJObject !expr = output $ outputExpression expr;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output Queries.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.SqlQuery"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JQuery</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlQuery$SelectQuery"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeSelectQuery ::</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span> <span class='c3'>-&gt;</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JList</span> <span class='c3'>-&gt;</span> <span class='c6'>JExpression</span> <span class='c3'>-&gt;</span> <span class='c6'>JQuery</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor org.openquark.cal.foreignsupport.module.Sql.SqlQuery$UnionQuery"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeUnionQuery ::</span> <span class='c6'>JQuery</span> <span class='c3'>-&gt;</span> <span class='c6'>JQuery</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>JQuery</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.QueryColumn"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JQueryColumn</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeQueryColumn ::</span> <span class='c6'>JExpression</span> <span class='c3'>-&gt;</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JQueryColumn</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.SqlOrdering"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JSqlOrdering</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"constructor"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeSqlOrdering ::</span> <span class='c6'>JExpression</span> <span class='c3'>-&gt;</span> <span class='c6'>Boolean</span> <span class='c3'>-&gt;</span> <span class='c6'>JSqlOrdering</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>Query</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputQueryAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQuery ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>JQuery</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQuery !query =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>query</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Query</span> <span class='c3'>{options, columns, restriction, orderings, joins, groups, groupRestriction} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeSelectQuery (outputList options)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputListWith columns outputProjectedColumn)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputExpression $ toUntypedExpr $ fromMaybe trueConstant restriction)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputListWith orderings outputOrdering)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputList joins)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputList groups)</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (outputExpression $ toUntypedExpr $ fromMaybe trueConstant groupRestriction);</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>Union</span> <span class='c3'>{query1, query2, unionAll} -&gt;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jMakeUnionQuery (outputQuery query1) (outputQuery query2) unionAll;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputQueryAsJObject ::</span> <span class='c6'>Query</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputQueryAsJObject !query = output $ outputQuery query;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputProjectedColumn :: (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>String</span><span class='c3'>) -&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputProjectedColumn !column =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>column</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (expr, alias) -&gt; output $ jMakeQueryColumn (outputExpression expr) alias;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputOrdering :: (</span><span class='c6'>Expr</span><span class='c3'>,</span> <span class='c6'>Boolean</span><span class='c3'>) -&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputOrdering !ordering =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>ordering</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; (expr, ascending) -&gt; output $ jMakeSqlOrdering (outputExpression expr) ascending;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c1'>/////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p class="Clz"><span class='c1'>// Output Parameters.</span></p>
<p class="Clz"><b><span class='c5'>data</span></b> <b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"org.openquark.cal.foreignsupport.module.Sql.SqlParameter"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>JParameter</span> <b><span class='c5'>deriving</span></b> <span class='c6'>Outputable</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static method org.openquark.cal.foreignsupport.module.Sql.SqlParameter.makeParameter"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeUnnamedParameter ::</span> <span class='c6'>JParameter</span><span class='c3'>;</span></p>
<p class="Clz"><b><span class='c5'>foreign</span></b> <b><span class='c5'>unsafe</span></b> <b><span class='c5'>import</span></b> <b><span class='c5'>jvm</span></b> <span class='c7'>"static method org.openquark.cal.foreignsupport.module.Sql.SqlParameter.makeParameter"</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; jMakeNamedParameter ::</span> <span class='c6'>String</span> <span class='c3'>-&gt;</span> <span class='c6'>JParameter</span><span class='c3'>;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><b><span class='c5'>instance</span></b> <span class='c6'>Outputable</span> <span class='c6'>Parameter</span> <b><span class='c5'>where</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; output = outputParameterAsJObject;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputParameter ::</span> <span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>JParameter</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputParameter !parameter =</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <b><span class='c5'>case</span></b> <span class='c3'>parameter</span> <b><span class='c5'>of</span></b></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>UnnamedParameter</span> <span class='c3'>-&gt; jMakeUnnamedParameter;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp;</span> <span class='c6'>NamedParameter</span> <span class='c3'>{name} -&gt; jMakeNamedParameter name;</span></p>
<p class="Clz"><span class='c3'>&nbsp;&nbsp;&nbsp; ;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span class='c3'>outputParameterAsJObject ::</span> <span class='c6'>Parameter</span> <span class='c3'>-&gt;</span> <span class='c6'>JObject</span><span class='c3'>;</span></p>
<p class="Clz"><span class='c3'>outputParameterAsJObject !parameter = output $ outputParameter parameter;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz"><span>&nbsp;</span></p>
<p class="Clz">&nbsp;</p>
</div>
</body>
</html>
